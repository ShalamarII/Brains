class e{static ID="module-credits";static OPTIONS={background:"#7030A0",color:"#fff",LOG_LEVEL:[{title:"OFF",background:"#000",color:"#fff"},{title:"ERROR",background:"#F93154",color:"#fff"},{title:"WARN",background:"#FFA900",color:"#fff"},{title:"DEBUG",background:"#B23CFD",color:"#fff"},{title:"INFO",background:"#39C0ED",color:"#fff"},{title:"LOG",background:"#39C0ED",color:"#fff"}]};static get TITLE(){return this.localize("title")}static localize(e,t={}){return foundry.utils.isEmpty(t??{})?game.i18n.localize(`${this.ID}.${e}`):game.i18n.format(`${this.ID}.${e}`,t)}static CONSOLE=(e,...t)=>{try{game.modules.get("_dev-mode")?.api?.getPackageDebugValue(this.ID,"level")>=e&&console.log(`%c${this.TITLE}%c${this.OPTIONS.LOG_LEVEL[e].title}`,`background-color: ${this.OPTIONS.background}; border-radius: 2px; color: ${this.OPTIONS.color}; padding: 0.15rem 0.25rem;`,`background-color: ${this.OPTIONS.LOG_LEVEL[e].background}; border-radius: 2px; color: ${this.OPTIONS.LOG_LEVEL[e].color}; padding: 0.15rem 0.25rem; margin-left: 0.25rem;${e>=4?"display:none":""}`,...t)}catch(e){console.warn(`${this.TITLE} debug logging failed`,e)}};static log=(...e)=>{this.CONSOLE(5,...e)};static info=(...e)=>{this.CONSOLE(4,...e)};static debug=(...e)=>{this.CONSOLE(3,...e)};static warn=(...e)=>{this.CONSOLE(2,...e)};static error=(...e)=>{this.CONSOLE(1,...e)};static setting=(...t)=>{if("register"==t[0].toLowerCase()){let e=t[1],i=t[2],n={name:this.localize(`settings.${e}.name`),hint:this.localize(`settings.${e}.hint`),scope:"client",config:!0},o=foundry.utils.mergeObject(n,i,{inplace:!1});return game.settings.register(this.ID,e,o),o}{let i=t[0];if(void 0!==t[1])return game.settings.set(this.ID,i,t[1]);try{return game.settings.get(this.ID,i)}catch{return void e.error(`${i} is not a registered game setting`)}}}}var t,i;function n(e,t,i,n,o,a,r){try{var s=e[a](r),l=s.value}catch(e){return void i(e)}s.done?t(l):Promise.resolve(l).then(n,o)}function o(e){return function(){var t=this,i=arguments;return new Promise((function(o,a){var r=e.apply(t,i);function s(e){n(r,o,a,s,l,"next",e)}function l(e){n(r,o,a,s,l,"throw",e)}s(void 0)}))}}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}t=void 0,i=function(e){function t(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function i(e){return e instanceof t(e).Element||e instanceof Element}function n(e){return e instanceof t(e).HTMLElement||e instanceof HTMLElement}function o(e){return"undefined"!=typeof ShadowRoot&&(e instanceof t(e).ShadowRoot||e instanceof ShadowRoot)}var a=Math.max,r=Math.min,s=Math.round;function l(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function c(){return!/^((?!chrome|android).)*safari/i.test(l())}function d(e,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);var r=e.getBoundingClientRect(),l=1,d=1;o&&n(e)&&(l=e.offsetWidth>0&&s(r.width)/e.offsetWidth||1,d=e.offsetHeight>0&&s(r.height)/e.offsetHeight||1);var u=(i(e)?t(e):window).visualViewport,p=!c()&&a,g=(r.left+(p&&u?u.offsetLeft:0))/l,f=(r.top+(p&&u?u.offsetTop:0))/d,m=r.width/l,h=r.height/d;return{width:m,height:h,top:f,right:g+m,bottom:f+h,left:g,x:g,y:f}}function u(e){var i=t(e);return{scrollLeft:i.pageXOffset,scrollTop:i.pageYOffset}}function p(e){return e?(e.nodeName||"").toLowerCase():null}function g(e){return((i(e)?e.ownerDocument:e.document)||window.document).documentElement}function f(e){return d(g(e)).left+u(e).scrollLeft}function m(e){return t(e).getComputedStyle(e)}function h(e){var t=m(e),i=t.overflow,n=t.overflowX,o=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+o+n)}function y(e,i,o){void 0===o&&(o=!1);var a,r,l=n(i),c=n(i)&&function(e){var t=e.getBoundingClientRect(),i=s(t.width)/e.offsetWidth||1,n=s(t.height)/e.offsetHeight||1;return 1!==i||1!==n}(i),m=g(i),y=d(e,c,o),b={scrollLeft:0,scrollTop:0},v={x:0,y:0};return(l||!l&&!o)&&(("body"!==p(i)||h(m))&&(b=(a=i)!==t(a)&&n(a)?{scrollLeft:(r=a).scrollLeft,scrollTop:r.scrollTop}:u(a)),n(i)?((v=d(i,!0)).x+=i.clientLeft,v.y+=i.clientTop):m&&(v.x=f(m))),{x:y.left+b.scrollLeft-v.x,y:y.top+b.scrollTop-v.y,width:y.width,height:y.height}}function b(e){var t=d(e),i=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:n}}function v(e){return"html"===p(e)?e:e.assignedSlot||e.parentNode||(o(e)?e.host:null)||g(e)}function w(e){return["html","body","#document"].indexOf(p(e))>=0?e.ownerDocument.body:n(e)&&h(e)?e:w(v(e))}function k(e,i){var n;void 0===i&&(i=[]);var o=w(e),a=o===(null==(n=e.ownerDocument)?void 0:n.body),r=t(o),s=a?[r].concat(r.visualViewport||[],h(o)?o:[]):o,l=i.concat(s);return a?l:l.concat(k(v(s)))}function S(e){return["table","td","th"].indexOf(p(e))>=0}function $(e){return n(e)&&"fixed"!==m(e).position?e.offsetParent:null}function x(e){for(var i=t(e),a=$(e);a&&S(a)&&"static"===m(a).position;)a=$(a);return a&&("html"===p(a)||"body"===p(a)&&"static"===m(a).position)?i:a||function(e){var t=/firefox/i.test(l());if(/Trident/i.test(l())&&n(e)&&"fixed"===m(e).position)return null;var i=v(e);for(o(i)&&(i=i.host);n(i)&&["html","body"].indexOf(p(i))<0;){var a=m(i);if("none"!==a.transform||"none"!==a.perspective||"paint"===a.contain||-1!==["transform","perspective"].indexOf(a.willChange)||t&&"filter"===a.willChange||t&&a.filter&&"none"!==a.filter)return i;i=i.parentNode}return null}(e)||i}var L="top",M="bottom",O="right",E="left",I="auto",T=[L,M,O,E],D="start",A="end",q="viewport",C="popper",P=T.reduce((function(e,t){return e.concat([t+"-"+D,t+"-"+A])}),[]),j=[].concat(T,[I]).reduce((function(e,t){return e.concat([t,t+"-"+D,t+"-"+A])}),[]),z=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function R(e){var t=new Map,i=new Set,n=[];function o(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var n=t.get(e);n&&o(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||o(e)})),n}function N(e){return e.split("-")[0]}function H(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&o(i)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function G(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function V(e,n,o){return n===q?G(function(e,i){var n=t(e),o=g(e),a=n.visualViewport,r=o.clientWidth,s=o.clientHeight,l=0,d=0;if(a){r=a.width,s=a.height;var u=c();(u||!u&&"fixed"===i)&&(l=a.offsetLeft,d=a.offsetTop)}return{width:r,height:s,x:l+f(e),y:d}}(e,o)):i(n)?function(e,t){var i=d(e,!1,"fixed"===t);return i.top=i.top+e.clientTop,i.left=i.left+e.clientLeft,i.bottom=i.top+e.clientHeight,i.right=i.left+e.clientWidth,i.width=e.clientWidth,i.height=e.clientHeight,i.x=i.left,i.y=i.top,i}(n,o):G(function(e){var t,i=g(e),n=u(e),o=null==(t=e.ownerDocument)?void 0:t.body,r=a(i.scrollWidth,i.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),s=a(i.scrollHeight,i.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),l=-n.scrollLeft+f(e),c=-n.scrollTop;return"rtl"===m(o||i).direction&&(l+=a(i.clientWidth,o?o.clientWidth:0)-r),{width:r,height:s,x:l,y:c}}(g(e)))}function F(e,t,o,s){var l="clippingParents"===t?function(e){var t=k(v(e)),o=["absolute","fixed"].indexOf(m(e).position)>=0&&n(e)?x(e):e;return i(o)?t.filter((function(e){return i(e)&&H(e,o)&&"body"!==p(e)})):[]}(e):[].concat(t),c=[].concat(l,[o]),d=c[0],u=c.reduce((function(t,i){var n=V(e,i,s);return t.top=a(n.top,t.top),t.right=r(n.right,t.right),t.bottom=r(n.bottom,t.bottom),t.left=a(n.left,t.left),t}),V(e,d,s));return u.width=u.right-u.left,u.height=u.bottom-u.top,u.x=u.left,u.y=u.top,u}function U(e){return e.split("-")[1]}function B(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function W(e){var t,i=e.reference,n=e.element,o=e.placement,a=o?N(o):null,r=o?U(o):null,s=i.x+i.width/2-n.width/2,l=i.y+i.height/2-n.height/2;switch(a){case L:t={x:s,y:i.y-n.height};break;case M:t={x:s,y:i.y+i.height};break;case O:t={x:i.x+i.width,y:l};break;case E:t={x:i.x-n.width,y:l};break;default:t={x:i.x,y:i.y}}var c=a?B(a):null;if(null!=c){var d="y"===c?"height":"width";switch(r){case D:t[c]=t[c]-(i[d]/2-n[d]/2);break;case A:t[c]=t[c]+(i[d]/2-n[d]/2)}}return t}function _(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Y(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}function X(e,t){void 0===t&&(t={});var n=t,o=n.placement,a=void 0===o?e.placement:o,r=n.strategy,s=void 0===r?e.strategy:r,l=n.boundary,c=void 0===l?"clippingParents":l,u=n.rootBoundary,p=void 0===u?q:u,f=n.elementContext,m=void 0===f?C:f,h=n.altBoundary,y=void 0!==h&&h,b=n.padding,v=void 0===b?0:b,w=_("number"!=typeof v?v:Y(v,T)),k=m===C?"reference":C,S=e.rects.popper,$=e.elements[y?k:m],x=F(i($)?$:$.contextElement||g(e.elements.popper),c,p,s),E=d(e.elements.reference),I=W({reference:E,element:S,strategy:"absolute",placement:a}),D=G(Object.assign({},S,I)),A=m===C?D:E,P={top:x.top-A.top+w.top,bottom:A.bottom-x.bottom+w.bottom,left:x.left-A.left+w.left,right:A.right-x.right+w.right},j=e.modifiersData.offset;if(m===C&&j){var z=j[a];Object.keys(P).forEach((function(e){var t=[O,M].indexOf(e)>=0?1:-1,i=[L,M].indexOf(e)>=0?"y":"x";P[e]+=z[i]*t}))}return P}var K={placement:"bottom",modifiers:[],strategy:"absolute"};function J(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function Q(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,o=void 0===n?[]:n,a=t.defaultOptions,r=void 0===a?K:a;return function(e,t,n){void 0===n&&(n=r);var a,s,l={placement:"bottom",orderedModifiers:[],options:Object.assign({},K,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],d=!1,u={state:l,setOptions:function(n){var a="function"==typeof n?n(l.options):n;p(),l.options=Object.assign({},r,l.options,a),l.scrollParents={reference:i(e)?k(e):e.contextElement?k(e.contextElement):[],popper:k(t)};var s,d,g=function(e){var t=R(e);return z.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}((s=[].concat(o,l.options.modifiers),d=s.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{}),Object.keys(d).map((function(e){return d[e]}))));return l.orderedModifiers=g.filter((function(e){return e.enabled})),l.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,n=void 0===i?{}:i,o=e.effect;if("function"==typeof o){var a=o({state:l,name:t,instance:u,options:n});c.push(a||function(){})}})),u.update()},forceUpdate:function(){if(!d){var e=l.elements,t=e.reference,i=e.popper;if(J(t,i)){l.rects={reference:y(t,x(i),"fixed"===l.options.strategy),popper:b(i)},l.reset=!1,l.placement=l.options.placement,l.orderedModifiers.forEach((function(e){return l.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<l.orderedModifiers.length;n++)if(!0!==l.reset){var o=l.orderedModifiers[n],a=o.fn,r=o.options,s=void 0===r?{}:r,c=o.name;"function"==typeof a&&(l=a({state:l,options:s,name:c,instance:u})||l)}else l.reset=!1,n=-1}}},update:(a=function(){return new Promise((function(e){u.forceUpdate(),e(l)}))},function(){return s||(s=new Promise((function(e){Promise.resolve().then((function(){s=void 0,e(a())}))}))),s}),destroy:function(){p(),d=!0}};if(!J(e,t))return u;function p(){c.forEach((function(e){return e()})),c=[]}return u.setOptions(n).then((function(e){!d&&n.onFirstUpdate&&n.onFirstUpdate(e)})),u}}var Z={passive:!0},ee={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var i=e.state,n=e.instance,o=e.options,a=o.scroll,r=void 0===a||a,s=o.resize,l=void 0===s||s,c=t(i.elements.popper),d=[].concat(i.scrollParents.reference,i.scrollParents.popper);return r&&d.forEach((function(e){e.addEventListener("scroll",n.update,Z)})),l&&c.addEventListener("resize",n.update,Z),function(){r&&d.forEach((function(e){e.removeEventListener("scroll",n.update,Z)})),l&&c.removeEventListener("resize",n.update,Z)}},data:{}},te={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=W({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},ie={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ne(e){var i,n=e.popper,o=e.popperRect,a=e.placement,r=e.variation,l=e.offsets,c=e.position,d=e.gpuAcceleration,u=e.adaptive,p=e.roundOffsets,f=e.isFixed,h=l.x,y=void 0===h?0:h,b=l.y,v=void 0===b?0:b,w="function"==typeof p?p({x:y,y:v}):{x:y,y:v};y=w.x,v=w.y;var k=l.hasOwnProperty("x"),S=l.hasOwnProperty("y"),$=E,I=L,T=window;if(u){var D=x(n),q="clientHeight",C="clientWidth";D===t(n)&&"static"!==m(D=g(n)).position&&"absolute"===c&&(q="scrollHeight",C="scrollWidth"),(a===L||(a===E||a===O)&&r===A)&&(I=M,v-=(f&&D===T&&T.visualViewport?T.visualViewport.height:D[q])-o.height,v*=d?1:-1),a!==E&&(a!==L&&a!==M||r!==A)||($=O,y-=(f&&D===T&&T.visualViewport?T.visualViewport.width:D[C])-o.width,y*=d?1:-1)}var P,j=Object.assign({position:c},u&&ie),z=!0===p?function(e){var t=e.x,i=e.y,n=window.devicePixelRatio||1;return{x:s(t*n)/n||0,y:s(i*n)/n||0}}({x:y,y:v}):{x:y,y:v};return y=z.x,v=z.y,d?Object.assign({},j,((P={})[I]=S?"0":"",P[$]=k?"0":"",P.transform=(T.devicePixelRatio||1)<=1?"translate("+y+"px, "+v+"px)":"translate3d("+y+"px, "+v+"px, 0)",P)):Object.assign({},j,((i={})[I]=S?v+"px":"",i[$]=k?y+"px":"",i.transform="",i))}var oe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,n=i.gpuAcceleration,o=void 0===n||n,a=i.adaptive,r=void 0===a||a,s=i.roundOffsets,l=void 0===s||s,c={placement:N(t.placement),variation:U(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:o,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,ne(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:r,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,ne(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},ae={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},o=t.attributes[e]||{},a=t.elements[e];n(a)&&p(a)&&(Object.assign(a.style,i),Object.keys(o).forEach((function(e){var t=o[e];!1===t?a.removeAttribute(e):a.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var o=t.elements[e],a=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});n(o)&&p(o)&&(Object.assign(o.style,r),Object.keys(a).forEach((function(e){o.removeAttribute(e)})))}))}},requires:["computeStyles"]},re={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.options,n=e.name,o=i.offset,a=void 0===o?[0,0]:o,r=j.reduce((function(e,i){return e[i]=function(e,t,i){var n=N(e),o=[E,L].indexOf(n)>=0?-1:1,a="function"==typeof i?i(Object.assign({},t,{placement:e})):i,r=a[0],s=a[1];return r=r||0,s=(s||0)*o,[E,O].indexOf(n)>=0?{x:s,y:r}:{x:r,y:s}}(i,t.rects,a),e}),{}),s=r[t.placement],l=s.x,c=s.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[n]=r}},se={left:"right",right:"left",bottom:"top",top:"bottom"};function le(e){return e.replace(/left|right|bottom|top/g,(function(e){return se[e]}))}var ce={start:"end",end:"start"};function de(e){return e.replace(/start|end/g,(function(e){return ce[e]}))}function ue(e,t){void 0===t&&(t={});var i=t,n=i.placement,o=i.boundary,a=i.rootBoundary,r=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?j:l,d=U(n),u=d?s?P:P.filter((function(e){return U(e)===d})):T,p=u.filter((function(e){return c.indexOf(e)>=0}));0===p.length&&(p=u);var g=p.reduce((function(t,i){return t[i]=X(e,{placement:i,boundary:o,rootBoundary:a,padding:r})[N(i)],t}),{});return Object.keys(g).sort((function(e,t){return g[e]-g[t]}))}var pe={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var o=i.mainAxis,a=void 0===o||o,r=i.altAxis,s=void 0===r||r,l=i.fallbackPlacements,c=i.padding,d=i.boundary,u=i.rootBoundary,p=i.altBoundary,g=i.flipVariations,f=void 0===g||g,m=i.allowedAutoPlacements,h=t.options.placement,y=N(h),b=l||(y!==h&&f?function(e){if(N(e)===I)return[];var t=le(e);return[de(e),t,de(t)]}(h):[le(h)]),v=[h].concat(b).reduce((function(e,i){return e.concat(N(i)===I?ue(t,{placement:i,boundary:d,rootBoundary:u,padding:c,flipVariations:f,allowedAutoPlacements:m}):i)}),[]),w=t.rects.reference,k=t.rects.popper,S=new Map,$=!0,x=v[0],T=0;T<v.length;T++){var A=v[T],q=N(A),C=U(A)===D,P=[L,M].indexOf(q)>=0,j=P?"width":"height",z=X(t,{placement:A,boundary:d,rootBoundary:u,altBoundary:p,padding:c}),R=P?C?O:E:C?M:L;w[j]>k[j]&&(R=le(R));var H=le(R),G=[];if(a&&G.push(z[q]<=0),s&&G.push(z[R]<=0,z[H]<=0),G.every((function(e){return e}))){x=A,$=!1;break}S.set(A,G)}if($)for(var V=function(e){var t=v.find((function(t){var i=S.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},F=f?3:1;F>0&&"break"!==V(F);F--);t.placement!==x&&(t.modifiersData[n]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function ge(e,t,i){return a(e,r(t,i))}var fe={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,n=e.name,o=i.mainAxis,s=void 0===o||o,l=i.altAxis,c=void 0!==l&&l,d=i.boundary,u=i.rootBoundary,p=i.altBoundary,g=i.padding,f=i.tether,m=void 0===f||f,h=i.tetherOffset,y=void 0===h?0:h,v=X(t,{boundary:d,rootBoundary:u,padding:g,altBoundary:p}),w=N(t.placement),k=U(t.placement),S=!k,$=B(w),I="x"===$?"y":"x",T=t.modifiersData.popperOffsets,A=t.rects.reference,q=t.rects.popper,C="function"==typeof y?y(Object.assign({},t.rects,{placement:t.placement})):y,P="number"==typeof C?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),j=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,z={x:0,y:0};if(T){if(s){var R,H="y"===$?L:E,G="y"===$?M:O,V="y"===$?"height":"width",F=T[$],W=F+v[H],_=F-v[G],Y=m?-q[V]/2:0,K=k===D?A[V]:q[V],J=k===D?-q[V]:-A[V],Q=t.elements.arrow,Z=m&&Q?b(Q):{width:0,height:0},ee=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},te=ee[H],ie=ee[G],ne=ge(0,A[V],Z[V]),oe=S?A[V]/2-Y-ne-te-P.mainAxis:K-ne-te-P.mainAxis,ae=S?-A[V]/2+Y+ne+ie+P.mainAxis:J+ne+ie+P.mainAxis,re=t.elements.arrow&&x(t.elements.arrow),se=re?"y"===$?re.clientTop||0:re.clientLeft||0:0,le=null!=(R=null==j?void 0:j[$])?R:0,ce=F+ae-le,de=ge(m?r(W,F+oe-le-se):W,F,m?a(_,ce):_);T[$]=de,z[$]=de-F}if(c){var ue,pe="x"===$?L:E,fe="x"===$?M:O,me=T[I],he="y"===I?"height":"width",ye=me+v[pe],be=me-v[fe],ve=-1!==[L,E].indexOf(w),we=null!=(ue=null==j?void 0:j[I])?ue:0,ke=ve?ye:me-A[he]-q[he]-we+P.altAxis,Se=ve?me+A[he]+q[he]-we-P.altAxis:be,$e=m&&ve?function(e,t,i){var n=ge(e,t,i);return n>i?i:n}(ke,me,Se):ge(m?ke:ye,me,m?Se:be);T[I]=$e,z[I]=$e-me}t.modifiersData[n]=z}},requiresIfExists:["offset"]},me={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,n=e.name,o=e.options,a=i.elements.arrow,r=i.modifiersData.popperOffsets,s=N(i.placement),l=B(s),c=[E,O].indexOf(s)>=0?"height":"width";if(a&&r){var d=function(e,t){return _("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Y(e,T))}(o.padding,i),u=b(a),p="y"===l?L:E,g="y"===l?M:O,f=i.rects.reference[c]+i.rects.reference[l]-r[l]-i.rects.popper[c],m=r[l]-i.rects.reference[l],h=x(a),y=h?"y"===l?h.clientHeight||0:h.clientWidth||0:0,v=f/2-m/2,w=d[p],k=y-u[c]-d[g],S=y/2-u[c]/2+v,$=ge(w,S,k),I=l;i.modifiersData[n]=((t={})[I]=$,t.centerOffset=$-S,t)}},effect:function(e){var t=e.state,i=e.options.element,n=void 0===i?"[data-popper-arrow]":i;null!=n&&("string"!=typeof n||(n=t.elements.popper.querySelector(n)))&&H(t.elements.popper,n)&&(t.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function he(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function ye(e){return[L,O,M,E].some((function(t){return e[t]>=0}))}var be={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,n=t.rects.reference,o=t.rects.popper,a=t.modifiersData.preventOverflow,r=X(t,{elementContext:"reference"}),s=X(t,{altBoundary:!0}),l=he(r,n),c=he(s,o,a),d=ye(l),u=ye(c);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}},ve=Q({defaultModifiers:[ee,te,oe,ae]}),we=[ee,te,oe,ae,re,pe,fe,me,be],ke=Q({defaultModifiers:we});e.applyStyles=ae,e.arrow=me,e.computeStyles=oe,e.createPopper=ke,e.createPopperLite=ve,e.defaultModifiers=we,e.detectOverflow=X,e.eventListeners=ee,e.flip=pe,e.hide=be,e.offset=re,e.popperGenerator=Q,e.popperOffsets=te,e.preventOverflow=fe,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).Popper={}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@popperjs/core")):"function"==typeof define&&define.amd?define(["@popperjs/core"],t):(e=e||self).tippy=t(e.Popper)}(void 0,(function(e){var t="undefined"!=typeof window&&"undefined"!=typeof document,i=!!t&&!!window.msCrypto,n={passive:!0,capture:!0},o=function(){return document.body};function a(e,t,i){if(Array.isArray(e)){var n=e[t];return null==n?Array.isArray(i)?i[t]:i:n}return e}function r(e,t){var i={}.toString.call(e);return 0===i.indexOf("[object")&&i.indexOf(t+"]")>-1}function s(e,t){return"function"==typeof e?e.apply(void 0,t):e}function l(e,t){return 0===t?e:function(n){clearTimeout(i),i=setTimeout((function(){e(n)}),t)};var i}function c(e,t){var i=Object.assign({},e);return t.forEach((function(e){delete i[e]})),i}function d(e){return[].concat(e)}function u(e,t){-1===e.indexOf(t)&&e.push(t)}function p(e){return e.split("-")[0]}function g(e){return[].slice.call(e)}function f(e){return Object.keys(e).reduce((function(t,i){return void 0!==e[i]&&(t[i]=e[i]),t}),{})}function m(){return document.createElement("div")}function h(e){return["Element","Fragment"].some((function(t){return r(e,t)}))}function y(e){return r(e,"MouseEvent")}function b(e){return!(!e||!e._tippy||e._tippy.reference!==e)}function v(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function w(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function k(e){var t,i=d(e)[0];return null!=i&&null!=(t=i.ownerDocument)&&t.body?i.ownerDocument:document}function S(e,t,i){var n=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[n](t,i)}))}function $(e,t){for(var i=t;i;){var n;if(e.contains(i))return!0;i=null==i.getRootNode||null==(n=i.getRootNode())?void 0:n.host}return!1}var x={isTouch:!1},L=0;function M(){x.isTouch||(x.isTouch=!0,window.performance&&document.addEventListener("mousemove",O))}function O(){var e=performance.now();e-L<20&&(x.isTouch=!1,document.removeEventListener("mousemove",O)),L=e}function E(){var e=document.activeElement;if(b(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var I=Object.assign({appendTo:o,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),T=Object.keys(I);function D(e){var t=(e.plugins||[]).reduce((function(t,i){var n,o=i.name,a=i.defaultValue;return o&&(t[o]=void 0!==e[o]?e[o]:null!=(n=I[o])?n:a),t}),{});return Object.assign({},e,t)}function A(e,t){var i=Object.assign({},t,{content:s(t.content,[e])},t.ignoreAttributes?{}:function(e,t){return(t?Object.keys(D(Object.assign({},I,{plugins:t}))):T).reduce((function(t,i){var n=(e.getAttribute("data-tippy-"+i)||"").trim();if(!n)return t;if("content"===i)t[i]=n;else try{t[i]=JSON.parse(n)}catch(e){t[i]=n}return t}),{})}(e,t.plugins));return i.aria=Object.assign({},I.aria,i.aria),i.aria={expanded:"auto"===i.aria.expanded?t.interactive:i.aria.expanded,content:"auto"===i.aria.content?t.interactive?null:"describedby":i.aria.content},i}function q(e,t){e.innerHTML=t}function C(e){var t=m();return!0===e?t.className="tippy-arrow":(t.className="tippy-svg-arrow",h(e)?t.appendChild(e):q(t,e)),t}function P(e,t){h(t.content)?(q(e,""),e.appendChild(t.content)):"function"!=typeof t.content&&(t.allowHTML?q(e,t.content):e.textContent=t.content)}function j(e){var t=e.firstElementChild,i=g(t.children);return{box:t,content:i.find((function(e){return e.classList.contains("tippy-content")})),arrow:i.find((function(e){return e.classList.contains("tippy-arrow")||e.classList.contains("tippy-svg-arrow")})),backdrop:i.find((function(e){return e.classList.contains("tippy-backdrop")}))}}function z(e){var t=m(),i=m();i.className="tippy-box",i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=m();function o(i,n){var o=j(t),a=o.box,r=o.content,s=o.arrow;n.theme?a.setAttribute("data-theme",n.theme):a.removeAttribute("data-theme"),"string"==typeof n.animation?a.setAttribute("data-animation",n.animation):a.removeAttribute("data-animation"),n.inertia?a.setAttribute("data-inertia",""):a.removeAttribute("data-inertia"),a.style.maxWidth="number"==typeof n.maxWidth?n.maxWidth+"px":n.maxWidth,n.role?a.setAttribute("role",n.role):a.removeAttribute("role"),i.content===n.content&&i.allowHTML===n.allowHTML||P(r,e.props),n.arrow?s?i.arrow!==n.arrow&&(a.removeChild(s),a.appendChild(C(n.arrow))):a.appendChild(C(n.arrow)):s&&a.removeChild(s)}return n.className="tippy-content",n.setAttribute("data-state","hidden"),P(n,e.props),t.appendChild(i),i.appendChild(n),o(e.props,e.props),{popper:t,onUpdate:o}}z.$$tippy=!0;var R=1,N=[],H=[];function G(t,r){var c,h,b,L,M,O,E,T,q=A(t,Object.assign({},I,D(f(r)))),C=!1,P=!1,z=!1,G=!1,V=[],F=l(we,q.interactiveDebounce),U=R++,B=(T=q.plugins).filter((function(e,t){return T.indexOf(e)===t})),W={id:U,reference:t,popper:m(),popperInstance:null,props:q,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:B,clearDelayTimeouts:function(){clearTimeout(c),clearTimeout(h),cancelAnimationFrame(b)},setProps:function(e){if(!W.state.isDestroyed){re("onBeforeUpdate",[W,e]),be();var i=W.props,n=A(t,Object.assign({},i,f(e),{ignoreAttributes:!0}));W.props=n,ye(),i.interactiveDebounce!==n.interactiveDebounce&&(ce(),F=l(we,n.interactiveDebounce)),i.triggerTarget&&!n.triggerTarget?d(i.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):n.triggerTarget&&t.removeAttribute("aria-expanded"),le(),ae(),X&&X(i,n),W.popperInstance&&(xe(),Me().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),re("onAfterUpdate",[W,e])}},setContent:function(e){W.setProps({content:e})},show:function(){var e=W.state.isVisible,t=W.state.isDestroyed,i=!W.state.isEnabled,n=x.isTouch&&!W.props.touch,r=a(W.props.duration,0,I.duration);if(!(e||t||i||n||te().hasAttribute("disabled")||(re("onShow",[W],!1),!1===W.props.onShow(W)))){if(W.state.isVisible=!0,ee()&&(Y.style.visibility="visible"),ae(),ge(),W.state.isMounted||(Y.style.transition="none"),ee()){var l=ne();v([l.box,l.content],0)}O=function(){var e;if(W.state.isVisible&&!G){if(G=!0,Y.offsetHeight,Y.style.transition=W.props.moveTransition,ee()&&W.props.animation){var t=ne(),i=t.box,n=t.content;v([i,n],r),w([i,n],"visible")}se(),le(),u(H,W),null==(e=W.popperInstance)||e.forceUpdate(),re("onMount",[W]),W.props.animation&&ee()&&function(e,t){me(e,(function(){W.state.isShown=!0,re("onShown",[W])}))}(r)}},function(){var e,t=W.props.appendTo,i=te();(e=W.props.interactive&&t===o||"parent"===t?i.parentNode:s(t,[i])).contains(Y)||e.appendChild(Y),W.state.isMounted=!0,xe()}()}},hide:function(){var e=!W.state.isVisible,t=W.state.isDestroyed,i=!W.state.isEnabled,n=a(W.props.duration,1,I.duration);if(!(e||t||i)&&(re("onHide",[W],!1),!1!==W.props.onHide(W))){if(W.state.isVisible=!1,W.state.isShown=!1,G=!1,C=!1,ee()&&(Y.style.visibility="hidden"),ce(),fe(),ae(!0),ee()){var o=ne(),r=o.box,s=o.content;W.props.animation&&(v([r,s],n),w([r,s],"hidden"))}se(),le(),W.props.animation?ee()&&function(e,t){me(e,(function(){!W.state.isVisible&&Y.parentNode&&Y.parentNode.contains(Y)&&t()}))}(n,W.unmount):W.unmount()}},hideWithInteractivity:function(e){ie().addEventListener("mousemove",F),u(N,F),F(e)},enable:function(){W.state.isEnabled=!0},disable:function(){W.hide(),W.state.isEnabled=!1},unmount:function(){W.state.isVisible&&W.hide(),W.state.isMounted&&(Le(),Me().forEach((function(e){e._tippy.unmount()})),Y.parentNode&&Y.parentNode.removeChild(Y),H=H.filter((function(e){return e!==W})),W.state.isMounted=!1,re("onHidden",[W]))},destroy:function(){W.state.isDestroyed||(W.clearDelayTimeouts(),W.unmount(),be(),delete t._tippy,W.state.isDestroyed=!0,re("onDestroy",[W]))}};if(!q.render)return W;var _=q.render(W),Y=_.popper,X=_.onUpdate;Y.setAttribute("data-tippy-root",""),Y.id="tippy-"+W.id,W.popper=Y,t._tippy=W,Y._tippy=W;var K=B.map((function(e){return e.fn(W)})),J=t.hasAttribute("aria-expanded");return ye(),le(),ae(),re("onCreate",[W]),q.showOnCreate&&Oe(),Y.addEventListener("mouseenter",(function(){W.props.interactive&&W.state.isVisible&&W.clearDelayTimeouts()})),Y.addEventListener("mouseleave",(function(){W.props.interactive&&W.props.trigger.indexOf("mouseenter")>=0&&ie().addEventListener("mousemove",F)})),W;function Q(){var e=W.props.touch;return Array.isArray(e)?e:[e,0]}function Z(){return"hold"===Q()[0]}function ee(){var e;return!(null==(e=W.props.render)||!e.$$tippy)}function te(){return E||t}function ie(){var e=te().parentNode;return e?k(e):document}function ne(){return j(Y)}function oe(e){return W.state.isMounted&&!W.state.isVisible||x.isTouch||L&&"focus"===L.type?0:a(W.props.delay,e?0:1,I.delay)}function ae(e){void 0===e&&(e=!1),Y.style.pointerEvents=W.props.interactive&&!e?"":"none",Y.style.zIndex=""+W.props.zIndex}function re(e,t,i){var n;void 0===i&&(i=!0),K.forEach((function(i){i[e]&&i[e].apply(i,t)})),i&&(n=W.props)[e].apply(n,t)}function se(){var e=W.props.aria;if(e.content){var i="aria-"+e.content,n=Y.id;d(W.props.triggerTarget||t).forEach((function(e){var t=e.getAttribute(i);if(W.state.isVisible)e.setAttribute(i,t?t+" "+n:n);else{var o=t&&t.replace(n,"").trim();o?e.setAttribute(i,o):e.removeAttribute(i)}}))}}function le(){!J&&W.props.aria.expanded&&d(W.props.triggerTarget||t).forEach((function(e){W.props.interactive?e.setAttribute("aria-expanded",W.state.isVisible&&e===te()?"true":"false"):e.removeAttribute("aria-expanded")}))}function ce(){ie().removeEventListener("mousemove",F),N=N.filter((function(e){return e!==F}))}function de(e){if(!x.isTouch||!z&&"mousedown"!==e.type){var i=e.composedPath&&e.composedPath()[0]||e.target;if(!W.props.interactive||!$(Y,i)){if(d(W.props.triggerTarget||t).some((function(e){return $(e,i)}))){if(x.isTouch)return;if(W.state.isVisible&&W.props.trigger.indexOf("click")>=0)return}else re("onClickOutside",[W,e]);!0===W.props.hideOnClick&&(W.clearDelayTimeouts(),W.hide(),P=!0,setTimeout((function(){P=!1})),W.state.isMounted||fe())}}}function ue(){z=!0}function pe(){z=!1}function ge(){var e=ie();e.addEventListener("mousedown",de,!0),e.addEventListener("touchend",de,n),e.addEventListener("touchstart",pe,n),e.addEventListener("touchmove",ue,n)}function fe(){var e=ie();e.removeEventListener("mousedown",de,!0),e.removeEventListener("touchend",de,n),e.removeEventListener("touchstart",pe,n),e.removeEventListener("touchmove",ue,n)}function me(e,t){var i=ne().box;function n(e){e.target===i&&(S(i,"remove",n),t())}if(0===e)return t();S(i,"remove",M),S(i,"add",n),M=n}function he(e,i,n){void 0===n&&(n=!1),d(W.props.triggerTarget||t).forEach((function(t){t.addEventListener(e,i,n),V.push({node:t,eventType:e,handler:i,options:n})}))}function ye(){var e;Z()&&(he("touchstart",ve,{passive:!0}),he("touchend",ke,{passive:!0})),(e=W.props.trigger,e.split(/\s+/).filter(Boolean)).forEach((function(e){if("manual"!==e)switch(he(e,ve),e){case"mouseenter":he("mouseleave",ke);break;case"focus":he(i?"focusout":"blur",Se);break;case"focusin":he("focusout",Se)}}))}function be(){V.forEach((function(e){var t=e.node,i=e.eventType,n=e.handler,o=e.options;t.removeEventListener(i,n,o)})),V=[]}function ve(e){var t,i=!1;if(W.state.isEnabled&&!$e(e)&&!P){var n="focus"===(null==(t=L)?void 0:t.type);L=e,E=e.currentTarget,le(),!W.state.isVisible&&y(e)&&N.forEach((function(t){return t(e)})),"click"===e.type&&(W.props.trigger.indexOf("mouseenter")<0||C)&&!1!==W.props.hideOnClick&&W.state.isVisible?i=!0:Oe(e),"click"===e.type&&(C=!i),i&&!n&&Ee(e)}}function we(e){var t=e.target,i=te().contains(t)||Y.contains(t);"mousemove"===e.type&&i||function(e,t){var i=t.clientX,n=t.clientY;return e.every((function(e){var t=e.popperRect,o=e.popperState,a=e.props.interactiveBorder,r=p(o.placement),s=o.modifiersData.offset;if(!s)return!0;var l="bottom"===r?s.top.y:0,c="top"===r?s.bottom.y:0,d="right"===r?s.left.x:0,u="left"===r?s.right.x:0,g=t.top-n+l>a,f=n-t.bottom-c>a,m=t.left-i+d>a,h=i-t.right-u>a;return g||f||m||h}))}(Me().concat(Y).map((function(e){var t,i=null==(t=e._tippy.popperInstance)?void 0:t.state;return i?{popperRect:e.getBoundingClientRect(),popperState:i,props:q}:null})).filter(Boolean),e)&&(ce(),Ee(e))}function ke(e){$e(e)||W.props.trigger.indexOf("click")>=0&&C||(W.props.interactive?W.hideWithInteractivity(e):Ee(e))}function Se(e){W.props.trigger.indexOf("focusin")<0&&e.target!==te()||W.props.interactive&&e.relatedTarget&&Y.contains(e.relatedTarget)||Ee(e)}function $e(e){return!!x.isTouch&&Z()!==e.type.indexOf("touch")>=0}function xe(){Le();var i=W.props,n=i.popperOptions,o=i.placement,a=i.offset,r=i.getReferenceClientRect,s=i.moveTransition,l=ee()?j(Y).arrow:null,c=r?{getBoundingClientRect:r,contextElement:r.contextElement||te()}:t,d=[{name:"offset",options:{offset:a}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!s}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(ee()){var i=ne().box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?i.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?i.setAttribute("data-"+e,""):i.removeAttribute("data-"+e)})),t.attributes.popper={}}}}];ee()&&l&&d.push({name:"arrow",options:{element:l,padding:3}}),d.push.apply(d,(null==n?void 0:n.modifiers)||[]),W.popperInstance=e.createPopper(c,Y,Object.assign({},n,{placement:o,onFirstUpdate:O,modifiers:d}))}function Le(){W.popperInstance&&(W.popperInstance.destroy(),W.popperInstance=null)}function Me(){return g(Y.querySelectorAll("[data-tippy-root]"))}function Oe(e){W.clearDelayTimeouts(),e&&re("onTrigger",[W,e]),ge();var t=oe(!0),i=Q(),n=i[0],o=i[1];x.isTouch&&"hold"===n&&o&&(t=o),t?c=setTimeout((function(){W.show()}),t):W.show()}function Ee(e){if(W.clearDelayTimeouts(),re("onUntrigger",[W,e]),W.state.isVisible){if(!(W.props.trigger.indexOf("mouseenter")>=0&&W.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&C)){var t=oe(!1);t?h=setTimeout((function(){W.state.isVisible&&W.hide()}),t):b=requestAnimationFrame((function(){W.hide()}))}}else fe()}}function V(e,t){void 0===t&&(t={});var i=I.plugins.concat(t.plugins||[]);document.addEventListener("touchstart",M,n),window.addEventListener("blur",E);var o=Object.assign({},t,{plugins:i}),a=function(e){return h(e)?[e]:function(e){return r(e,"NodeList")}(e)?g(e):Array.isArray(e)?e:g(document.querySelectorAll(e))}(e).reduce((function(e,t){var i=t&&G(t,o);return i&&e.push(i),e}),[]);return h(e)?a[0]:a}V.defaultProps=I,V.setDefaultProps=function(e){Object.keys(e).forEach((function(t){I[t]=e[t]}))},V.currentInput=x;var F=Object.assign({},e.applyStyles,{effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow)}}),U={mouseover:"mouseenter",focusin:"focus",click:"click"},B={name:"animateFill",defaultValue:!1,fn:function(e){var t;if(null==(t=e.props.render)||!t.$$tippy)return{};var i=j(e.popper),n=i.box,o=i.content,a=e.props.animateFill?function(){var e=m();return e.className="tippy-backdrop",w([e],"hidden"),e}():null;return{onCreate:function(){a&&(n.insertBefore(a,n.firstElementChild),n.setAttribute("data-animatefill",""),n.style.overflow="hidden",e.setProps({arrow:!1,animation:"shift-away"}))},onMount:function(){if(a){var e=n.style.transitionDuration,t=Number(e.replace("ms",""));o.style.transitionDelay=Math.round(t/10)+"ms",a.style.transitionDuration=e,w([a],"visible")}},onShow:function(){a&&(a.style.transitionDuration="0ms")},onHide:function(){a&&w([a],"hidden")}}}},W={clientX:0,clientY:0},_=[];function Y(e){var t=e.clientX,i=e.clientY;W={clientX:t,clientY:i}}var X={name:"followCursor",defaultValue:!1,fn:function(e){var t=e.reference,i=k(e.props.triggerTarget||t),n=!1,o=!1,a=!0,r=e.props;function s(){return"initial"===e.props.followCursor&&e.state.isVisible}function l(){i.addEventListener("mousemove",u)}function c(){i.removeEventListener("mousemove",u)}function d(){n=!0,e.setProps({getReferenceClientRect:null}),n=!1}function u(i){var n=!i.target||t.contains(i.target),o=e.props.followCursor,a=i.clientX,r=i.clientY,s=t.getBoundingClientRect(),l=a-s.left,c=r-s.top;!n&&e.props.interactive||e.setProps({getReferenceClientRect:function(){var e=t.getBoundingClientRect(),i=a,n=r;"initial"===o&&(i=e.left+l,n=e.top+c);var s="horizontal"===o?e.top:n,d="vertical"===o?e.right:i,u="horizontal"===o?e.bottom:n,p="vertical"===o?e.left:i;return{width:d-p,height:u-s,top:s,right:d,bottom:u,left:p}}})}function p(){e.props.followCursor&&(_.push({instance:e,doc:i}),function(e){e.addEventListener("mousemove",Y)}(i))}function g(){0===(_=_.filter((function(t){return t.instance!==e}))).filter((function(e){return e.doc===i})).length&&function(e){e.removeEventListener("mousemove",Y)}(i)}return{onCreate:p,onDestroy:g,onBeforeUpdate:function(){r=e.props},onAfterUpdate:function(t,i){var a=i.followCursor;n||void 0!==a&&r.followCursor!==a&&(g(),a?(p(),!e.state.isMounted||o||s()||l()):(c(),d()))},onMount:function(){e.props.followCursor&&!o&&(a&&(u(W),a=!1),s()||l())},onTrigger:function(e,t){y(t)&&(W={clientX:t.clientX,clientY:t.clientY}),o="focus"===t.type},onHidden:function(){e.props.followCursor&&(d(),c(),a=!0)}}}},K={name:"inlinePositioning",defaultValue:!1,fn:function(e){var t,i=e.reference,n=-1,o=!1,a=[],r={name:"tippyInlinePositioning",enabled:!0,phase:"afterWrite",fn:function(o){var r=o.state;e.props.inlinePositioning&&(-1!==a.indexOf(r.placement)&&(a=[]),t!==r.placement&&-1===a.indexOf(r.placement)&&(a.push(r.placement),e.setProps({getReferenceClientRect:function(){return function(e){return function(e,t,i,n){if(i.length<2||null===e)return t;if(2===i.length&&n>=0&&i[0].left>i[1].right)return i[n]||t;switch(e){case"top":case"bottom":var o=i[0],a=i[i.length-1],r="top"===e,s=o.top,l=a.bottom,c=r?o.left:a.left,d=r?o.right:a.right;return{top:s,bottom:l,left:c,right:d,width:d-c,height:l-s};case"left":case"right":var u=Math.min.apply(Math,i.map((function(e){return e.left}))),p=Math.max.apply(Math,i.map((function(e){return e.right}))),g=i.filter((function(t){return"left"===e?t.left===u:t.right===p})),f=g[0].top,m=g[g.length-1].bottom;return{top:f,bottom:m,left:u,right:p,width:p-u,height:m-f};default:return t}}(p(e),i.getBoundingClientRect(),g(i.getClientRects()),n)}(r.placement)}})),t=r.placement)}};function s(){var t;o||(t=function(e,t){var i;return{popperOptions:Object.assign({},e.popperOptions,{modifiers:[].concat(((null==(i=e.popperOptions)?void 0:i.modifiers)||[]).filter((function(e){return e.name!==t.name})),[t])})}}(e.props,r),o=!0,e.setProps(t),o=!1)}return{onCreate:s,onAfterUpdate:s,onTrigger:function(t,i){if(y(i)){var o=g(e.reference.getClientRects()),a=o.find((function(e){return e.left-2<=i.clientX&&e.right+2>=i.clientX&&e.top-2<=i.clientY&&e.bottom+2>=i.clientY})),r=o.indexOf(a);n=r>-1?r:n}},onHidden:function(){n=-1}}}},J={name:"sticky",defaultValue:!1,fn:function(e){var t=e.reference,i=e.popper;function n(t){return!0===e.props.sticky||e.props.sticky===t}var o=null,a=null;function r(){var s=n("reference")?(e.popperInstance?e.popperInstance.state.elements.reference:t).getBoundingClientRect():null,l=n("popper")?i.getBoundingClientRect():null;(s&&Q(o,s)||l&&Q(a,l))&&e.popperInstance&&e.popperInstance.update(),o=s,a=l,e.state.isMounted&&requestAnimationFrame(r)}return{onMount:function(){e.props.sticky&&r()}}}};function Q(e,t){return!e||!t||e.top!==t.top||e.right!==t.right||e.bottom!==t.bottom||e.left!==t.left}return t&&function(e){var t=document.createElement("style");t.textContent='.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:transparent;border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}',t.setAttribute("data-tippy-stylesheet","");var i=document.head,n=document.querySelector("head>style,head>link");n?i.insertBefore(t,n):i.appendChild(t)}(),V.setDefaultProps({plugins:[B,X,K,J],render:z}),V.createSingleton=function(e,t){var i;void 0===t&&(t={});var n,o=e,a=[],r=[],s=t.overrides,l=[],u=!1;function p(){r=o.map((function(e){return d(e.props.triggerTarget||e.reference)})).reduce((function(e,t){return e.concat(t)}),[])}function g(){a=o.map((function(e){return e.reference}))}function f(e){o.forEach((function(t){e?t.enable():t.disable()}))}function h(e){return o.map((function(t){var i=t.setProps;return t.setProps=function(o){i(o),t.reference===n&&e.setProps(o)},function(){t.setProps=i}}))}function y(e,t){var i=r.indexOf(t);if(t!==n){n=t;var l=(s||[]).concat("content").reduce((function(e,t){return e[t]=o[i].props[t],e}),{});e.setProps(Object.assign({},l,{getReferenceClientRect:"function"==typeof l.getReferenceClientRect?l.getReferenceClientRect:function(){var e;return null==(e=a[i])?void 0:e.getBoundingClientRect()}}))}}f(!1),g(),p();var b={fn:function(){return{onDestroy:function(){f(!0)},onHidden:function(){n=null},onClickOutside:function(e){e.props.showOnCreate&&!u&&(u=!0,n=null)},onShow:function(e){e.props.showOnCreate&&!u&&(u=!0,y(e,a[0]))},onTrigger:function(e,t){y(e,t.currentTarget)}}}},v=V(m(),Object.assign({},c(t,["overrides"]),{plugins:[b].concat(t.plugins||[]),triggerTarget:r,popperOptions:Object.assign({},t.popperOptions,{modifiers:[].concat((null==(i=t.popperOptions)?void 0:i.modifiers)||[],[F])})})),w=v.show;v.show=function(e){if(w(),!n&&null==e)return y(v,a[0]);if(!n||null!=e){if("number"==typeof e)return a[e]&&y(v,a[e]);if(o.indexOf(e)>=0){var t=e.reference;return y(v,t)}return a.indexOf(e)>=0?y(v,e):void 0}},v.showNext=function(){var e=a[0];if(!n)return v.show(0);var t=a.indexOf(n);v.show(a[t+1]||e)},v.showPrevious=function(){var e=a[a.length-1];if(!n)return v.show(e);var t=a.indexOf(n),i=a[t-1]||e;v.show(i)};var k=v.setProps;return v.setProps=function(e){s=e.overrides||s,k(e)},v.setInstances=function(e){f(!0),l.forEach((function(e){return e()})),o=e,f(!1),g(),p(),l=h(v),v.setProps({triggerTarget:r})},l=h(v),v},V.delegate=function(e,t){var i=[],o=[],a=!1,r=t.target,s=c(t,["target"]),l=Object.assign({},s,{trigger:"manual",touch:!1}),u=Object.assign({touch:I.touch},s,{showOnCreate:!0}),p=V(e,l);function g(e){if(e.target&&!a){var i=e.target.closest(r);if(i){var n=i.getAttribute("data-tippy-trigger")||t.trigger||I.trigger;if(!i._tippy&&!("touchstart"===e.type&&"boolean"==typeof u.touch||"touchstart"!==e.type&&n.indexOf(U[e.type])<0)){var s=V(i,u);s&&(o=o.concat(s))}}}}function f(e,t,n,o){void 0===o&&(o=!1),e.addEventListener(t,n,o),i.push({node:e,eventType:t,handler:n,options:o})}return d(p).forEach((function(e){var t=e.destroy,r=e.enable,s=e.disable;e.destroy=function(e){void 0===e&&(e=!0),e&&o.forEach((function(e){e.destroy()})),o=[],i.forEach((function(e){var t=e.node,i=e.eventType,n=e.handler,o=e.options;t.removeEventListener(i,n,o)})),i=[],t()},e.enable=function(){r(),o.forEach((function(e){return e.enable()})),a=!1},e.disable=function(){s(),o.forEach((function(e){return e.disable()})),a=!0},function(e){var t=e.reference;f(t,"touchstart",g,n),f(t,"mouseover",g),f(t,"focusin",g),f(t,"click",g)}(e)})),p},V.hideAll=function(e){var t=void 0===e?{}:e,i=t.exclude,n=t.duration;H.forEach((function(e){var t=!1;if(i&&(t=b(i)?e.reference===i:e.popper===i.popper),!t){var o=e.props.duration;e.setProps({duration:n}),e.hide(),e.state.isDestroyed||e.setProps({duration:o})}}))},V.roundArrow='<svg width="16" height="6" xmlns="http://www.w3.org/2000/svg"><path d="M0 6s1.796-.013 4.67-3.615C5.851.9 6.93.006 8 0c1.07-.006 2.148.887 3.343 2.385C14.233 6.005 16 6 16 6H0z"></svg>',V}));const r="undefined"==typeof require,s=r?window.fetch:require("../src/fetch");let l=function(){function e(t,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=t,this.sheetName=i}var t;return function(e,t,i){t&&a(e.prototype,t),i&&a(e,i)}(e,[{key:"getSpreadsheetDataUsingFetch",value:function(){if(!this.id)return null;let e=`https://docs.google.com/spreadsheets/d/${this.id}/gviz/tq?`;return this.sheetName&&(e=e.concat(`sheet=${this.sheetName}`)),s(e).then((e=>e&&e.ok&&e.text?e.text():null)).catch((e=>null))}},{key:"normalizeRow",value:function(e){return e.map((e=>e&&null!==e.v&&void 0!==e.v?e:{}))}},{key:"applyHeaderIntoRows",value:function(e,t){return t.map((({c:e})=>this.normalizeRow(e))).map((t=>t.reduce(((t,i,n)=>i.v?Object.assign(t,{[e[n]]:i.v}):t),{})))}},{key:"getItems",value:function(e){let t=[];try{const i=JSON.parse(e.split("\n")[1].replace(/google.visualization.Query.setResponse\(|\);/g,""));if(i.table.cols.some((({label:e})=>!!e))){const e=i.table.cols.map((({label:e})=>e));t=this.applyHeaderIntoRows(e,i.table.rows)}else{const[e,...n]=i.table.rows,o=this.normalizeRow(e.c).map((e=>e.v));t=this.applyHeaderIntoRows(o,n)}}catch(e){}return t}},{key:"parse",value:(t=o((function*(e,t){if(e&&(this.id=e),t&&(this.sheetName=t),!this.id)throw new Error("SpreadsheetId is required.");const i=yield this.getSpreadsheetDataUsingFetch();return null===i?[]:this.getItems(i)})),function(e,i){return t.apply(this,arguments)})}]),e}();r?window.PublicGoogleSheetsParser=l:(module.exports=l,module.exports.default=l);class c extends FormApplication{constructor(e){super(),this.items=e,this.IsSystem=Object.values(e)[0]?.isSystem??!1}static get defaultOptions(){return mergeObject(super.defaultOptions,{title:e.TITLE,id:`${e.ID}-dialog`,classes:["sheet","journal-sheet","journal-entry"],popOut:!0,resizable:!0,template:`./modules/${e.ID}/templates/preview.hbs`,width:$(window).width()>960?960:$(window).width()-100,height:$(window).height()>800?800:$(window).height()-100})}getData(){return{DIALOG:{ID:e.ID,TITLE:e.TITLE},items:this.items,IsMultipleItems:Object.keys(this.items).length>1,IsGM:game.user.isGM}}activateListeners(t){super.activateListeners(t);const i=t[0].querySelectorAll("aside.sidebar nav ol.directory-list li.directory-item");i.forEach((n=>{n.querySelectorAll("span").forEach((n=>{n.addEventListener("click",(n=>{const o=n.target.closest("li");i.forEach((e=>e.classList.remove("active"))),o.classList.add("active"),game.modules.get(e.ID).API.getContent(this.IsSystem?game.system:game.modules.get(o.dataset.moduleId),o.dataset.fileType,{dir:this.IsSystem?"systems":"modules"}).then((i=>{let n=(new showdown.Converter).makeHtml(i);t[0].querySelector("section.journal-entry-content .journal-header input.title").value=(this.IsSystem?game.system:game.modules.get(o.dataset.moduleId)).title,t[0].querySelector("section.journal-entry-content .journal-entry-page").innerHTML=n,o.querySelector(".page-ownership i.fa-regular").classList.remove("fa-eye-slash"),o.querySelector(".page-ownership i.fa-regular").classList.add("fa-eye"),o.querySelector(".page-ownership").classList.add("observer"),game.user.isGM&&e.setting("trackedChangelogs")[o.dataset.moduleId]&&e.setting("trackedChangelogs",foundry.utils.mergeObject(e.setting("trackedChangelogs"),{[o.dataset.moduleId]:{hasSeen:!0}}))})).catch((t=>{e.error(t)})),t[0].querySelectorAll("aside.sidebar .action-buttons button").forEach((e=>e.disabled=!1)),i[0].classList.contains("active")&&(t[0].querySelector('aside.sidebar .action-buttons button[data-action="previous"]').disabled=!0),i[i.length-1].classList.contains("active")&&(t[0].querySelector('aside.sidebar .action-buttons button[data-action="next"]').disabled=!0)}))}))}));t[0].querySelector("aside.sidebar .directory-header a.action-button.collapse-toggle").addEventListener("click",(e=>{const i=t[0].closest(".app"),n=i.querySelector(".sidebar"),o=n.querySelector(".collapse-toggle"),a=!n.classList.contains("collapsed");i.style.pointerEvents="none",i.classList.add("collapsing"),i.addEventListener("transitionend",(()=>{i.style.pointerEvents="",i.classList.remove("collapsing")}),{once:!0});const r=getComputedStyle(n),s=Number(r.getPropertyValue("--sidebar-width-expanded").trim().replace("px",""))-Number(r.getPropertyValue("--sidebar-width-collapsed").trim().replace("px",""));this.setPosition({left:this.position.left+(a?s:-s),width:this.position.width+(a?-s:s)}),n.classList.toggle("collapsed",a),o.dataset.tooltip=a?"JOURNAL.ViewExpand":"JOURNAL.ViewCollapse";o.children[0].setAttribute("class","fa-solid "+(a?"fa-caret-left":"fa-caret-right")),game.tooltip.deactivate()}));t[0].querySelector('aside.sidebar .directory-header input[type="text"]').addEventListener("keyup",(e=>{const t=e.target.value.toLowerCase();i.forEach((e=>{e.classList.remove("hidden"),""==t?e.classList.remove("hidden"):-1!=e.querySelector(".page-title").textContent.toLowerCase().indexOf(t)||e.classList.contains("active")||e.classList.add("hidden")}))}));const n=t[0].querySelector('aside.sidebar .action-buttons button[data-action="next"]'),o=t[0].querySelector('aside.sidebar .action-buttons button[data-action="previous"]');n.addEventListener("click",(e=>{t[0].querySelector("aside.sidebar nav ol.directory-list li.directory-item.active").nextElementSibling.querySelector(".page-title").click()})),o.addEventListener("click",(e=>{t[0].querySelector("aside.sidebar nav ol.directory-list li.directory-item.active").previousElementSibling.querySelector(".page-title").click()}));t[0].querySelector('aside.sidebar .action-buttons button[data-action="markAsSeen"]').addEventListener("click",(i=>{let n=e.setting("trackedChangelogs");for(let e in n)n[e].hasSeen=!0,t[0].querySelector(`aside.sidebar nav ol.directory-list li[data-module-id="${e}"]`)&&(t[0].querySelector(`aside.sidebar nav ol.directory-list li[data-module-id="${e}"] span.page-ownership`).classList.add("observer"),t[0].querySelector(`aside.sidebar nav ol.directory-list li[data-module-id="${e}"] span.page-ownership i`).classList.remove("fa-eye-slash"),t[0].querySelector(`aside.sidebar nav ol.directory-list li[data-module-id="${e}"] span.page-ownership i`).classList.add("fa-eye"));e.setting("trackedChangelogs",n)})),i[0].querySelector(".page-title").click()}async _updateObject(e,t){console.log(t.exampleInput)}}class d extends FormApplication{constructor(e){super();let t={};$(e).each(((e,i)=>{if($(i).find('input[type="checkbox"]').is(":checked")){let e=$(i).data("module-id");t[e]={title:game.modules.get(e)?.data?.title??"",version:game.modules.get(e)?.data?.version??"0.0.0",bugs:game.modules.get(e)?.data?.bugs??!1,settings:{}}}}));for(const[e,i]of game.settings.settings)t.hasOwnProperty(i.namespace)&&(t[i.namespace].settings.hasOwnProperty(i.scope)||(t[i.namespace].settings[i.scope]={}),t[i.namespace].settings[i.scope][i.key]=game.settings.storage.get(i.scope).getItem(`${i.namespace}.${i.key}`));this.moduleData=t}static get defaultOptions(){return{...super.defaultOptions,title:`${e.TITLE} - ${e.localize("dialog.titles.export")}`,id:`${e.ID}-export-dialog`,classes:["dialog"],template:`./modules/${e.ID}/templates/export.hbs`,resizable:!1,width:$(window).width()>400?400:$(window).width()-100,height:$(window).height()>275?275:$(window).height()-100}}getData(){return{DIALOG:{ID:e.ID,TITLE:e.TITLE},activeModules:()=>{let t=[`### ${e.localize("dialog.generic.activeModules")}`];for(const[i,n]of Object.entries(this.moduleData))t.push(`${n.title} v${n.version}`+(n.bugs?` [${e.localize("dialog.export.bugsUrl")}](${n.bugs})`:""));return t.join("\n")}}}activateListeners(t){super.activateListeners(t),$(t).find('[data-button="copy"]').on("click",(i=>{$(t).find(`#${e.ID}-copy-export`).select(),document.execCommand("copy"),ui.notifications.info(`<strong>${e.TITLE}</strong>: ${e.localize("dialog.export.notification.copied")}`)})),$(t).find('[data-button="export"]').on("click",(e=>{saveDataToFile(JSON.stringify(this.moduleData,null,4),"application/json","PackageList.json")}))}}class u extends FormApplication{constructor(e,t){super();for(const[t,i]of Object.entries(e))e[t].isInstalled=game.modules.has(t)??!1,e[t].hasClientSettings=e[t].isInstalled&&(e[t]?.settings?.client??!1),e[t].hasWorldSettings=e[t].isInstalled&&(e[t]?.settings?.world??!1);this.importType=t,this.moduleData=e}static get defaultOptions(){return{...super.defaultOptions,title:`${e.TITLE} - ${e.localize("dialog.titles.import")}`,id:`${e.ID}-import-dialog`,classes:["dialog"],template:`./modules/${e.ID}/templates/import.hbs`,resizable:!1,width:$(window).width()>580?580:$(window).width()-100,height:$(window).height()>620?620:$(window).height()-100}}getData(){return{DIALOG:{ID:e.ID,TITLE:e.TITLE},modules:this.moduleData,IsTidyUI:"tidy-ui_game-settings"==this.importType,IsGM:game.user.isGM}}processSettingData(e,t,i){return new Promise(((n,o)=>{for(const[o,a]of Object.entries(i))"client"==t?(game.settings.storage.get(t).setItem(`${e}.${o}`,a),n({moduleID:e,key:o,setting:a})):"world"==t&&game.user.isGM?SocketInterface.dispatch("modifyDocument",{type:"Setting",action:"update",data:{key:`${e}.${o}`,value:a}}).then((t=>{n({moduleID:e,key:o,setting:a,response:t})})):n(!1)}))}activateListeners(t){super.activateListeners(t);let i=$(t).find('li[data-module] input[name="import-module"]:not([disabled])').length,n=$(t).find('li[data-module] input[name="import-module"]:not([disabled]):checked').length,o=$(t).find('li[data-module] input[name="import-settings-client"]:not([disabled])').length,a=$(t).find('li[data-module] input[name="import-settings-client"]:not([disabled]):checked').length,r=$(t).find('li[data-module] input[name="import-settings-world"]:not([disabled])').length,s=$(t).find('li[data-module] input[name="import-settings-world"]:not([disabled]):checked').length;$(t).find('input[name="import-toggle-modules"]').prop("indeterminate",n>0&&n!=i),$(t).find('input[name="import-toggle-modules"]').prop("checked",n==i),$(t).find('li[data-module] input[name="import-module"]:not([disabled])').on("change",(e=>{n=$(t).find('li[data-module] input[name="import-module"]:not([disabled]):checked').length,$(t).find('input[name="import-toggle-modules"]').prop("indeterminate",n>0&&n!=i),$(t).find('input[name="import-toggle-modules"]').prop("checked",n==i)})),$(t).find('input[name="import-toggle-modules"][type="checkbox"]').on("change",(e=>{$(t).find('li[data-module] input[name="import-module"]:not([disabled])').prop("indeterminate",!1),$(t).find('li[data-module] input[name="import-module"]:not([disabled])').prop("checked",$(e.target).is(":checked"))})),$(t).find('li[data-module] input[name="import-settings-client"]:not([disabled])').on("change",(e=>{a=$(t).find('li[data-module] input[name="import-settings-client"]:not([disabled]):checked').length,$(t).find('input[name="import-toggle-client-settings"]').prop("indeterminate",a>0&&a!=o),$(t).find('input[name="import-toggle-client-settings"]').prop("checked",a==o)})),$(t).find('input[name="import-toggle-client-settings"][type="checkbox"]').on("change",(e=>{$(t).find('li[data-module] input[name="import-settings-client"]:not([disabled])').prop("indeterminate",!1),$(t).find('li[data-module] input[name="import-settings-client"]:not([disabled])').prop("checked",$(e.target).is(":checked"))})),$(t).find('li[data-module] input[name="import-settings-world"]:not([disabled])').on("change",(e=>{s=$(t).find('li[data-module] input[name="import-settings-world"]:not([disabled]):checked').length,$(t).find('input[name="import-toggle-world-settings"]').prop("indeterminate",s>0&&s!=r),$(t).find('input[name="import-toggle-world-settings"]').prop("checked",s==r)})),$(t).find('input[name="import-toggle-world-settings"][type="checkbox"]').on("change",(e=>{$(t).find('li[data-module] input[name="import-settings-world"]:not([disabled])').prop("indeterminate",!1),$(t).find('li[data-module] input[name="import-settings-world"]:not([disabled])').prop("checked",$(e.target).is(":checked"))})),$(t).find('[data-button="import"]').on("click",(i=>{i.preventDefault();let n=$("html").find('.dialog-buttons input[name="keep-enabled-modules"]').is(":checked"),o=game.settings.get("core",ModuleManagement.CONFIG_SETTING),a=$("body #module-management"),r=[];if(!n){a.find('#module-list li.package input[type="checkbox"]').prop("checked",!1),a.find('#module-list li.package input[type="checkbox"]').removeClass("active");for(const e in o)o[e]=!1}$(t).find('ul li[data-module] input[type="checkbox"]').prop("disabled",!0),$(t).find("ul li[data-module]").each(((e,t)=>{let i=$(t).data("module"),n=$(t).find('input[name="import-module"][type="checkbox"]').is(":checked"),s=$(t).find(`input[name="import-${i}-settings-client"][type="checkbox"]`).is(":checked")??!1,l=$(t).find(`input[name="import-${i}-settings-world"][type="checkbox"]`).is(":checked")??!1;o[i]=n,a.find(`#module-list li.package[data-module-name="${i}"] input[type="checkbox"]`).prop("checked",n),a.find(`#module-list li.package[data-module-name="${i}"] input[type="checkbox"]`).toggleClass("active",n),n&&(l&&this.moduleData[i]?.settings?.world&&r.push(this.processSettingData(i,"world",this.moduleData[i]?.settings?.world)),s&&this.moduleData[i]?.settings?.client&&r.push(this.processSettingData(i,"client",this.moduleData[i]?.settings?.client)))})),Promise.allSettled(r).then((t=>{e.setting("storePreviousOnPreset")||e.setting("storedRollback",{}),game.settings.set("core",ModuleManagement.CONFIG_SETTING,o).then((e=>{SettingsConfig.reloadConfirm({world:!0})}))}))}))}}class p extends FormApplication{constructor(e){super()}static get defaultOptions(){return{...super.defaultOptions,title:`${e.TITLE} - ${e.localize("dialog.titles.presets")}`,id:`${e.ID}-preset-dialog`,classes:["dialog"],template:`./modules/${e.ID}/templates/presets.hbs`,resizable:!1,width:$(window).width()>400?400:$(window).width()-100,height:$(window).height()>275?275:$(window).height()-100}}getData(){return{DIALOG:{ID:e.ID,TITLE:e.TITLE},presets:e.setting("presets")}}activateListeners(t){super.activateListeners(t);const i=t=>{const i=t.target.closest("li").dataset.preset;let n=e.setting("presets")[i],o=n.modules.filter((e=>0==(game.modules.get(e.id)??!1))),a=n.modules.filter((e=>0!=(game.modules.get(e.id)??!1))),r=[];o.length>0&&(r.push(`### ${e.localize("dialog.presets.info.uninstalledModules")}`),o.forEach((e=>{r.push(e.title)}))),a.length>0&&(o.length>0&&r.push(""),r.push(`### ${e.localize("dialog.presets.info.installedModules")}`),a.forEach((e=>{r.push(e.title)}))),Dialog.prompt({id:`${e.ID}-create-preset`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.presets.info.description",{name:n.name})}</p>\n\t\t\t\t\t<textarea readonly rows="15" style="margin-bottom: 0.5rem;">${r.join("\n")}</textarea>`})},n=t=>{const i=t.target.closest("li").dataset.preset;let n=e.setting("presets");const o=document.querySelectorAll("#module-management #module-list li.package");let a=[];o.forEach((e=>{e.querySelector('input[type="checkbox"]:checked')&&a.push({id:game.modules.get(e.dataset.moduleId).id,title:game.modules.get(e.dataset.moduleId).title})})),Dialog.confirm({id:`${e.ID}-update-preset`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.presets.update.description")}</p>\n\t\t\t\t\t<textarea readonly rows="${a.length<=15?a.length+2:15}" style="margin-bottom: 0.5rem;">### ${e.localize("dialog.generic.activeModules")}\n${a.map((e=>e.title)).join("\n")}</textarea>`,yes:t=>{n[i].modules=a,e.setting("presets",n).then((t=>{e.log("UPDATE",t)}))},no:e=>!1})},o=t=>{const i=t.target.closest("li").dataset.preset;let n=e.setting("presets");Dialog.confirm({id:`${e.ID}-delete-preset`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.presets.delete.description",{name:n[i].name})}</p>\n\t\t\t\t\t<div class="notification warning">${e.localize("dialog.presets.delete.warning")}</div>`,yes:o=>{delete n[i],e.setting("presets",n).then((e=>{t.target.closest("li").remove()}))},no:e=>!1})},a=t=>{const i=t.target.closest("li").dataset.preset;let n=game.settings.get("core",ModuleManagement.CONFIG_SETTING),o=e.setting("presets")[i];Dialog.confirm({id:`${e.ID}-activate-preset`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.presets.activate.description")}</p>\n\t\t\t\t<textarea readonly rows="${o.modules.length<=15?o.modules.length+2:15}" style="margin-bottom: 0.5rem;">### ${e.localize("dialog.generic.activeModules")}\n${o.modules.filter((e=>0!=(game.modules.get(e.id)??!1))).map((e=>e.title)).join("\n")}</textarea>`,yes:t=>{for(const e in n)n[e]=!1;o.modules.forEach((e=>{null!=typeof n[e.id]&&(n[e.id]=!0)})),e.setting("storePreviousOnPreset")||e.setting("storedRollback",{}),game.settings.set("core",ModuleManagement.CONFIG_SETTING,n).then((e=>{SettingsConfig.reloadConfirm({world:!0})}))},no:e=>!1})};t[0].querySelectorAll(`#${e.ID}-presets-list li`).forEach((e=>{e.querySelector('button[data-action="info"]').addEventListener("click",i),e.querySelector('button[data-action="update"]').addEventListener("click",n),e.querySelector('button[data-action="delete"]').addEventListener("click",o),e.querySelector('button[data-action="activate"]').addEventListener("click",a)})),t[t.length-1].querySelector('.dialog-buttons button[data-action="create"]').addEventListener("click",(r=>{const s=document.querySelectorAll("#module-management #module-list li.package");let l=[];return s.forEach((e=>{e.querySelector('input[type="checkbox"]:checked')&&l.push({id:game.modules.get(e.dataset.moduleId).id,title:game.modules.get(e.dataset.moduleId).title})})),Dialog.confirm({id:`${e.ID}-create-preset`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.presets.create.title")}</p>\n\t\t\t\t\t<input type="text" name="${e.ID}-preset-title" placeholder="${e.localize("dialog.presets.create.placeholder")}" />\n\t\t\t\t\t<textarea readonly rows="${l.length<=15?l.length+2:15}" style="margin-bottom: 0.5rem;">### ${e.localize("dialog.generic.activeModules")}\n${l.map((e=>e.title)).join("\n")}</textarea>`,yes:r=>{if(0==r[0].querySelector(`input[name="${e.ID}-preset-title"]`)?.value?.length)throw`<strong>${e.TITLE}</strong> ${e.localize("dialog.presets.create.notification.noTitleError")}`;const s=foundry.utils.randomID();e.setting("presets",mergeObject(e.setting("presets"),{[s]:{name:r[0].querySelector(`input[name="${e.ID}-preset-title"]`)?.value,modules:l}},{inplace:!1})).then((l=>(t[0].querySelector(`#${e.ID}-presets-list`).insertAdjacentHTML("beforeend",`<li data-preset="${s}">\n\t\t\t\t\t\t\t<label for="preset-${s}">${r[0].querySelector(`input[name="${e.ID}-preset-title"]`)?.value}</label>\n\t\t\t\t\t\t\t<button data-action="info" data-tooltip="${e.localize("dialog.presets.tooltips.info")}">\n\t\t\t\t\t\t\t\t<i class="fa-solid fa-circle-info"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button data-action="update" data-tooltip="${e.localize("dialog.presets.tooltips.update")}">\n\t\t\t\t\t\t\t\t<i class="fa-solid fa-floppy-disk"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button data-action="delete" data-tooltip="${e.localize("dialog.presets.tooltips.delete")}">\n\t\t\t\t\t\t\t\t<i class="fa-solid fa-trash"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button data-action="activate" data-tooltip="${e.localize("dialog.presets.tooltips.activate")}">\n\t\t\t\t\t\t\t\t<i class="fa-solid fa-circle-play"></i>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</li>`),t[0].querySelector(`#${e.ID}-presets-list li:last-of-type button[data-action="info"]`).addEventListener("click",i),t[0].querySelector(`#${e.ID}-presets-list li:last-of-type button[data-action="update"]`).addEventListener("click",n),t[0].querySelector(`#${e.ID}-presets-list li:last-of-type button[data-action="delete"]`).addEventListener("click",o),t[0].querySelector(`#${e.ID}-presets-list li:last-of-type button[data-action="activate"]`).addEventListener("click",a),!0)))},no:()=>"Player Rejected Setting",render:t=>{setTimeout((()=>{t[0].querySelector(`input[type="text"][name="${e.ID}-preset-title"]`).focus()}),1)}}).then((e=>{}))}))}}class g{static socket=!1;static#e={};static#t=[];static bugReporterSupport=e=>void 0!==(game.modules.get("bug-reporter")||{api:void 0}).api&&e?.flags?.allowBugReporter;static registerSocketLib=()=>{this.socket=socketlib.registerModule(e.ID),this.socket.register("useFilePicker",this.useFilePicker),this.socket.register("setUserSetting",this.setUserSetting),this.socket.register("getGMSetting",this.getGMSetting)};static async getGMSetting({moduleId:e,settingName:t}){return await game.settings.get(e,t)}static async setUserSetting({moduleId:t,settingName:i,settingValue:n}){e.log("RECIEVED SETTING",t,i,n,game.settings.settings.get(`${t}.${i}`).name);const o=(e,t,i)=>{game.settings.set(e,t,i).then((i=>(game.settings.settings.get(`${e}.${t}`)?.requiresReload&&location.reload(),i)))};return e.setting("disableSyncPrompt")?await o(t,i,n):await Dialog.confirm({title:e.localize("title"),content:`<p style="margin-top:0px;">${e.localize("dialog.clientSettings.syncSetting.askPermission")}</p> \n\t\t\t\t\t<p>${game.i18n.localize(game.settings.settings.get(t+"."+i).name)}<br/>\n\t\t\t\t\t${game.i18n.localize(game.settings.settings.get(t+"."+i).hint)}</p>`,yes:()=>o(t,i,n),no:()=>"Player Rejected Setting"})}static installAPI=()=>{game.modules.get(e.ID).API={getContent:async(e,t,i={dir:"modules"})=>{let n=await this.checkIfFilesExists(`./${i.dir}/${e.id}/`,{extensions:[".md"]}),o=!!n&&n.filter((e=>e.toLowerCase().endsWith(`${t}.md`.toLowerCase())))[0];return 0==o||null==o?await this.getGithubMarkdown(e[t.toLowerCase()]):await this.getFile(o)}}};static init=()=>{this.installAPI(),this.getChangelogs(),game.user.isGM&&e.setting("storedRollback",{}),g.#e=e.setting("lockedSettings")};static get hasPermission(){return game.permissions.FILES_BROWSE.includes(game.user.role)||(game.modules.get("socketlib")?.active??!1)}static get isGMOnline(){return game.users.find((e=>e.isGM&&e.active))}static async useFilePicker(t,i={}){let n=t.split("/").pop().includes(".");return await FilePicker.browse("user",t,i).then((e=>{let i=n?[]:e.files.filter((e=>e.toLowerCase().endsWith(t.split("/").pop().toLowerCase())));if(i.length>0||!n)return n?i[0]:e.files;throw TypeError(`unable to access ${t}`)})).then((e=>e)).catch((t=>(e.debug(t),!1)))}static async useFetch(t,i={}){return await fetch(t).then((e=>{if(e.status>=200&&e.status<=299)return e;throw TypeError("unable to fetch file content")})).then((e=>t)).catch((t=>(e.debug(t),!1)))}static async checkIfFilesExists(e,t={}){return!!this.hasPermission&&(!game.permissions.FILES_BROWSE.includes(game.user.role)&&this.isGMOnline?await this.socket.executeAsGM("useFilePicker",e,t).then((e=>e)):await this.useFilePicker(e,t).then((e=>e)))}static async getFile(t){return await fetch(t).then((e=>{if(e.status>=200&&e.status<=299)return t.split(".").pop().toLowerCase().startsWith("json")?e.json():e.text();throw TypeError("unable to fetch file content")})).catch((t=>(e.debug(t),!1)))}static async getGithubMarkdown(t){const i=/https?:\/\/github.com\/(?<user>[^/]+)\/(?<repo>[^/]+)\/blob\/[^/]+\/(?<path>.*)/,n=/https?:\/\/raw.githubusercontent.com\/(?<user>[^/]+)\/(?<repo>[^/]+)\/master\/(?<path>.*)/;if(t.match(i)||t.match(n)){const{user:o,repo:a,path:r}=(t.match(i)??t.match(n)).groups;return await fetch(`https://api.github.com/repos/${o}/${a}/contents/${r}`).then((e=>{if(e.status>=200&&e.status<=299)try{return e.json()}catch(e){throw TypeError("unable to fetch file content")}throw TypeError("unable to fetch file content")})).then((e=>atob(e.content))).catch((t=>(e.debug(t),!1)))}}static async globalConflicts(){return(new PublicGoogleSheetsParser).parse("1eRcaqt8VtgDRC-iWP3SfOnXh-7kIw2k7po9-3dcftAk").then((e=>{let t=[];return e.forEach((e=>{e?.["Module ID"]&&("system"==(e?.Type??"").toLowerCase()&&game.system.id==(e?.["Package ID"]??"")||"system"!=(e?.Type??"").toLowerCase())&&t.push({id:e?.["Module ID"],packageId:e?.["Package ID"]??void 0,type:e?.Type??!1,manifest:e?.["Manifest URL"]??"",reason:e?.Reason??"",compatibility:{minimum:e?.["Compatibility Minimum"]??"0.0.0",maximum:e?.["Compatibility Maximum"]??void 0,version:e?.["Compatibility Version"]??void 0}})})),t}))}static getModuleProperty(e,t){-1==t.lastIndexOf(".")&&(t="."+t);const i=t.lastIndexOf(".")>=0?t.lastIndexOf("."):0;let n=(t.slice(0,i)+".flags."+t.slice(i+1)).substring(1);return foundry.utils.getProperty(game.modules.get(e),t.substring(1))??foundry.utils.getProperty(game.modules.get(e),n)??!1}static async cleanUpRemovedChangelogs(){let t=e.setting("trackedChangelogs");for(const[i,n]of Object.entries(t))game.modules.has(i)||(e.debug(`${n.title} is no longer installed, remove from tracked changelogs`),delete t[i]);return await e.setting("trackedChangelogs",t)}static async getChangelogs(){for await(const[t,i]of game.modules.entries()){let n=await g.checkIfFilesExists(`./modules/${t}/`,{extensions:[".md"]});if(!!n&&n.filter((e=>e.toLowerCase().endsWith("CHANGELOG.md".toLowerCase())))[0]&&game.user.isGM){let n="This is auto replaced"!=i?.version?i?.version:"0.0.0",o=e.setting("trackedChangelogs")?.[t]?.hasSeen??!1;isNewerVersion(n??"0.0.0",e.setting("trackedChangelogs")?.[t]?.version??"0.0.0")&&(e.debug(`${i.title} is newer then last seen, set hasSeen to false`),o=!1),await e.setting("trackedChangelogs",foundry.utils.mergeObject(e.setting("trackedChangelogs"),{[t]:{title:i?.title,version:n??"0.0.0",hasSeen:o,type:"CHANGELOG"}}))}}if(await this.cleanUpRemovedChangelogs(),e.setting("showNewChangelogsOnLoad")&&game.user.isGM){let t=Object.keys(e.setting("trackedChangelogs")).reduce(((t,i)=>(e.setting("trackedChangelogs")[i].hasSeen||(t[i]=e.setting("trackedChangelogs")[i]),t)),{});Object.keys(t).length>=1&&new c(t).render(!0)}}static smartLabel=t=>{if(e.setting("renamedModules")[t.id])return e.setting("renamedModules")[t.id];if(e.setting("smartPrefix")){if(t?.library)return`${e.localize("settings.smartPrefix.prefixes.library")} - ${t.title.replace("lib - ","")}`;if([" UI","UI "].some((e=>(t?.title??"").toUpperCase().includes(e)??!1))||(t?.title??"").toUpperCase().endsWith("UI"))return`${e.localize("settings.smartPrefix.prefixes.ui")} - ${t.title}`;if(["MAPS","BATTLEMAP"].some((e=>(t?.title??"").toUpperCase().includes(e))))return`${e.localize("settings.smartPrefix.prefixes.maps")} - ${t.title}`}if(!e.setting("smartLabels"))return t.title;if(0==(t?.relationships?.requires??[]).length)return t.title;let i=[];return(t?.relationships?.requires??[]).forEach((e=>{if(!game.modules.get(e?.id)?.library&&game.modules.get(e?.id)?.title){let t=g.smartLabel(game.modules.get(e?.id));i=i.concat(t),i.push(game.modules.get(e?.id)?.title),i=[...new Set(i)]}})),i??[]};static screwYourEmoji(e,t){$(e).each(((e,i)=>{let n=this.smartLabel(game.modules.get(i.dataset.moduleId)),o="string"==typeof n?n:n.join("")+game.modules.get(i.dataset.moduleId).title;if("string"!=typeof n){let e=n.join(" / ");n=`${n.length>0?'<i class="fa-regular fa-arrow-turn-down-right" data-tooltip="'+e+'"></i> ':""}${game.modules.get(i.dataset.moduleId).title}`}$(Array.from(i.querySelectorAll(t)).pop()).contents().filter((function(){return 3==this.nodeType})).last().replaceWith(n??""),$(i).attr("data-sort-title",o.toUpperCase().replace(/[^\w]/gi,""))})),$(e).sort(((e,t)=>$(t).attr("data-sort-title")<$(e).attr("data-sort-title")?1:-1)).appendTo($(e).parent())}static async renderModuleManagement(t,i,n){const o=/https?:\/\/github.com\/(?<user>[^/]+)\/(?<repo>[^/]+)\/blob\/[^/]+\/(?<path>.*)/,a=/https?:\/\/raw.githubusercontent.com\/(?<user>[^/]+)\/(?<repo>[^/]+)\/master\/(?<path>.*)/;if(i=i[0],e.setting("bigPictureMode")&&i.classList.add(`${e.ID}-big-picture-mode`),g.screwYourEmoji($(i).find("#module-list .package"),".package-title .title-group .title, .package-title"),i.querySelector('nav.list-filters input[type="search"]').focus(),game.user.isGM&&(i.querySelector("nav.list-filters").insertAdjacentHTML("afterbegin",`<button type="button" class="" data-action="presets" data-tooltip="${e.localize("dialog.moduleManagement.tooltips.managePresets")}">\n\t\t\t\t<i class="fa-solid fa-list-check"></i>\n\t\t\t</button>`),i.querySelector('nav.list-filters button[data-action="presets"]').addEventListener("click",(e=>{(new p).render(!0)})),i.querySelector("nav.list-filters button.expand").insertAdjacentHTML("beforebegin",`<button type="button" class="" data-action="export" data-tooltip="${e.localize("dialog.moduleManagement.tooltips.exportModules")}">\n\t\t\t\t<i class="fa-solid fa-download"></i>\n\t\t\t</button>`),i.querySelector('nav.list-filters button[data-action="export"]').addEventListener("click",(e=>{new d(i.querySelectorAll("#module-list li.package")).render(!0)})),i.querySelector("nav.list-filters button.expand").insertAdjacentHTML("beforebegin",`<button type="button" class="" data-action="import" data-tooltip="${e.localize("dialog.moduleManagement.tooltips.importModules")}">\n\t\t\t\t<i class="fa-solid fa-upload"></i>\n\t\t\t</button>`),i.querySelector('nav.list-filters button[data-action="import"]').addEventListener("click",(t=>{$('<input type="file">').on("change",(t=>{const i=t.target.files[0];return!!i&&("application/json"!=i.type?(ui.notifications.error(`<strong>${e.TITLE}</strong> Please select a JSON file.`),!1):void readTextFromFile(i).then((async t=>{try{const i=JSON.parse(t);let n={},o=e.ID;if(i.hasOwnProperty("activeModules"))o="tidy-ui_game-settings",i.activeModules.forEach(((e,t)=>{n[e.id]={title:e.title,version:e.version,settings:{client:void 0,world:void 0}}}));else{if(!i?.[Object.keys(i)[0]]?.hasOwnProperty("title"))return ui.notifications.error(`<strong>${e.TITLE}</strong> Unable to determine how to load file.`),!1;n=i}new u(n,o).render(!0)}catch(t){return e.error("Failed to read selected file",t),ui.notifications.error(`<strong>${e.TITLE}</strong> Failed to read selected file.`),!1}})))})).trigger("click")})),i.querySelectorAll("nav.list-filters a.filter")?.length>0)){let t=Array.from(i.querySelectorAll("nav.list-filters a.filter")).pop(),n=Object.keys(e.setting("lockedModules")).length;t.insertAdjacentHTML("afterend",`<a class="filter" data-filter="locked">${e.localize("dialog.moduleManagement.lockedModules")} (${n})</a>`),i.querySelector('nav.list-filters a.filter[data-filter="locked"]').addEventListener("click",(t=>{i.querySelector("nav.list-filters a.filter.active").classList.remove("active"),t.target.classList.add("active"),i.querySelectorAll(".package-list .package").forEach((e=>{e.classList.add("hidden")}));for(const[t,n]of Object.entries(e.setting("lockedModules")))i.querySelector(`.package-list .package[data-module-id="${t}"]`).classList.remove("hidden")})),i.querySelector('nav.list-filters input[type="search"]').insertAdjacentHTML("afterend",'<select data-action="filter"></select>'),i.querySelectorAll("nav.list-filters a.filter").forEach((e=>{i.querySelector('nav.list-filters select[data-action="filter"]').insertAdjacentHTML("beforeend",`<option value="${e.dataset.filter}">${e.innerHTML}</option>`)})),i.querySelector('nav.list-filters select[data-action="filter"]').value=i.querySelector("nav.list-filters a.filter.active").dataset.filter,i.querySelector('nav.list-filters select[data-action="filter"]').addEventListener("change",(e=>{i.querySelector(`nav.list-filters a.filter[data-filter="${e.target.value}"]`).click()}))}let r={},s=game.settings.settings.values();for(let e of s)"core"!=e.namespace&&e.namespace!=game.system.id&&e.config&&(r[e.namespace]=!0);const l=(e,t)=>{if((e=>{try{return new URL(e),!0}catch{return!1}})(t)){const i=t.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n?]+)\./i)[1]?.toLowerCase()??t,n=f.hasOwnProperty(i)?i:e,o=t.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n?]+)\./i)[1]??e;return`<li><a href="${t}" target="_blank">${f[n]?.icon??""}${"url"==n?o:n}</a></li>`}return["twitter","patreon","github","reddit","ko-fi"].includes(e)?`<li><a href="https://www.${e}.com/${t}" target="_blank">${f[e]?.icon??""}${e}</a></li>`:`<li><div>${f[e]?.icon??""}${t}</div></li>`},f={email:{icon:'<i class="fa-solid fa-envelope"></i>'},url:{icon:'<i class="fa-solid fa-link"></i>'},discord:{icon:'<i class="fa-brands fa-discord"></i>'},twitter:{icon:'<i class="fa-brands fa-twitter"></i>'},patreon:{icon:'<i class="fa-brands fa-patreon"></i>'},github:{icon:'<i class="fa-brands fa-github"></i>'},"ko-fi":{icon:'<i class="fa-solid fa-mug-hot"></i>'},reddit:{icon:'<i class="fa-brands fa-reddit"></i>'}},m=e=>{let t=!1;return"core"==(e?.type??"").toLowerCase()?t=game.version:"system"==(e?.type??"").toLowerCase()?t=game.system.version:"module"==(e?.type??"").toLowerCase()&&(t=game.modules.get(e.id)?.version??"0.0.0"),!!t&&("core"==(e?.type??"").toLowerCase()||"system"==(e?.type??"").toLowerCase()?!foundry.utils.isNewerVersion(game.modules.get(e.id)?.version??"0.0.0",e.compatibility.version??"0.0.0")&&((foundry.utils.isNewerVersion(t,e.compatibility.minimum??"0.0.0")||t==e.compatibility.minimum)&&(foundry.utils.isNewerVersion(e.compatibility.maximum??t,t)||(e.compatibility.maximum??t)==t)):(foundry.utils.isNewerVersion(t,e.compatibility.minimum??"0.0.0")||t==e.compatibility.minimum)&&(foundry.utils.isNewerVersion(e.compatibility.maximum,t)||e.compatibility.maximum==t))},h=(t,n)=>{let o=i.querySelector(`#module-list > li.package[data-module-id="${n.id}"]`)??!1;if(o){let i=game.modules.get(t?.id??n.id)?.title??"";"core"==(n?.type??"").toLowerCase()&&(i+=` - ${e.localize("dialog.moduleManagement.conflicts.core")}`),"system"==(n?.type??"").toLowerCase()&&(i+=` - ${game.system.title}`);let a=(new DOMParser).parseFromString(o.querySelector(".conflicts")?.dataset?.tooltip??`<ul class='${e.ID}-tooltip-list'></ul>`,"text/html");a.querySelector("ul").insertAdjacentHTML("beforeend",`<li><strong>${i}</strong><br/>${(n?.reason??e.localize("dialog.moduleManagement.conflicts.undefinedReason")).replaceAll('"',"'")}</li>`),o.querySelectorAll('.package-overview .package-title input[type="checkbox"] + span.conflicts')?.length>0?o.querySelector('.package-overview .package-title input[type="checkbox"] + span.conflicts').dataset.tooltip=a.querySelector("ul").outerHTML.replaceAll('"',"'"):o.querySelector('.package-overview .package-title input[type="checkbox"]').insertAdjacentHTML("afterend",`<span class="conflicts" data-tooltip="${a.querySelector("ul").outerHTML.replaceAll('"',"'")}" aria-describedby="tooltip">\n\t\t\t\t\t\t<i class="fa-solid fa-triangle-exclamation"></i>\n\t\t\t\t\t</span>`)}};for await(const t of i.querySelectorAll("#module-list > li.package")){let n=t.dataset.moduleId,s=game.modules.get(n),d=await g.checkIfFilesExists(`./modules/${s.id}/`,{extensions:[".md"]}),u=!!d&&d.filter((e=>e.toLowerCase().endsWith("README.md".toLowerCase())))[0],p=!!d&&d.filter((e=>e.toLowerCase().endsWith("CHANGELOG.md".toLowerCase())))[0],f=!!d&&d.filter((e=>e.toLowerCase().endsWith("ATTRIBUTIONS.md".toLowerCase())))[0];if(new ContextMenu($(t),".package-overview ",[{name:`${e.localize("dialog.moduleManagement.contextMenu.renameModule")}`,icon:'<i class="fa-duotone fa-pen-to-square"></i>',condition:game.user.isGM,callback:t=>Dialog.confirm({id:`${e.ID}-rename-module`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.moduleManagement.contextMenu.renameModule")}</p>\n\t\t\t\t\t\t\t<input type="text" name="${e.ID}-rename-module-title" value="${t[0].querySelector("label.package-title").textContent.trim()}"/>`,yes:i=>{i[0].querySelector(`input[name="${e.ID}-rename-module-title"]`).value.length>=0&&e.setting("renamedModules",foundry.utils.mergeObject(e.setting("renamedModules"),{[t[0].closest("li.package").dataset.moduleId]:i[0].querySelector(`input[name="${e.ID}-rename-module-title"]`).value},{inplace:!1})).then((e=>{(new ModuleManagement).render(!0)}))},no:()=>!1}).then((e=>{}))},{name:`${e.localize("dialog.moduleManagement.contextMenu.restoreModuleName")}`,icon:'<i class="fa-duotone fa-rotate"></i>',condition:game.user.isGM&&(e.setting("renamedModules")[n]??!1),callback:t=>{let i=e.setting("renamedModules");delete i[n],e.setting("renamedModules",i).then((e=>{(new ModuleManagement).render(!0)}))}},{name:e.localize("dialog.moduleManagement.contextMenu.lockModule"),icon:'<i class="fa-duotone fa-lock"></i>',condition:()=>game.user.isGM&&!e.setting("lockedModules").hasOwnProperty(n),callback:o=>{let a=e.setting("lockedModules");a[n]=!0,e.setting("lockedModules",a).then((n=>{o[0].querySelector('.package-title input[type="checkbox"]').insertAdjacentHTML("afterend",`<i class="fa-duotone fa-lock" data-tooltip="${e.localize("dialog.moduleManagement.tooltips.moduleLocked")}" style="margin-right: 0.25rem;"></i>`),e.setting("disableLockedModules")&&(o[0].querySelector('.package-title input[type="checkbox"]').disabled=!0,t.classList.add("disabled")),o[0].querySelector('.package-title input[type="checkbox"]').checked=!0,o[0].querySelector('.package-title input[type="checkbox"]').dispatchEvent(new Event("change"));let a=Object.keys(e.setting("lockedModules")).length;i.querySelector('nav.list-filters a.filter[data-filter="locked"]').innerHTML=`${e.localize("dialog.moduleManagement.lockedModules")} (${a})`,i.querySelector('#module-management nav.list-filters select option[value="locked"]').innerHTML=`${e.localize("dialog.moduleManagement.lockedModules")} (${a})`}))}},{name:e.localize("dialog.moduleManagement.contextMenu.unlockModule"),icon:'<i class="fa-duotone fa-lock-open"></i>',condition:()=>game.user.isGM&&e.setting("lockedModules").hasOwnProperty(n),callback:o=>{let a=e.setting("lockedModules");delete a[n],e.setting("lockedModules",a).then((n=>{o[0].querySelector(".package-title i.fa-duotone.fa-lock").remove(),e.setting("disableLockedModules")&&(o[0].querySelector('.package-title input[type="checkbox"]').disabled=!1,t.classList.remove("disabled"));let a=Object.keys(e.setting("lockedModules")).length;i.querySelector('nav.list-filters a.filter[data-filter="locked"]').innerHTML=`${e.localize("dialog.moduleManagement.lockedModules")} (${a})`,i.querySelector('#module-management nav.list-filters select option[value="locked"]').innerHTML=`${e.localize("dialog.moduleManagement.lockedModules")} (${a})`}))}},{name:e.localize("dialog.moduleManagement.contextMenu.reportConflict"),icon:'<i class="fa-solid fa-bug"></i>',condition:()=>game.user.isGM&&(game.modules.get("bug-reporter")?.active??!1),callback:t=>{const i=game.modules.get(t[0].closest("li").dataset.moduleId);Hooks.once("renderBugReportForm",((t,i,n)=>{(i=i[0]).querySelector('input[type="text"][name="formFields.bugTitle"]').closest(".form-group-stacked").insertAdjacentHTML("afterend",`<div class="form-group-stacked">\n\t\t\t\t\t\t\t<div class="form-group-stacked">\n\t\t\t\t\t\t\t\t<label>${e.localize("dialog.bugReporter.selectLabel")}</label>\n\t\t\t\t\t\t\t\t<select name="${e.ID}.formFields.selectLabel">\n\t\t\t\t\t\t\t\t\t<optgroup label="${e.localize("dialog.bugReporter.optGroup.core")}">\n\t\t\t\t\t\t\t\t\t\t<option value="core" data-type="core">${game.i18n.localize("Foundry Virtual Tabletop")}</option>\n\t\t\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t\t\t\t<optgroup label="${e.localize("dialog.bugReporter.optGroup.system")}">\n\t\t\t\t\t\t\t\t\t\t<option value="${game.system.id}" data-type="system">${game.system.title}</option>\n\t\t\t\t\t\t\t\t\t</optgroup>\n\t\t\t\t\t\t\t\t\t<optgroup label="${e.localize("dialog.bugReporter.optGroup.modules")}"></optgroup>\n\t\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>`);let o=i.querySelector(`select[name="${e.ID}.formFields.selectLabel"] optgroup[label="${e.localize("dialog.bugReporter.optGroup.modules")}"]`);for(const e of game.modules)o.insertAdjacentHTML("beforeend",`<option value="${e.id}" data-type="module">${e.title}</option>`);i.querySelector('input[type="checkbox"][name="formFields.sendActiveModules"]').checked=!1,i.querySelector('input[type="checkbox"][name="formFields.sendModSettings"]').checked=!1,i.querySelector('input[type="checkbox"][name="formFields.sendActiveModules"]').closest(".flexrow").classList.add("hidden"),i.querySelector('input[type="text"][name="formFields.issuer"]').closest(".flexrow").classList.add("hidden"),i.querySelector('textarea[name="formFields.bugDescription"]').value="- ",i.querySelector('textarea[name="formFields.bugDescription"]').insertAdjacentHTML("afterend",`<div class="${e.ID}-bug-reporter-preview hidden"></div>`);let a=i.querySelector('textarea[name="formFields.bugDescription"]').closest("div.form-group-stacked").querySelector("label");a.insertAdjacentHTML("beforeend",`<button type="button" data-action="toggle">${e.localize("dialog.bugReporter.toggle.preview")}</button>`),a.querySelector('button[data-action="toggle"]').addEventListener("click",(n=>{const o=i.querySelector('textarea[name="formFields.bugDescription"]'),a=i.querySelector(`div.${e.ID}-bug-reporter-preview`),r=o.classList.contains("hidden");a.style.minHeight=`${o.offsetHeight}px`,o.classList.toggle("hidden",!r),a.classList.toggle("hidden",r);const s=i.querySelector(`select[name="${e.ID}.formFields.selectLabel"] option:checked`);let l={id:"",name:"",version:"0.0.0 "};"core"==s.dataset.type?l={id:"",name:game.i18n.localize("Foundry Virtual Tabletop"),version:game.version}:"system"==s.dataset.type?l={id:game.system.id,name:game.system.title,version:game.system.version}:"module"==s.dataset.type&&(l={id:game.modules.get(s.value).id,name:game.modules.get(s.value).title,version:game.modules.get(s.value).version});let c=[o.value];c.push("\n\n"),c.push("### Conflicts With"),""!=l.id&&c.push(`**Package ID:** ${l.id}`),c.push(`**Package Name:** ${l.name}`),c.push(`**Package Version:** ${l.version}`),c.push(`**Package Type:** ${s.dataset.type}`),a.innerHTML=(new showdown.Converter).makeHtml(c.join("\n\n")),n.target.innerHTML=e.localize("dialog.bugReporter.toggle."+(r?"preview":"write")),t.setPosition()})),i.querySelector('button[type="submit"]').classList.add("hidden"),i.querySelector('button[type="submit"]').insertAdjacentHTML("beforebegin",`<button type="button" data-type="submit">${i.querySelector('button[type="submit"]').innerHTML}</button>`),i.querySelector('button[data-type="submit"]').addEventListener("click",(t=>{const n=i.querySelector('textarea[name="formFields.bugDescription"]'),o=i.querySelector(`select[name="${e.ID}.formFields.selectLabel"] option:checked`);let a={id:"",name:"",version:"0.0.0 "};"core"==o.dataset.type?a={id:"",name:game.i18n.localize("Foundry Virtual Tabletop"),version:game.version}:"system"==o.dataset.type?a={id:game.system.id,name:game.system.title,version:game.system.version}:"module"==o.dataset.type&&(a={id:game.modules.get(o.value).id,name:game.modules.get(o.value).title,version:game.modules.get(o.value).version});let r=[n.value];r.push("\n"),r.push("### Conflicts With"),""!=a.id&&r.push(`**Package ID:** ${a.id}`),r.push(`**Package Name:** ${a.name}`),r.push(`**Package Version:** ${a.version}`),r.push(`**Package Type:** ${o.dataset.type}`),n.value=r.join("\n"),i.querySelector('button[type="submit"]').click()})),t.setPosition()})),game.modules.get("bug-reporter").api.bugWorkflow(e.ID,`Module Conflict - ${i.title} v${i.version}`,"")}}]),r?.[n]&&t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag settings" data-tooltip="${game.i18n.localize("SETTINGS.Configure")}" aria-describedby="tooltip">\n\t\t\t\t\t<i class="fa-solid fa-gear"></i>\n\t\t\t\t</span>`),s?.authors.size>=1){t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag authors" data-tooltip="${e.localize("dialog.moduleManagement.tags.authors")}" aria-describedby="tooltip">\n\t\t\t\t\t<i class="fa-solid ${1==s?.authors.size?"fa-user":"fa-users"}"></i>\n\t\t\t\t</span>`);let i="";s?.authors.forEach((e=>{i+=`<li class="author">${e?.name??"UNKNOWN"}</li>`,Object.keys(e).forEach((t=>{"name"!=t&&"flags"!=t&&void 0!==e[t]?i+=l(t,e[t]):"flags"==t&&Object.keys(e[t]).forEach((n=>{i+=l(n,e[t][n])}))}))})),tippy(t.querySelector(".package-overview span.tag.authors"),{content:`<ul class="${e.ID}-tippy-authors">${i}</ul>`,allowHTML:!0,interactive:!0,trigger:"click"}),t.querySelector(".package-overview span.tag i.fas.fa-user")&&t.querySelector(".package-overview span.tag i.fas.fa-user").closest("span.tag").remove()}t.querySelector(".package-overview span.tag.safe")&&t.querySelector(".package-overview span.tag.safe").remove(),t.querySelector(".package-overview span.tag.version")||(t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag version"><i class="fas fa-code-branch"></i> ${s?.version}</span>`),t.querySelector(".package-overview span.tag i.fas.fa-circle-info")&&t.querySelector(".package-overview span.tag i.fas.fa-circle-info").closest("span.tag").remove()),(u||(g.getModuleProperty(s.id,"readme")||"").match(o)||(g.getModuleProperty(s.id,"readme")||"").match(a))&&(t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag readme" data-tooltip="${e.localize("dialog.moduleManagement.tags.readme")}" aria-describedby="tooltip">\n\t\t\t\t\t<i class="fa-solid fa-circle-info"></i>\n\t\t\t\t</span>`),t.querySelector(".package-overview span.tag.readme").addEventListener("click",(e=>{new c({[n]:{hasSeen:!1,title:s.title??"",version:s.version??"0.0.0",type:"README"}}).render(!0)}))),(p||(g.getModuleProperty(s.id,"changelog")||"").match(o)||(g.getModuleProperty(s.id,"changelog")||"").match(a))&&(t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag changelog" data-tooltip="${e.localize("dialog.moduleManagement.tags.changelog")}" aria-describedby="tooltip">\n\t\t\t\t\t<i class="fa-solid fa-list"></i>\n\t\t\t\t</span>`),t.querySelector(".package-overview span.tag.changelog").addEventListener("click",(e=>{new c({[n]:{hasSeen:!1,title:s.title??"",version:s.version??"0.0.0",type:"CHANGELOG"}}).render(!0)}))),(f||(g.getModuleProperty(s.id,"attributions")||"").match(o)||(g.getModuleProperty(s.id,"attributions")||"").match(a))&&(t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag attributions" data-tooltip="${e.localize("dialog.moduleManagement.tags.attributions")}" aria-describedby="tooltip">\n\t\t\t\t\t<i class="fa-brands fa-creative-commons-by"></i>\n\t\t\t\t</span>`),t.querySelector(".package-overview span.tag.attributions").addEventListener("click",(e=>{new c({[n]:{hasSeen:!1,title:s.title??"",version:s.version??"0.0.0",type:"ATTRIBUTIONS"}}).render(!0)}))),g.getModuleProperty(s.id,"url")&&t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<a href="${g.getModuleProperty(s.id,"url")}" class="tag website" data-tooltip="${e.localize("dialog.moduleManagement.tags.url")}" aria-describedby="tooltip" target="_blank">\n\t\t\t\t\t<i class="fa-solid fa-link"></i>\n\t\t\t\t</a>`),g.bugReporterSupport(s)?t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag issues bug-reporter" data-tooltip="${e.localize("dialog.moduleManagement.tags.bugReporter")}" aria-describedby="tooltip" target="_blank">\n\t\t\t\t\t<i class="fa-solid fa-bug"></i>\n\t\t\t\t</span>`):g.getModuleProperty(s.id,"bugs")&&t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<a href="${g.getModuleProperty(s.id,"bugs")}" class="tag issues" data-tooltip="${e.localize("dialog.moduleManagement.tags.issues")}" aria-describedby="tooltip" target="_blank">\n\t\t\t\t\t<i class="fa-brands fa-github"></i>\n\t\t\t\t</a>`),s?.socket&&t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag socket" data-tooltip="${e.localize("dialog.moduleManagement.tags.socket")}" aria-describedby="tooltip" >\n\t\t\t\t\t<i class="fa-solid fa-plug"></i>\n\t\t\t\t</span>`),s?.library&&t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<span class="tag library" data-tooltip="${e.localize("dialog.moduleManagement.tags.library")}" aria-describedby="tooltip">\n\t\t\t\t\t<i class="fa-solid fa-book"></i>\n\t\t\t\t</span>`),t.querySelector(".package-overview").insertAdjacentHTML("beforeend",`<button class="tag expand" data-tooltip="${game.i18n.localize("Expand")}" aria-describedby="tooltip">\n\t\t\t\t<i class="fa-solid fa-circle-caret-up"></i>\n\t\t\t</button>`),t.querySelector(".package-overview button.tag.expand").addEventListener("click",(e=>{e.preventDefault();const t=e.target.closest("button.tag.expand"),i=e.target.closest(".package");i.querySelector(".package-description").classList.toggle("hidden"),t.dataset.tooltip=i.querySelector(".package-description").classList.contains("hidden")?game.i18n.localize("Expand"):game.i18n.localize("Collapse");const n=document.querySelectorAll("#module-management .package-description:not(.hidden)").length==document.querySelectorAll("#module-management .package-description").length;document.querySelector("#module-management .list-filters button.expand").setAttribute("title",n?game.i18n.localize("Collapse"):game.i18n.localize("Expand")),document.querySelector("#module-management .list-filters button.expand").dataset.tooltip=n?game.i18n.localize("Collapse"):game.i18n.localize("Expand"),document.querySelector("#module-management .list-filters button.expand i").classList.toggle("fa-angle-double-up",!n),document.querySelector("#module-management .list-filters button.expand i").classList.toggle("fa-angle-double-down",n),Object.values(ui.windows).find((e=>"module-management"===e.id))._expanded=n})),e.setting("lockedModules").hasOwnProperty(n)&&(t.querySelector('.package-overview .package-title input[type="checkbox"]').insertAdjacentHTML("afterend",`<i class="fa-duotone fa-lock" data-tooltip="${e.localize("dialog.moduleManagement.tooltips.moduleLocked")}" style="margin-right: 0.25rem;"></i>`),e.setting("disableLockedModules")&&(t.querySelector('.package-overview .package-title input[type="checkbox"]').disabled=!0,t.classList.add("disabled"))),s?.relationships?.conflicts?.size>0&&s?.relationships?.conflicts.forEach((e=>{m(e)&&(e.id!=s.id&&h(game.modules.get(e.id),foundry.utils.mergeObject(e,{id:s.id},{inplace:!1})),h(s,e))})),s?.active&&t.classList.add("checked"),t.querySelector('input[type="checkbox"]').addEventListener("change",(e=>{t.classList.toggle("checked",e.target.checked)}))}e.setting("enableGlobalConflicts")&&game.user.isGM&&(g.globalConflicts().then((e=>{e.forEach((e=>{m(e)&&(e.id!=(e?.packageId??"")&&e?.packageId&&h(game.modules.get(e.id),foundry.utils.mergeObject(e,{id:e.packageId},{inplace:!1})),h(game.modules.get(e?.packageId??e?.id),e))}))})),i.querySelector('footer button[name="deactivate"]')&&e.setting("addGoogleSheetButton")&&(i.querySelector('footer button[name="deactivate"]').insertAdjacentHTML("afterend",`<button type="button" name="global-conflicts-spreadsheet">\n\t\t\t\t\t<i class="fa-regular fa-table"></i> ${e.localize("dialog.moduleManagement.buttons.spreadsheet")}\n\t\t\t\t</button>`),i.querySelector('footer button[name="global-conflicts-spreadsheet"]').addEventListener("click",(e=>{window.open("https://docs.google.com/spreadsheets/d/1eRcaqt8VtgDRC-iWP3SfOnXh-7kIw2k7po9-3dcftAk/","_blank")})))),i.querySelectorAll("#module-list > li.package .package-overview .tag.settings").forEach((t=>{t.addEventListener("click",(async i=>{await game.settings.sheet._render(!0);let n=t.closest("li.package").dataset.moduleId,o=Object.values(ui.windows).find((e=>"client-settings"===e.id))?.element[0],a=o.querySelector(`aside.sidebar nav.tabs a.category-tab[data-tab="${n}"]`);o.classList.add(`${e.ID}-hide-filter-options`),a.click()}))})),i.querySelectorAll("#module-list > li.package .package-overview .tag.issues.bug-reporter").forEach((e=>{e.addEventListener("click",(async t=>{let i=e.closest("li.package").dataset.moduleId;game.modules.get("bug-reporter").api.bugWorkflow(i)}))})),i.querySelector('footer button[name="deactivate"]')&&(i.querySelector('footer button[name="deactivate"]').innerHTML=`<span class="fa-stack">\n\t\t\t\t<i class="fa-regular fa-square-check fa-stack-1x"></i>\n\t\t\t\t<i class="fa-sharp fa-solid fa-slash fa-stack-1x"></i>\n\t\t\t</span>${e.localize("dialog.moduleManagement.buttons.deactivateModules")}`,i.querySelector('footer button[name="deactivate"]').dataset.tooltip=e.localize("dialog.moduleManagement.buttons.deactivateModulesAlt"),i.querySelector('footer button[name="deactivate"]').addEventListener("click",(t=>{if(t.ctrlKey)e.log("USER WAS HOLDING DOWN CONTROL KEY");else{Array.from(i.querySelectorAll("#module-list.package-list .package.checked")).forEach((e=>{e.classList.remove("checked")}));for(const[t,n]of Object.entries(e.setting("lockedModules")))i.querySelector(`.package-list .package[data-module-id="${t}"] input[type="checkbox"]`).checked=!0,i.querySelector(`.package-list .package[data-module-id="${t}"]`).classList.add("checked")}}))),game.user.isGM&&(e.setting("storedRollback",game.settings.get("core",`${ModuleManagement.CONFIG_SETTING}`)),e.setting("presetsRollbacks").length>0&&(i.querySelector('footer button[type="submit"]').insertAdjacentHTML("beforebegin",`<button type="button" name="rollback" data-tooltip="${e.localize("dialog.moduleManagement.rollback")}">\n\t\t\t\t\t<i class="fa-regular fa-rotate-left"></i>\n\t\t\t\t</button>`),i.querySelector('footer button[name="rollback"]').addEventListener("click",(t=>{let i=[...e.setting("presetsRollbacks")].pop();Dialog.confirm({id:`${e.ID}-rollback-modules`,title:e.TITLE,content:`<p style="margin-top: 0px;">${e.localize("dialog.moduleManagement.rollback")}</p>\n\t\t\t\t\t\t<textarea readonly rows="15" style="margin-bottom: 0.5rem;">### ${e.localize("dialog.generic.activeModules")}\n${Object.entries(i).filter((([e,t])=>""!=(game.modules.get(e)?.title??"")&&0!=t)).map((([e,t])=>game.modules.get(e)?.title)).join("\n")}</textarea>`,yes:t=>{e.setting("storedRollback",{}).then((t=>{game.settings.set("core",`${ModuleManagement.CONFIG_SETTING}`,i).then((t=>{e.setting("presetsRollbacks",e.setting("presetsRollbacks").slice(0,-1)??[]).then((e=>{SettingsConfig.reloadConfirm({world:!0})}))}))}))},no:e=>!1})})))),$("#module-management #module-list").on("scroll",(e=>{tippy.hideAll()})),t.setPosition()}static renderSettingsConfig=(t,i,n)=>{i=i[0],e.setting("bigPictureMode")&&i.closest(".app").classList.add(`${e.ID}-big-picture-mode`),i.querySelectorAll(".categories .category .form-group").forEach((t=>{let i=null,n="UNKNOWN";if(t.querySelectorAll("input[name],select[name]").length>0?n=t.querySelectorAll("input[name],select[name]")[0].getAttribute("name"):t.querySelectorAll("button[data-key]").length>0&&(n=t.querySelectorAll("button[data-key]")[0].dataset.key),i=game.settings.settings.get(n),i){let o=t.querySelector("label");const a=n??!1,r=e=>g.#e.hasOwnProperty(`${e??"MMP-INVALID"}`)??!1;if("client"==i.scope&&game.user.isGM&&a){if(o.insertAdjacentHTML("afterbegin",`<i class="fa-solid fa-user" data-tooltip="${e.localize("dialog.clientSettings.tooltips.clientSetting")}" data-tooltip-direction="UP"></i>`),this.socket){o.insertAdjacentHTML("afterbegin",`<i class="fa-solid fa-arrows-rotate" data-tooltip="${e.localize("dialog.clientSettings.tooltips.syncSetting")}" data-tooltip-direction="UP" data-action="sync"></i>`),o.querySelector('[data-action="sync"]').addEventListener("click",(t=>{Dialog.confirm({title:e.TITLE,content:`<p style="margin-top:0px;">${e.localize("dialog.clientSettings.syncSetting.sendToAll")}</p>`,yes:()=>{this.socket.executeForOthers("setUserSetting",{moduleId:i.namespace,settingName:i.key,settingValue:game.settings.get(i.namespace,i.key)})},no:()=>"Player Rejected Setting"})}));const t=()=>{let t=[];return game.users.forEach((n=>{n.active&&n.name!=game.users.current.name&&t.push({name:n.name,icon:"",condition:game.user.isGM,callback:t=>{e.log("Setting Client Setting",this.socket.executeAsUser("setUserSetting",n.id,{moduleId:i.namespace,settingName:i.key,settingValue:game.settings.get(i.namespace,i.key)}))}})})),t};new ContextMenu($(o),'[data-action="sync"]',t())}game.modules.get("force-client-settings")?.active||(o.insertAdjacentHTML("afterbegin",`<i class="fa-solid fa-${r(a)?"lock":"unlock"}" data-tooltip="${r(a)?e.localize("dialog.clientSettings.tooltips.unlockSetting"):e.localize("dialog.clientSettings.tooltips.lockSetting")}" data-tooltip-direction="UP" data-action="lock"></i>`),o.querySelector('[data-action="lock"]').addEventListener("click",(t=>{r(a)?(delete g.#e[`${a}`],e.setting("lockedSettings",g.#e).then((t=>{o.querySelector('[data-action="lock"]').classList.remove("fa-lock"),o.querySelector('[data-action="lock"]').classList.add("fa-unlock"),o.querySelector('[data-action="lock"]').dataset.tooltip=e.localize("dialog.clientSettings.tooltips.lockSetting")}))):(g.#e[`${a}`]=game.settings.get(i.namespace,i.key),e.setting("lockedSettings",g.#e).then((t=>{o.querySelector('[data-action="lock"]').classList.remove("fa-unlock"),o.querySelector('[data-action="lock"]').classList.add("fa-lock"),o.querySelector('[data-action="lock"]').dataset.tooltip=e.localize("dialog.clientSettings.tooltips.unlockSetting")})))})))}else"client"!=i.scope||game.user.isGM||game.modules.get("force-client-settings")?.active||r(a)&&(o.closest(".form-group").querySelectorAll("input, select, button").forEach((e=>{e.disabled=!0})),o.insertAdjacentHTML("afterbegin",`<i class="fa-solid fa-lock" data-tooltip="${e.localize("dialog.clientSettings.tooltips.lockSetting")}" data-tooltip-direction="UP" data-action="lock"></i>`),e.setting("hideLockedSettings")&&o.closest(".form-group").classList.add("hidden"));"world"==i.scope&&o.insertAdjacentHTML("afterbegin",`<i class="fa-regular fa-earth-americas" data-tooltip="${e.localize("dialog.clientSettings.tooltips.worldSetting")}" data-tooltip-direction="UP"></i>`)}}))};static async renderApplication(t,i,n){i=i[0],"client-settings"==t.id&&i.querySelectorAll(".categories .category .form-group").forEach((t=>{let i=null,n="UNKNOWN";if(t.querySelectorAll("input[name],select[name]").length>0?n=t.querySelectorAll("input[name],select[name]")[0].getAttribute("name"):t.querySelectorAll("button[data-key]").length>0&&(n=t.querySelectorAll("button[data-key]")[0].dataset.key),i=game.settings.settings.get(n),i){let o=t.querySelector("label");const a=n??!1,r=t=>e.setting("lockedSettings").hasOwnProperty(`${t??"MMP-INVALID"}`)??!1;"client"!=i.scope||game.user.isGM||(o.closest(".form-group").querySelectorAll("input, select, button").forEach((e=>{e.disabled=r(a)})),r(a)?o.querySelector('[data-action="lock"]')||o.insertAdjacentHTML("afterbegin",`<i class="fa-solid fa-lock" data-tooltip="${e.localize("dialog.clientSettings.tooltips.lockSetting")}" data-tooltip-direction="UP" data-action="lock"></i>`):o.querySelector('[data-action="lock"]')?.remove(),e.setting("hideLockedSettings")&&r(a)&&setTimeout((()=>{o.closest(".form-group").classList.add("hidden")}),300))}}))}static async closeSettingsConfig(t,i){if(game.user.isGM){for(const[e,t]of Object.entries(g.#e)){const t=game.settings.settings.get(e);t?g.#e[`${e}`]=game.settings.get(t.namespace,t.key):delete g.#e[`${e}`]}e.setting("lockedSettings",g.#e).then((t=>{e.log("UPDATED LOCKED SETTINGS",g.#e)}))}}static async renderSidebarTab(t,i,n){if("settings"==t.options.id){const t={github:/https?:\/\/github.com\/(?<user>[^/]+)\/(?<repo>[^/]+)\/blob\/[^/]+\/(?<path>.*)/,rawGithub:/https?:\/\/raw.githubusercontent.com\/(?<user>[^/]+)\/(?<repo>[^/]+)\/master\/(?<path>.*)/};g.hasPermission&&g.isGMOnline&&(i[0].querySelector("#settings-documentation button:last-child").insertAdjacentHTML("afterend",'<button data-action="changelogs">\n\t\t\t\t\t<i class="fa-solid fa-list"></i> Changelogs\n\t\t\t\t</button>'),i[0].querySelector('#settings-documentation button[data-action="changelogs"]').addEventListener("click",(async t=>{let i=await(game.user.isGM?e.setting("trackedChangelogs"):g.socket.executeAsGM("getGMSetting",{moduleId:e.ID,settingName:"trackedChangelogs"}));new c(i).render(!0)})));let n=await g.checkIfFilesExists(`./systems/${game.system.id}/`,{extensions:[".md"]}),o=!!n&&n.filter((e=>e.toLowerCase().endsWith("README.md".toLowerCase())))[0],a=!!n&&n.filter((e=>e.toLowerCase().endsWith("CHANGELOG.md".toLowerCase())))[0],r=!!n&&n.filter((e=>e.toLowerCase().endsWith("ATTRIBUTIONS.md".toLowerCase())))[0],s=!1;i[0].querySelector("#game-details li.build").classList.add("hidden"),i[0].querySelector("#game-details li.version span").innerHTML=`${game.data.coreUpdate.hasUpdate?`<i class="notification-pip update fas fa-exclamation-circle" data-action="core-update" data-tooltip="${game.i18n.format("SETUP.UpdateAvailable",{type:game.i18n.localize("Software"),channel:game.data.coreUpdate.channel,version:game.data.coreUpdate.version})}"></i> `:""}v${game.version}`,i[0].querySelector(isNewerVersion(game.version,"11")?"#game-details li.system span.system-info":"#game-details li.system span").innerHTML=`${game.data.systemUpdate.hasUpdate?`<i class="notification-pip update fas fa-exclamation-circle" data-action="system-update" data-tooltip="${game.i18n.format("SETUP.UpdateAvailable",{type:game.i18n.localize("System"),channel:game.data.system.title,version:game.data.systemUpdate.version})}"></i> `:""}v${game.system.version}`,(o||a||r||s)&&(i[0].querySelector("#game-details li.system").insertAdjacentHTML("afterend",'<li class="system-buttons"></li>'),(o||(game.system.readme||"").match(t.github)||(game.system.readme||"").match(t.rawGithub))&&(i[0].querySelector("#game-details li.system-buttons").insertAdjacentHTML("beforeend",`<button data-action="readme" data-tooltip="${e.localize("dialog.moduleManagement.tags.readme")}">\n\t\t\t\t\t\t<i class="fa-solid fa-circle-info"></i> ${e.localize("dialog.moduleManagement.tags.readme")}\n\t\t\t\t\t</button>`),i[0].querySelector('#game-details li.system-buttons button[data-action="readme"]').addEventListener("click",(e=>{new c({[game.system.id]:{hasSeen:!1,title:game.system.title??"System",version:game.system.version??"0.0.0",type:"README",isSystem:!0}}).render(!0)}))),(a||(game.system.changelog||"").match(t.github)||(game.system.changelog||"").match(t.rawGithub))&&(i[0].querySelector("#game-details li.system-buttons").insertAdjacentHTML("beforeend",`<button data-action="changelog" data-tooltip="${e.localize("dialog.moduleManagement.tags.changelog")}">\n\t\t\t\t\t\t<i class="fa-solid fa-list"></i> ${e.localize("dialog.moduleManagement.tags.changelog")}\n\t\t\t\t\t</button>`),i[0].querySelector('#game-details li.system-buttons button[data-action="changelog"]').addEventListener("click",(e=>{new c({[game.system.id]:{hasSeen:!1,title:game.system.title??"System",version:game.system.version??"0.0.0",type:"CHANGELOG",isSystem:!0}}).render(!0)}))),(r||(game.system.flags.attributions||"").match(t.github)||(game.system.flags.attributions||"").match(t.rawGithub))&&(i[0].querySelector("#game-details li.system-buttons").insertAdjacentHTML("beforeend",`<button data-action="attributions" data-tooltip="${e.localize("dialog.moduleManagement.tags.attributions")}">\n\t\t\t\t\t\t<i class="fa-brands fa-creative-commons-by"></i> ${e.localize("dialog.moduleManagement.tags.attributions")}\n\t\t\t\t\t</button>`),i[0].querySelector('#game-details li.system-buttons button[data-action="attributions"]').addEventListener("click",(e=>{new c({[game.system.id]:{hasSeen:!1,title:game.system.title??"System",version:game.system.version??"0.0.0",type:"ATTRIBUTIONS",isSystem:!0}}).render(!0)})))),e.log("Show Active Modules",e.setting("showActiveModules")),["hidden","button"].includes(e.setting("showActiveModules"))&&i[0].querySelector("#game-details li.modules").classList.add("hidden"),"button"===e.setting("showActiveModules")&&i[0].querySelector('#settings-game button[data-action="modules"]').insertAdjacentHTML("beforeend",` <small><span class="modules-count-active">${game.modules.filter((e=>e.active)).length}</span><span class="modules-count-total">${game.modules.size}</span></small>`)}}}Hooks.once("setup",(()=>{e.setting("register","enableGlobalConflicts",{type:Boolean,default:!0,config:!1,scope:"world"}),e.setting("register","clientMigratedVersion",{type:String,default:"0.0.0",scope:"world",config:!1}),e.setting("register","worldMigratedVersion",{type:String,default:"0.0.0",scope:"world",config:!1}),e.setting("register","lockedSettings",{type:Object,default:{},scope:"world",config:!1,onChange:async e=>{if(!game.user.isGM){for(const[t,i]of Object.entries(e)){const e=game.settings.settings.get(t);await game.settings.set(e.namespace,e.key,i)}document.querySelector("#client-settings")&&game.settings.sheet.render(!0)}}}),e.setting("register","storePreviousOnPreset",{type:Boolean,default:!0,scope:"world"}),e.setting("register","storedRollback",{type:Object,default:{},scope:"world",config:!1}),e.setting("register","presetsRollbacks",{type:Array,default:[],scope:"world",config:!1}),e.setting("register","lockedModules",{type:Object,default:{"module-credits":!0},scope:"world",config:!1}),e.setting("register","keepPresetsRollbacks",{type:Number,default:5,scope:"world",range:{min:0,max:10,step:1},onChange:t=>{let i=e.setting("presetsRollbacks")??[];if(t>0&&i.length>t){const n=i.length-t;for(let e=0;e<n;e++)i.shift();e.setting("presetsRollbacks",i)}}}),e.setting("register","disableLockedModules",{type:Boolean,default:!1,scope:"world"}),e.setting("register","hideLockedSettings",{type:Boolean,default:!0,scope:"world"}),e.setting("register","disableSyncPrompt",{type:Boolean,default:!0,config:!0,scope:"world"}),e.setting("register","bigPictureMode",{type:Boolean,default:!0,config:!0}),e.setting("register","showActiveModules",{type:String,default:"hidden",config:!0,choices:{hidden:`${e.ID}.settings.showActiveModules.choices.hidden`,button:`${e.ID}.settings.showActiveModules.choices.button`,default:`${e.ID}.settings.showActiveModules.choices.default`}});const t={name:`${e.ID}.settings.trackedChangelogs.name`,hint:`${e.ID}.settings.trackedChangelogs.hint`,type:Object,default:{},config:!1},i={type:Object,default:{},config:!1},n={name:`${e.ID}.settings.showNewChangelogsOnLoad.name`,hint:`${e.ID}.settings.showNewChangelogsOnLoad.hint`,type:Boolean,default:!0,scope:"world"},o={type:Object,default:{},config:!1},a={name:`${e.ID}.settings.autoPrefixModules.name`,hint:`${e.ID}.settings.autoPrefixModules.hint`,type:Boolean,default:!0,config:!1},r={name:`${e.ID}.settings.smartLabels.name`,hint:`${e.ID}.settings.smartLabels.hint`,type:Boolean,default:!0,config:!0},s={name:`${e.ID}.settings.smartPrefix.name`,hint:`${e.ID}.settings.smartPrefix.hint`,type:Boolean,default:!0,config:!0},l={name:`${e.ID}.settings.disableCoreConflicts.name`,hint:`${e.ID}.settings.disableCoreConflicts.hint`,type:Boolean,default:!1,scope:"world",config:!1},c={name:`${e.ID}.settings.enableGlobalConflicts.name`,hint:`${e.ID}.settings.enableGlobalConflicts.hint`,type:Boolean,default:!1,scope:"world",config:!0},d={name:`${e.ID}.settings.addGoogleSheetButton.name`,hint:`${e.ID}.settings.addGoogleSheetButton.hint`,type:Boolean,default:!1,scope:"world",config:!0},u={name:`${e.ID}.settings.dependencyDialogType.name`,hint:`${e.ID}.settings.dependencyDialogType.hint`,type:String,default:"prompt",config:!0,choices:{prompt:`${e.ID}.settings.dependencyDialogType.choices.prompt`,confirm:`${e.ID}.settings.dependencyDialogType.choices.confirm`}};game.modules.get("lib-server-setting")?.active?Hooks.once("lib-server-setting.Setup",(async p=>{p(e.ID,"trackedChangelogs",t),p(e.ID,"showNewChangelogsOnLoad",n),p(e.ID,"renamedModules",o),p(e.ID,"dependencyDialogType",u),p(e.ID,"disableCoreConflicts",l),p(e.ID,"enableGlobalConflicts",c),p(e.ID,"addGoogleSheetButton",d),p(e.ID,"autoPrefixModules",a),p(e.ID,"smartLabels",r),p(e.ID,"smartPrefix",s),p(e.ID,"presets",i)})):(e.setting("register","trackedChangelogs",t),e.setting("register","showNewChangelogsOnLoad",n),e.setting("register","renamedModules",o),e.setting("register","dependencyDialogType",u),e.setting("register","disableCoreConflicts",l),e.setting("register","enableGlobalConflicts",c),e.setting("register","addGoogleSheetButton",d),e.setting("register","autoPrefixModules",a),e.setting("register","smartLabels",r),e.setting("register","smartPrefix",s),e.setting("register","presets",i)),game.settings.settings.set(`core.${ModuleManagement.CONFIG_SETTING}`,foundry.utils.mergeObject(game.settings.settings.get(`core.${ModuleManagement.CONFIG_SETTING}`),{onChange:t=>{if(!foundry.utils.isEmpty(e.setting("storedRollback"))){let t=e.setting("presetsRollbacks")??[];if(t.push(e.setting("storedRollback")),e.setting("keepPresetsRollbacks")>0&&t.length>e.setting("keepPresetsRollbacks")){const i=t.length-e.setting("keepPresetsRollbacks");for(let e=0;e<i;e++)t.shift()}e.setting("presetsRollbacks",t)}}},{inplace:!1}))})),Hooks.once("ready",(async()=>{if(game.modules.get(e.ID),foundry.utils.isNewerVersion("2.0.4",e.setting("clientMigratedVersion"))||foundry.utils.isNewerVersion("2.0.4",e.setting("worldMigratedVersion"))){ui.notifications.info(`<div class="${e.ID}-migration-tooltip-203"><strong>${e.TITLE}:</strong> ${e.localize("migration.v204.starting")}</div>`,{permanent:!0});let t={};for(const[i,n]of Object.entries(e.setting("lockedSettings"))){const e=game.settings.settings.get(i.replace("_","."));e?.namespace&&e?.namespace&&game.settings.get(e.namespace,e.key)&&(t[`${e.namespace}.${e.key}`]=game.settings.get(e.namespace,e.key))}e.setting("lockedSettings",t).then((t=>{Dialog.prompt({id:`${e.ID}-migration-complete`,title:e.TITLE,content:`<p>${e.localize("migration.v204.complete")}</p>`,callback:()=>{e.setting("clientMigratedVersion","2.0.4").then((t=>{e.setting("worldMigratedVersion","2.0.4").then((e=>{location.reload()}))}))}})}))}foundry.utils.isNewerVersion("2.1.2",e.setting("worldMigratedVersion"))&&Dialog.confirm({title:e.localize("title"),content:`<p style="margin-top:0px;">${e.localize("migration.v212.enableGlobalConflicts")}</p> \n\t\t\t\t<div class="notification warning">${e.localize("migration.v212.googleIPWarning")}</div>\n\t\t\t\t<div class="notification info">${e.localize("migration.v212.developersAreFriends")}</div>`,render:e=>e[0].closest(".app.dialog").querySelector("a.header-button.close").remove(),yes:()=>!0,no:()=>!1}).then((async t=>{await e.setting("enableGlobalConflicts",t??!1),await e.setting("clientMigratedVersion","2.1.2"),await e.setting("worldMigratedVersion","2.1.2")})),foundry.utils.isNewerVersion("2.1.4",e.setting("clientMigratedVersion"))&&(ui.notifications.info(`<strong>${e.TITLE}:</strong> ${e.localize("migration.v214.smartLabels")}`),await e.setting("smartLabels",e.setting("autoPrefixModules")??!0),await e.setting("clientMigratedVersion","2.1.4"),await e.setting("worldMigratedVersion","2.1.4"))})),Hooks.once("devModeReady",(({registerPackageDebugFlag:t})=>{t(e.ID,"level",{choiceLabelOverrides:{0:"NONE",1:"ERROR",2:"WARN",3:"DEBUG",4:"INFO",5:"ALL"}})})),Hooks.once("socketlib.ready",(()=>{e.debug("SOCKETLIB Ready - SOCKET"),g.registerSocketLib()})),Hooks.once("ready",(async()=>{async function t(t){const i=t.target,n=game.modules.get(i.name);if(!n.relationships)return!1;const o=Array.from(game.modules).concat([game.system,game.world]),a=(t,n)=>t.reduce(((t,a)=>{const r=e=>i.form.querySelector(`.package input[type="checkbox"][name="${e}"]`).checked;if("system"==(a?.type??"").toLowerCase())return t.concat([]);if(!game.modules.get(a.id))return n||ui.notifications.error(game.i18n.format("MODMANAGE.DepNotInstalled",{missing:a.id})),t.concat([]);if(i.checked&&r(a.id))return t.concat([]);if(!i.checked){let e=o.reduce(((e,t)=>"module"!=(t?.type??"").toLowerCase()||r(t?.id)?e.concat(Array.from(t?.relationships?.requires??[]).concat(Array.from(t?.relationships?.optional??Array.from(t?.relationships?.flags?.optional??[]))).filter((e=>a.id==e.id&&r(e.id)))??[]):e.concat([])),[]);if((e.length??0)>0)return t.concat([])}return r(a.id)==i.checked?t.concat([]):(e.log(i.checked,!e.setting("lockedModules").hasOwnProperty(a.id)),t.concat([foundry.utils.mergeObject(a,{title:game.modules.get(a?.id)?.title??"",isChecked:()=>!!i.checked||!e.setting("lockedModules").hasOwnProperty(a.id),isDisabled:()=>!(!e.setting("disableLockedModules")||!e.setting("lockedModules").hasOwnProperty(a.id))},{inplace:!1})]))}),[]),r=a(Array.from(n?.relationships?.requires??[]),!1),s=a(Array.from(n?.relationships?.recommends??Array.from(n?.relationships?.flags?.recommends??[])),!0),l=a(Array.from(n?.relationships?.optional??Array.from(n?.relationships?.flags?.optional??[])),!0);if(!r?.length&&!s?.length&&!l?.length)return!1;e.log("recommends",s);const c=await renderTemplate(`/modules/${e.ID}/templates/dependencies.hbs`,{id:e.ID,moduleTitle:n.title,enabling:i.checked,numberOfDependencies:(r?.length??0)+(s?.length??0)+(l?.length??0),showRequires:(r?.length??0)>0,showRecommends:(s?.length??0)>0,showOptional:(l?.length??0)>0,requires:r,recommends:s,optionals:l});return Dialog[e.setting("dependencyDialogType")]({title:game.i18n.localize("MODMANAGE.Dependencies"),content:c,render:t=>{e.log("render",t)},[""+("prompt"==e.setting("dependencyDialogType")?"callback":"yes")]:t=>{e.log("callback",t),t[0].querySelectorAll('input[type="checkbox"]').forEach((e=>{e.checked&&(i.form.querySelector(`#module-list .package[data-module-id="${e?.name}"] input[type="checkbox"]`).checked=i.checked,i.form.querySelector(`#module-list .package[data-module-id="${e?.name}"]`).classList.toggle("active",i.checked),i.form.querySelector(`#module-list .package[data-module-id="${e?.name}"]`).classList.toggle("checked",i.checked))}))}})}game.modules.get("lib-wrapper")?.active?libWrapper.register(e.ID,"ModuleManagement.prototype._onChangeCheckbox",t,"OVERRIDE"):ModuleManagement.prototype._onChangeCheckbox=t})),Hooks.once("lib-themer.Ready",(t=>{t.register(`/modules/${e.ID}/styles/TidyMMW.theme`)})),Hooks.once("init",(()=>{Hooks.on("renderSidebarTab",g.renderSidebarTab)})),Hooks.once("ready",(async()=>{g.init(),game.modules.get("force-client-settings")?.active||(Hooks.on("renderApplication",g.renderApplication),Hooks.on("closeSettingsConfig",g.closeSettingsConfig))})),Hooks.on("renderModuleManagement",g.renderModuleManagement),Hooks.on("renderSettingsConfig",g.renderSettingsConfig),Handlebars.registerHelper("incIndex",(function(e,t){return parseInt(e)+1}));