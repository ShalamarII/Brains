{"version":3,"file":"token-action-hud-dnd5e.min.js","sources":["constants.js","utils.js","action-handler.js","defaults.js","magic-items-extender.js","roll-handler.js","settings.js","system-manager.js","init.js"],"sourcesContent":["/**\n * Module-based constants\n */\nexport const MODULE = {\n  ID: \"token-action-hud-dnd5e\"\n};\n\n/**\n * Core module\n */\nexport const CORE_MODULE = {\n  ID: \"token-action-hud-core\"\n};\n\n/**\n * Core module version required by the system module\n */\nexport const REQUIRED_CORE_MODULE_VERSION = \"2.0\";\n\n/**\n * Action type\n */\nexport const ACTION_TYPE = {\n  ability: \"DND5E.Ability\",\n  check: \"tokenActionHud.dnd5e.check\",\n  condition: \"tokenActionHud.dnd5e.condition\",\n  counter: \"tokenActionHud.dnd5e.counter\",\n  effect: \"DND5E.Effect\",\n  exhaustion: \"DND5E.Exhaustion\",\n  feature: \"TYPES.Item.feat\",\n  item: \"tokenActionHud.dnd5e.item\",\n  save: \"DND5E.SAVE.Title.one\",\n  skill: \"tokenActionHud.dnd5e.skill\",\n  spell: \"TYPES.Item.spell\",\n  utility: \"DND5E.ActionUtil\"\n};\n\n/**\n * Activation types\n */\nexport const ACTIVATION_TYPE = {\n  action: { group: \"actions\" },\n  bonus: { group: \"bonus-actions\", icon: \"fas fa-plus\" },\n  crew: { group: \"crew-actions\", icon: \"fas fa-users\" },\n  day: { icon: \"fas fa-hourglass-end\" },\n  hour: { icon: \"fas fa-hourglass-half\" },\n  lair: { group: \"lair-actions\", icon: \"fas fa-home\" },\n  minute: { icon: \"fas fa-hourglass-start\" },\n  legendary: { group: \"legendary-actions\", icon: \"fas fas fa-dragon\" },\n  reaction: { group: \"reactions\", icon: \"fas fa-bolt\" },\n  reactiondamage: { group: \"reactions\", icon: \"fas fa-bolt\" },\n  reactionmanual: { group: \"reactions\", icon: \"fas fa-bolt\" },\n  special: { group: \"special-actions\", icon: \"fas fa-star\" },\n  other: { group: \"other-actions\" }\n};\n\n/**\n * Concentration icon\n */\nexport const CONCENTRATION_ICON = \"systems/dnd5e/icons/svg/statuses/concentrating.svg\";\n\nexport const CUSTOM_DND5E = {\n  ID: \"custom-dnd5e\",\n  COUNTERS: {\n    character: \"character-counters\",\n    group: \"group-counters\",\n    npc: \"npc-counters\"\n  }\n};\n\n/**\n * Feature Group IDs\n */\nexport const FEATURE_GROUP_IDS = [\n  \"activeFeatures\",\n  \"passiveFeatures\",\n  \"backgroundFeatures\",\n  \"classFeatures\",\n  \"feats\",\n  \"monsterFeatures\",\n  \"raceFeatures\",\n  \"artificerInfusions\",\n  \"channelDivinity\",\n  \"defensiveTactics\",\n  \"eldritchInvocations\",\n  \"elementalDisciplines\",\n  \"fightingStyles\",\n  \"huntersPrey\",\n  \"kiAbilities\",\n  \"maneuvers\",\n  \"metamagicOptions\",\n  \"multiattacks\",\n  \"pactBoons\",\n  \"psionicPowers\",\n  \"runes\",\n  \"superiorHuntersDefense\"\n];\n\n/**\n * Groups\n */\nexport const GROUP = {\n  _1stLevelSpells: { id: \"1st-level-spells\", name: \"tokenActionHud.dnd5e.1stLevelSpells\", spellMode: 1, type: \"system\" },\n  _2ndLevelSpells: { id: \"2nd-level-spells\", name: \"tokenActionHud.dnd5e.2ndLevelSpells\", spellMode: 2, type: \"system\" },\n  _3rdLevelSpells: { id: \"3rd-level-spells\", name: \"tokenActionHud.dnd5e.3rdLevelSpells\", spellMode: 3, type: \"system\" },\n  _4thLevelSpells: { id: \"4th-level-spells\", name: \"tokenActionHud.dnd5e.4thLevelSpells\", spellMode: 4, type: \"system\" },\n  _5thLevelSpells: { id: \"5th-level-spells\", name: \"tokenActionHud.dnd5e.5thLevelSpells\", spellMode: 5, type: \"system\" },\n  _6thLevelSpells: { id: \"6th-level-spells\", name: \"tokenActionHud.dnd5e.6thLevelSpells\", spellMode: 6, type: \"system\" },\n  _7thLevelSpells: { id: \"7th-level-spells\", name: \"tokenActionHud.dnd5e.7thLevelSpells\", spellMode: 7, type: \"system\" },\n  _8thLevelSpells: { id: \"8th-level-spells\", name: \"tokenActionHud.dnd5e.8thLevelSpells\", spellMode: 8, type: \"system\" },\n  _9thLevelSpells: { id: \"9th-level-spells\", name: \"tokenActionHud.dnd5e.9thLevelSpells\", spellMode: 9, type: \"system\" },\n  abilities: { id: \"abilities\", name: \"tokenActionHud.dnd5e.abilities\", type: \"system\" },\n  actions: { id: \"actions\", name: \"DND5E.ActionPl\", type: \"system\" },\n  activeFeatures: { id: \"active-features\", name: \"tokenActionHud.dnd5e.activeFeatures\", type: \"system\" },\n  artificerInfusions: { id: \"artificer-infusions\", name: \"tokenActionHud.dnd5e.artificerInfusions\", type: \"system\" },\n  atWillSpells: { id: \"at-will-spells\", name: \"tokenActionHud.dnd5e.atWillSpells\", spellMode: \"atwill\", type: \"system\" },\n  backgroundFeatures: { id: \"background-features\", name: \"tokenActionHud.dnd5e.backgroundFeatures\", type: \"system\" },\n  bonusActions: { id: \"bonus-actions\", name: \"tokenActionHud.dnd5e.bonusActions\", type: \"system\" },\n  cantrips: { id: \"cantrips\", name: \"tokenActionHud.dnd5e.cantrips\", spellMode: 0, type: \"system\" },\n  channelDivinity: { id: \"channel-divinity\", name: \"tokenActionHud.dnd5e.channelDivinity\", type: \"system\" },\n  checks: { id: \"checks\", name: \"tokenActionHud.dnd5e.checks\", type: \"system\" },\n  classFeatures: { id: \"class-features\", name: \"tokenActionHud.dnd5e.classFeatures\", type: \"system\" },\n  combat: { id: \"combat\", name: \"tokenActionHud.combat\", type: \"system\" },\n  conditions: { id: \"conditions\", name: \"tokenActionHud.dnd5e.conditions\", type: \"system\" },\n  consumables: { id: \"consumables\", name: \"TYPES.Item.consumablePl\", type: \"system\" },\n  containers: { id: \"containers\", name: \"TYPES.Item.containerPl\", type: \"system\" },\n  counters: { id: \"counters\", name: \"tokenActionHud.dnd5e.counters\", type: \"system\" },\n  crewActions: { id: \"crew-actions\", name: \"tokenActionHud.dnd5e.crewActions\", type: \"system\" },\n  defensiveTactics: { id: \"defensive-tactics\", name: \"tokenActionHud.dnd5e.defensiveTactics\", type: \"system\" },\n  eldritchInvocations: { id: \"eldritch-invocations\", name: \"tokenActionHud.dnd5e.eldritchInvocations\", type: \"system\" },\n  elementalDisciplines: { id: \"elemental-disciplines\", name: \"tokenActionHud.dnd5e.elementalDisciplines\", type: \"system\" },\n  equipment: { id: \"equipment\", name: \"TYPES.Item.equipmentPl\", type: \"system\" },\n  equipped: { id: \"equipped\", name: \"DND5E.Equipped\", type: \"system\" },\n  exhaustion: { id: \"exhaustion\", name: \"DND5E.Exhaustion\", type: \"system\" },\n  feats: { id: \"feats\", name: \"tokenActionHud.dnd5e.feats\", type: \"system\" },\n  fightingStyles: { id: \"fighting-styles\", name: \"tokenActionHud.dnd5e.fightingStyles\", type: \"system\" },\n  huntersPrey: { id: \"hunters-prey\", name: \"tokenActionHud.dnd5e.huntersPrey\", type: \"system\" },\n  innateSpells: { id: \"innate-spells\", name: \"tokenActionHud.dnd5e.innateSpells\", spellMode: \"innate\", type: \"system\" },\n  kiAbilities: { id: \"ki-abilities\", name: \"tokenActionHud.dnd5e.kiAbilities\", type: \"system\" },\n  lairActions: { id: \"lair-actions\", name: \"tokenActionHud.dnd5e.lairActions\", type: \"system\" },\n  legendaryActions: { id: \"legendary-actions\", name: \"tokenActionHud.dnd5e.legendaryActions\", type: \"system\" },\n  loot: { id: \"loot\", name: \"TYPES.Item.lootPl\", type: \"system\" },\n  maneuvers: { id: \"maneuvers\", name: \"tokenActionHud.dnd5e.maneuvers\", type: \"system\" },\n  metamagicOptions: { id: \"metamagic-options\", name: \"tokenActionHud.dnd5e.metamagicOptions\", type: \"system\" },\n  monsterFeatures: { id: \"monster-features\", name: \"tokenActionHud.dnd5e.monsterFeatures\", type: \"system\" },\n  multiattacks: { id: \"multiattacks\", name: \"tokenActionHud.dnd5e.multiattacks\", type: \"system\" },\n  otherActions: { id: \"other-actions\", name: \"tokenActionHud.dnd5e.otherActions\", type: \"system\" },\n  pactBoons: { id: \"pact-boons\", name: \"tokenActionHud.dnd5e.pactBoons\", type: \"system\" },\n  pactSpells: { id: \"pact-spells\", name: \"tokenActionHud.dnd5e.pactSpells\", spellMode: \"pact\", type: \"system\" },\n  passiveEffects: { id: \"passive-effects\", name: \"DND5E.EffectPassive\", type: \"system\" },\n  passiveFeatures: { id: \"passive-features\", name: \"tokenActionHud.dnd5e.passiveFeatures\", type: \"system\" },\n  psionicPowers: { id: \"psionic-powers\", name: \"tokenActionHud.dnd5e.psionicPowers\", type: \"system\" },\n  raceFeatures: { id: \"race-features\", name: \"tokenActionHud.dnd5e.raceFeatures\", type: \"system\" },\n  reactions: { id: \"reactions\", name: \"DND5E.ReactionPl\", type: \"system\" },\n  rests: { id: \"rests\", name: \"tokenActionHud.dnd5e.rests\", type: \"system\" },\n  runes: { id: \"runes\", name: \"tokenActionHud.dnd5e.runes\", type: \"system\" },\n  saves: { id: \"saves\", name: \"DND5E.ClassSaves\", type: \"system\" },\n  skills: { id: \"skills\", name: \"tokenActionHud.dnd5e.skills\", type: \"system\" },\n  superiorHuntersDefense: { id: \"superior-hunters-defense\", name: \"tokenActionHud.dnd5e.superiorHuntersDefense\", type: \"system\" },\n  temporaryEffects: { id: \"temporary-effects\", name: \"DND5E.EffectTemporary\", type: \"system\" },\n  token: { id: \"token\", name: \"tokenActionHud.token\", type: \"system\" },\n  tools: { id: \"tools\", name: \"TYPES.Item.toolPl\", type: \"system\" },\n  unequipped: { id: \"unequipped\", name: \"DND5E.Unequipped\", type: \"system\" },\n  utility: { id: \"utility\", name: \"tokenActionHud.utility\", type: \"system\" },\n  weapons: { id: \"weapons\", name: \"TYPES.Item.weaponPl\", type: \"system\" }\n};\n\n/**\n * Prepared icon\n */\nexport const PREPARED_ICON = \"fas fa-sun\";\n\n/**\n * Proficiency level icons\n */\nexport const PROFICIENCY_LEVEL_ICON = {\n  0: \"fa-regular fa-circle\",\n  0.5: \"fa-regular fa-circle-half-stroke\",\n  1: \"fa-solid fa-circle\",\n  2: \"fa-regular fa-circle-dot\"\n};\n\n/**\n * Rarity\n */\nexport const RARITY = {\n  common: \"tokenActionHud.dnd5e.common\",\n  uncommon: \"tokenActionHud.dnd5e.uncommon\",\n  rare: \"tokenActionHud.dnd5e.rare\",\n  veryRare: \"tokenActionHud.dnd5e.veryRare\",\n  legendary: \"tokenActionHud.dnd5e.legendary\",\n  artifact: \"tokenActionHud.dnd5e.artifact\"\n};\n\n/**\n * Ritual icon\n */\nexport const RITUAL_ICON = \"fas fa-circle-r\";\n\n/**\n * Spell Group IDs\n */\nexport const SPELL_GROUP_IDS = [\n  \"cantrips\",\n  \"_1stLevelSpells\",\n  \"_2ndLevelSpells\",\n  \"_3rdLevelSpells\",\n  \"_4thLevelSpells\",\n  \"_5thLevelSpells\",\n  \"_6thLevelSpells\",\n  \"_7thLevelSpells\",\n  \"_8thLevelSpells\",\n  \"_9thLevelSpells\",\n  \"atWillSpells\",\n  \"innateSpells\",\n  \"pactSpells\"\n];\n","import { MODULE } from \"./constants.js\";\n\nexport let Utils = null;\n\nHooks.once(\"tokenActionHudCoreApiReady\", async coreModule => {\n  Utils = class Utils {\n    /**\n     * Capitalize the first letter of every word\n     * @param {string} value The string to capitalize\n     * @returns {string}     The capitalized string\n     */\n    static capitalize(value) {\n      return value.replace(\n        /\\w\\S*/g,\n        text => text.charAt(0).toUpperCase() + text.substring(1).toLowerCase()\n      );\n    }\n\n    /**\n     * Get setting value\n     * @param {string} key The key\n     * @param {string=null} defaultValue The default value\n     * @returns {*} The setting value\n     */\n    static getSetting(key, defaultValue = null) {\n      let value = defaultValue ?? null;\n      try {\n        value = game.settings.get(MODULE.ID, key);\n      } catch{\n        coreModule.api.Logger.debug(`Setting '${key}' not found`);\n      }\n      return value;\n    }\n\n    /**\n     * Set setting value\n     * @param {string} key The key\n     * @param {string} value The value\n     */\n    static async setSetting(key, value) {\n      try {\n        value = await game.settings.set(MODULE.ID, key, value);\n        coreModule.api.Logger.debug(`Setting '${key}' set to '${value}'`);\n      } catch{\n        coreModule.api.Logger.debug(`Setting '${key}' not found`);\n      }\n    }\n  };\n});\n","// System Module Imports\nimport {\n  ACTIVATION_TYPE, ACTION_TYPE, CONCENTRATION_ICON, CUSTOM_DND5E, FEATURE_GROUP_IDS,\n  GROUP, PREPARED_ICON, PROFICIENCY_LEVEL_ICON, RARITY, SPELL_GROUP_IDS\n} from \"./constants.js\";\nimport { Utils } from \"./utils.js\";\n\nexport let ActionHandler = null;\n\nHooks.once(\"tokenActionHudCoreApiReady\", async coreModule => {\n  ActionHandler = class ActionHandler extends coreModule.api.ActionHandler {\n    // Initialize action variables\n    featureActions = null;\n\n    inventoryActions = null;\n\n    spellActions = null;\n\n    /**\n     * Build System Actions\n     * @override\n     * @param {Array} groupIds\n     * @returns {object}\n     */\n    async buildSystemActions(groupIds) {\n      // Set actor and token variables\n      this.actors = (!this.actor) ? this.#getValidActors() : [this.actor];\n      this.tokens = (!this.token) ? this.#getValidTokens() : [this.token];\n\n      // Set items variable\n      if (this.actor) {\n        this.items = coreModule.api.Utils.sortItemsByName(this.#discardSlowItems(this.actor.items));\n      }\n\n      // Set settings variables\n      this.abbreviateSkills = Utils.getSetting(\"abbreviateSkills\");\n      this.displaySpellInfo = Utils.getSetting(\"displaySpellInfo\");\n      this.showItemsWithoutActivationCosts = Utils.getSetting(\"showItemsWithoutActivationCosts\");\n      this.showUnchargedItems = Utils.getSetting(\"showUnchargedItems\");\n      this.showUnequippedItems = Utils.getSetting(\"showUnequippedItems\");\n      if (this.actor?.type === \"npc\" && !this.showUnequippedItems) {\n        this.showUnequippedItems = Utils.getSetting(\"showUnequippedItemsNpcs\");\n      }\n      this.showUnpreparedSpells = Utils.getSetting(\"showUnpreparedSpells\");\n\n      this.activationgroupIds = [\n        \"actions\",\n        \"bonus-actions\",\n        \"crew-actions\",\n        \"lair-actions\",\n        \"legendary-actions\",\n        \"reactions\",\n        \"other-actions\"\n      ];\n\n      if (this.actor?.type === \"character\" || this.actor?.type === \"npc\") {\n        this.inventorygroupIds = [\n          \"equipped\",\n          \"consumables\",\n          \"containers\",\n          \"equipment\",\n          \"loot\",\n          \"tools\",\n          \"weapons\",\n          \"unequipped\"\n        ];\n\n        await this.#buildCharacterActions();\n      } else if (this.actor?.type === \"vehicle\") {\n        this.inventorygroupIds = [\n          \"consumables\",\n          \"equipment\",\n          \"tools\",\n          \"weapons\"\n        ];\n\n        await this.#buildVehicleActions();\n      } else if (!this.actor) {\n        await this.#buildMultipleTokenActions();\n      }\n    }\n\n    /**\n     * Build character actions\n     * @private\n     * @returns {object}\n     */\n    async #buildCharacterActions() {\n      await Promise.all([\n        this.#buildConditions(),\n        this.#buildEffects(),\n        this.#buildFeatures(),\n        this.#buildInventory(),\n        this.#buildSpells()\n      ]);\n      this.#buildAbilities(\"ability\", \"abilities\");\n      this.#buildAbilities(\"check\", \"checks\");\n      this.#buildAbilities(\"save\", \"saves\");\n      this.#buildCombat();\n      this.#buildCounters();\n      this.#buildExhaustion();\n      this.#buildRests();\n      this.#buildSkills();\n      this.#buildUtility();\n    }\n\n    /**\n     * Build vehicle actions\n     * @private\n     * @returns {object}\n     */\n    async #buildVehicleActions() {\n      await Promise.all([\n        this.#buildConditions(),\n        this.#buildEffects(),\n        this.#buildFeatures(),\n        this.#buildInventory()\n      ]);\n      this.#buildAbilities(\"ability\", \"abilities\");\n      this.#buildAbilities(\"check\", \"checks\");\n      this.#buildAbilities(\"save\", \"saves\");\n      this.#buildCombat();\n      this.#buildUtility();\n    }\n\n    /**\n     * Build multiple token actions\n     * @private\n     * @returns {object}\n     */\n    async #buildMultipleTokenActions() {\n      this.#buildAbilities(\"ability\", \"abilities\");\n      this.#buildAbilities(\"check\", \"checks\");\n      this.#buildAbilities(\"save\", \"saves\");\n      this.#buildCombat();\n      await this.#buildConditions();\n      this.#buildRests();\n      this.#buildSkills();\n      this.#buildUtility();\n    }\n\n    /**\n     * Build abilities\n     * @private\n     * @param {string} actionType\n     * @param {string} groupId\n     */\n    #buildAbilities(actionType, groupId) {\n      // Get abilities and exit if none exist\n      const abilities = this.actor?.system.abilities || CONFIG.DND5E.abilities;\n      if (abilities.length === 0) return;\n\n      // Get actions\n      const actions = Object.entries(abilities)\n        .filter(ability => abilities[ability[0]].value !== 0)\n        .map(([abilityId, ability]) => {\n          const name = CONFIG.DND5E.abilities[abilityId].label;\n          const mod = (groupId === \"saves\") ? ability?.save : ability?.mod;\n          return {\n            id: `${actionType}-${abilityId}`,\n            name: (this.abbreviateSkills) ? Utils.capitalize(abilityId) : name,\n            icon1: (groupId !== \"checks\") ? this.#getProficiencyIcon(abilities[abilityId].proficient) : \"\",\n            info1: (this.actor) ? {\n              text: coreModule.api.Utils.getModifier(mod),\n              title: `${game.i18n.localize(\"DND5E.ActionAbil\")}: ${coreModule.api.Utils.getModifier(mod)}`\n            } : null,\n            info2: (this.actor && groupId === \"abilities\") ? {\n              text: `(${coreModule.api.Utils.getModifier(ability?.save)})`,\n              title: `${game.i18n.localize(\"DND5E.SavingThrow\")}: ${coreModule.api.Utils.getModifier(ability?.save)}`\n            } : null,\n            listName: this.#getListName(actionType, name),\n            system: { actionType, actionId: abilityId }\n          };\n        });\n\n      // Add actions to action list\n      this.addActions(actions, { id: groupId });\n    }\n\n    /**\n     * Build activations\n     * @public\n     * @param {object} data  groupData, actionData, actionType\n     */\n    async buildActivations(data) {\n      const { groupData, actionData, actionType = \"item\" } = data;\n\n      // Create map of items according to activation type\n      const activationItems = new Map();\n\n      // Loop items and add to activationItems\n      for (const [key, value] of actionData) {\n        const activationType = value.system?.activities?.contents[0]?.activation?.type;\n        const groupId = ACTIVATION_TYPE[activationType]?.group ?? \"other\";\n        if (!activationItems.has(groupId)) activationItems.set(groupId, new Map());\n        activationItems.get(groupId).set(key, value);\n      }\n\n      // Loop through action group ids\n      for (const value of Object.values(ACTIVATION_TYPE)) {\n        const group = value.group;\n\n        // Skip if no items exist\n        if (!activationItems.has(group)) continue;\n\n        // Clone and add to group data\n        const groupDataClone = { ...groupData, id: `${group}+${groupData.id}`, type: \"system-derived\" };\n\n        // Set Equipped and Unequipped groups to not selected by default\n        if ([\"equipped\", \"unequipped\"].includes(groupData.id)) { groupDataClone.defaultSelected = false; }\n\n        // Create parent group data\n        const parentgroupData = { id: group, type: \"system\" };\n\n        // Add group to HUD\n        await this.addGroup(groupDataClone, parentgroupData);\n\n        // Add spell slot info to group\n        if (actionType === \"spell\") { this.addGroupInfo(groupDataClone); }\n\n        // Build actions\n        await this.buildActions({\n          groupData: groupDataClone,\n          actionData: activationItems.get(group),\n          actionType\n        });\n      }\n    }\n\n    /**\n     * Build combat\n     * @private\n     */\n    #buildCombat() {\n      // If token's turn, include endTurn\n      const combatType = {\n        initiative: \"tokenActionHud.dnd5e.rollInitiative\",\n        ...(game.combat?.current?.tokenId === this.token?.id && { endTurn: \"tokenActionHud.endTurn\" })\n      };\n\n      const tokens = coreModule.api.Utils.getControlledTokens();\n      const tokenIds = tokens?.map(token => token.id);\n      const combatants = (game.combat)\n        ? game.combat.combatants.filter(combatant => tokenIds.includes(combatant.tokenId))\n        : [];\n\n      const getInfo1 = id => {\n        if (id === \"initiative\" && combatants.length === 1) {\n          const currentInitiative = combatants[0].initiative;\n          return { class: \"tah-spotlight\", text: currentInitiative };\n        }\n        return {};\n      };\n\n      const getActive = () => { return combatants.length > 0 && (combatants.every(combatant => combatant?.initiative)) ? \" active\" : \"\";};\n\n      // Get actions\n      const actionType = \"utility\";\n      const actions = Object.entries(combatType).map(([id, name]) => {\n        return {\n          id,\n          name: game.i18n.localize(name),\n          info1: getInfo1(id),\n          cssClass: (id === \"initiative\" ) ? `toggle${getActive()}` : \"\",\n          listName: this.#getListName(actionType, name),\n          system: { actionType, actionId: id }\n        };\n      });\n\n      // Add actions to HUD\n      this.addActions(actions, { id: \"combat\" });\n    }\n\n    /**\n     * Build conditions\n     * @private\n     */\n    async #buildConditions() {\n      if (this.tokens?.length === 0) return;\n\n      // Get conditions and exit if none exist\n      const conditions = CONFIG.statusEffects.filter(condition => condition.id !== \"\");\n      if (conditions.length === 0) return;\n\n      // Get actions\n      const actionType = \"condition\";\n      const actions = await Promise.all(conditions.map(async condition => {\n        const hasCondition = this.actors.every(actor => {\n          return actor.effects.some(effect => effect.statuses.some(status => status === condition.id)\n          && !effect?.disabled);\n        });\n        const name = game.i18n.localize(condition.label) ?? condition.name;\n        return {\n          id: condition.id,\n          name,\n          img: coreModule.api.Utils.getImage(condition),\n          cssClass: `toggle${(hasCondition) ? \" active\" : \"\"}`,\n          listName: this.#getListName(actionType, name),\n          tooltip: await this.#getTooltip(await this.#getConditionTooltipData(condition.id, condition.name)),\n          system: { actionType, actionId: condition.id }\n        };\n      }));\n\n      // Add actions to HUD\n      this.addActions(actions, { id: \"conditions\" });\n    }\n\n    /**\n     * Build counters\n     * @private\n     */\n    async #buildCounters() {\n      if (!coreModule.api.Utils.isModuleActive(CUSTOM_DND5E.ID)\n        || !CUSTOM_DND5E.COUNTERS[this.actor?.type]) return;\n\n      const actionType = \"counter\";\n\n      let counters = game.settings.get(CUSTOM_DND5E.ID, CUSTOM_DND5E.COUNTERS[this.actor?.type]) ?? {};\n\n      if (coreModule.api.Utils.isModuleActive(CUSTOM_DND5E.ID) && Object.keys(counters).length) {\n        counters = Object.entries(counters)\n          .filter(([_, value]) => value.visible)\n          .map(([key, value]) => {\n            value.key = key;\n            return value;\n          });\n      } else {\n        counters = [\n          {\n            name: game.i18n.localize(\"DND5E.DeathSave\"),\n            type: \"successFailure\",\n            system: true,\n            visible: true,\n            key: \"death-saves\"\n          },\n          {\n            name: game.i18n.localize(\"DND5E.Exhaustion\"),\n            type: \"number\",\n            system: true,\n            visible: true,\n            key: \"exhaustion\"\n          },\n          {\n            name: game.i18n.localize(\"DND5E.Inspiration\"),\n            type: \"checkbox\",\n            system: true,\n            visible: true,\n            key: \"inspiration\"\n          }\n        ];\n      }\n\n      // Get actions\n      const actions = counters.map(counter => {\n        let active = \"\";\n        let cssClass = \"\";\n        let img = \"\";\n        let info1 = \"\";\n        if (counter.system) {\n          switch (counter.key) {\n            case \"exhaustion\":\n              active = (this.actor.system.attributes.exhaustion > 0) ? \" active\" : \"\";\n              cssClass = `toggle${active}`;\n              img = coreModule.api.Utils.getImage(\"modules/token-action-hud-dnd5e/icons/exhaustion.svg\");\n              info1 = { text: this.actor.system.attributes.exhaustion };\n              break;\n            case \"death-saves\":\n              img = coreModule.api.Utils.getImage(\"modules/token-action-hud-dnd5e/icons/death-saves.svg\");\n              info1 = { text: `${this.actor.system.attributes.death.success}/${this.actor.system.attributes.death.failure}` };\n              break;\n            case \"inspiration\":\n              active = (this.actor.system.attributes.inspiration) ? \" active\" : \"\";\n              cssClass = `toggle${active}`;\n              img = coreModule.api.Utils.getImage(\"modules/token-action-hud-dnd5e/icons/inspiration.svg\");\n              break;\n          }\n        } else {\n          const value = this.actor.getFlag(CUSTOM_DND5E.ID, counter.key);\n          switch (counter.type) {\n            case \"checkbox\":\n              active = (value) ? \" active\" : \"\";\n              cssClass = `toggle${active}`;\n              break;\n            case \"fraction\":\n              active = (value.value > 0) ? \" active\" : \"\";\n              cssClass = `toggle${active}`;\n              info1 = { text: `${value.value ?? 0}/${value.max ?? 0}` };\n              break;\n            case \"number\":\n              active = (value > 0) ? \" active\" : \"\";\n              cssClass = `toggle${active}`;\n              info1 = { text: value };\n              break;\n            case \"successFailure\":\n              info1 = { text: `${value?.success ?? 0}/${value?.failure ?? 0}` };\n              break;\n          }\n        }\n\n        return {\n          id: counter.key,\n          name: counter.label,\n          listName: this.#getListName(actionType, counter.name),\n          cssClass,\n          img,\n          info1,\n          system: { actionType, counterKey: counter.key, counterType: counter.type}\n        };\n      });\n\n      // Add actions to HUD\n      this.addActions(actions, { id: \"counters\" });\n    }\n\n    /**\n     * Build effects\n     * @private\n     */\n    async #buildEffects() {\n      const actionType = \"effect\";\n\n      // Get effects and exit if none exist\n      const effects = new Map(this.actor.allApplicableEffects().map(effect => [effect.id, effect]));\n      if (effects.size === 0) return;\n\n      // Map passive and temporary effects to new maps\n      const passiveEffects = new Map();\n      const temporaryEffects = new Map();\n      const statusEffectIds = new Set(CONFIG.statusEffects.map(statusEffect => statusEffect._id));\n\n      // Iterate effects and add to a map based on the isTemporary value\n      for (const [effectId, effect] of effects.entries()) {\n        if (effect.isSuppressed) continue;\n        if (effect.parent?.system?.identified === false && !game.user.isGM) continue;\n        if (statusEffectIds.has(effect.id)) continue;\n\n        if (effect.isTemporary) { temporaryEffects.set(effectId, effect); }\n        else { passiveEffects.set(effectId, effect); }\n      }\n\n      // Build passive and temporary effects\n      await Promise.all([\n        this.buildActions({ groupData: { id: \"passive-effects\" }, actionData: passiveEffects, actionType }),\n        this.buildActions({ groupData: { id: \"temporary-effects\" }, actionData: temporaryEffects, actionType })\n      ]);\n    }\n\n    /**\n     * Build exhaustion\n     * @private\n     */\n    #buildExhaustion() {\n      // Exit if every actor is not the character type\n      if (!this.actors.every(actor => actor.type === \"character\")) return;\n\n      // Get actions\n      const actionType = \"exhaustion\";\n      const active = this.actor.system.attributes.exhaustion > 0 ? \" active\" : \"\";\n      const actions = [{\n        id: \"exhaustion\",\n        name: game.i18n.localize(\"DND5E.Exhaustion\"),\n        cssClass: `toggle${active}`,\n        img: coreModule.api.Utils.getImage(\"modules/token-action-hud-dnd5e/icons/exhaustion.svg\"),\n        info1: { text: this.actor.system.attributes.exhaustion },\n        listName: this.#getListName(actionType, name),\n        system: { actionType, actionId: \"exhaustion\" }\n      }];\n\n      // Add actions to HUD\n      this.addActions(actions, { id: \"exhaustion\" });\n    }\n\n    /**\n     * Build features\n     * @private\n     */\n    async #buildFeatures() {\n      // Filter feats from items and exit if none exist\n      const feats = new Map([...this.items].filter(([, value]) => value.type === \"feat\"));\n      if (feats.size === 0) return;\n\n      // Map active and passive features to new maps\n      const featuresMap = new Map([\n        [\"activeFeatures\", new Map()],\n        [\"passiveFeatures\", new Map()]\n      ]);\n\n      const featureType = {\n        background: \"backgroundFeatures\",\n        class: \"classFeatures\",\n        monster: \"monsterFeatures\",\n        race: \"raceFeatures\",\n        feats: \"feats\"\n      };\n\n      const classFeatureType = {\n        artificerInfusion: \"artificerInfusions\",\n        channelDivinity: \"channelDivinity\",\n        defensiveTactic: \"defensiveTactics\",\n        eldritchInvocation: \"eldritchInvocations\",\n        elementalDiscipline: \"elementalDisciplines\",\n        fightingStyle: \"fightingStyles\",\n        huntersPrey: \"huntersPrey\",\n        ki: \"kiAbilities\",\n        maneuver: \"maneuvers\",\n        metamagic: \"metamagicOptions\",\n        multiattack: \"multiattacks\",\n        pact: \"pactBoons\",\n        psionicPower: \"psionicPowers\",\n        rune: \"runes\",\n        superiorHuntersDefense: \"superiorHuntersDefense\"\n      };\n\n      for (const [key, value] of feats) {\n        const activationType = value.system.activities.contents[0]?.type;\n        const type = value.system.type.value;\n        const subType = value.system.type?.subtype;\n\n        if (activationType) { featuresMap.get(\"activeFeatures\").set(key, value); }\n        else { featuresMap.get(\"passiveFeatures\").set(key, value); }\n\n        // Map feature types\n        if (featureType[type]) {\n          if (!featuresMap.has(featureType[type])) featuresMap.set(featureType[type], new Map());\n          featuresMap.get(featureType[type]).set(key, value);\n        }\n\n        // Map class feature subtypes\n        if (classFeatureType[subType]) {\n          if (!featuresMap.has(classFeatureType[subType])) featuresMap.set(classFeatureType[subType], new Map());\n          featuresMap.get(classFeatureType[subType]).set(key, value);\n        }\n      }\n\n      // Loop through inventory groups ids\n      for (const id of FEATURE_GROUP_IDS) {\n        const actionData = featuresMap.get(id);\n        if (!actionData || actionData.size === 0) continue;\n\n        // Create group data\n        const groupData = {\n          id: GROUP[id].id,\n          name: game.i18n.localize(GROUP[id].name) ?? \"\"\n        };\n\n        // Build actions and activations\n        const actionType = \"feature\";\n        await this.buildActions({ groupData, actionData, actionType });\n        await this.buildActivations({ groupData, actionData, actionType });\n      }\n    }\n\n    /**\n     * Build inventory\n     * @private\n     */\n    async #buildInventory() {\n      // Exit early if no items exist\n      if (this.items.size === 0) return;\n\n      // Initialize inventory map categories\n      const inventoryMap = new Map([\n        [\"equipped\", new Map()],\n        [\"unequipped\", new Map()],\n        [\"consumables\", new Map()],\n        [\"containers\", new Map()],\n        [\"equipment\", new Map()],\n        [\"loot\", new Map()],\n        [\"tools\", new Map()],\n        [\"weapons\", new Map()]\n      ]);\n\n      for (const [key, value] of this.items) {\n        // Set items into maps\n        if (value.system?.quantity > 0 && this.#isActiveItem(value)) {\n          if (value.system.equipped) { inventoryMap.get(\"equipped\").set(key, value); }\n          else { inventoryMap.get(\"unequipped\").set(key, value); }\n\n          if (this.#isUsableItem(value) && value.type === \"consumable\") inventoryMap.get(\"consumables\").set(key, value);\n          if (this.#isEquippedItem(value)) {\n            switch (value.type) {\n              case \"container\": inventoryMap.get(\"containers\").set(key, value); break;\n              case \"equipment\": inventoryMap.get(\"equipment\").set(key, value); break;\n              case \"loot\": inventoryMap.get(\"loot\").set(key, value); break;\n              case \"tool\": inventoryMap.get(\"tools\").set(key, value); break;\n              case \"weapon\": inventoryMap.get(\"weapons\").set(key, value); break;\n            }\n          }\n        }\n      }\n\n      // Loop through inventory subcateogry ids\n      for (const groupId of this.inventorygroupIds) {\n        const actionData = inventoryMap.get(groupId);\n        if (!actionData || actionData.size === 0) continue;\n\n        // Create group data\n        const groupData = {\n          id: groupId,\n          name: game.i18n.localize(GROUP[groupId].name)\n        };\n\n        const data = { groupData, actionData };\n\n        // Build actions and activations\n        await this.buildActions(data);\n        await this.buildActivations(data);\n      }\n    }\n\n    /**\n     * Build rests\n     * @private\n     */\n    #buildRests() {\n      // Exit if every actor is not the character type\n      if (this.actors.length === 0 || !this.actors.every(actor => actor.type === \"character\")) return;\n\n      // Get actions\n      const actionType = \"utility\";\n      const restTypes = { shortRest: \"DND5E.ShortRest\", longRest: \"DND5E.LongRest\" };\n      const actions = Object.entries(restTypes).map(([id, name]) => {\n        name = game.i18n.localize(name);\n        return {\n          id,\n          name,\n          listName: this.#getListName(actionType, name),\n          system: { actionType, actionId: id }\n        };\n      });\n\n      // Add actions to HUD\n      this.addActions(actions, { id: \"rests\" });\n    }\n\n    /**\n     * Build skills\n     * @private\n     */\n    #buildSkills() {\n      // Get skills and exit if none exist\n      const skills = this.actor?.system.skills || CONFIG.DND5E.skills;\n      if (skills.length === 0) return;\n\n      // Get actions\n      const actionType = \"skill\";\n      const actions = Object.entries(skills).map(([id, skill]) => {\n        try {\n          const name = CONFIG.DND5E.skills[id].label;\n          return {\n            id,\n            name: this.abbreviateSkills ? Utils.capitalize(id) : name,\n            icon1: this.#getProficiencyIcon(skill.value),\n            info1: (this.actor) ? { text: coreModule.api.Utils.getModifier(skill.total) } : \"\",\n            listName: this.#getListName(actionType, name),\n            system: { actionType, actionId: id }\n          };\n        } catch(error) {\n          coreModule.api.Logger.error(skill);\n          return null;\n        }\n      }).filter(skill => !!skill);\n\n      // Add actions to HUD\n      this.addActions(actions, { id: \"skills\" });\n    }\n\n    /**\n     * Build spells\n     */\n    async #buildSpells() {\n      // Filter items for spells and exit if none exist\n      const spells = new Map([...this.items].filter(([, value]) => value.type === \"spell\"));\n      if (spells.size === 0) return;\n\n      // Initialize spells map categories\n      const spellsMap = new Map([\n        [\"atWillSpells\", new Map()],\n        [\"innateSpells\", new Map()],\n        [\"pactSpells\", new Map()],\n        [\"cantrips\", new Map()],\n        [\"_1stLevelSpells\", new Map()],\n        [\"_2ndLevelSpells\", new Map()],\n        [\"_3rdLevelSpells\", new Map()],\n        [\"_4thLevelSpells\", new Map()],\n        [\"_5thLevelSpells\", new Map()],\n        [\"_6thLevelSpells\", new Map()],\n        [\"_7thLevelSpells\", new Map()],\n        [\"_8thLevelSpells\", new Map()],\n        [\"_9thLevelSpells\", new Map()]\n      ]);\n\n      // Loop through items\n      for (const [key, value] of spells) {\n        if (!this.#isUsableItem(value) || !this.#isUsableSpell(value)) continue;\n\n        switch (value.system.preparation.mode) {\n          case \"atwill\":\n            spellsMap.get(\"atWillSpells\").set(key, value); break;\n          case \"innate\":\n            spellsMap.get(\"innateSpells\").set(key, value); break;\n          case \"pact\":\n            spellsMap.get(\"pactSpells\").set(key, value); break;\n          default: {\n            switch (value.system.level) {\n              case 0:\n                spellsMap.get(\"cantrips\").set(key, value); break;\n              case 1:\n                spellsMap.get(\"_1stLevelSpells\").set(key, value); break;\n              case 2:\n                spellsMap.get(\"_2ndLevelSpells\").set(key, value); break;\n              case 3:\n                spellsMap.get(\"_3rdLevelSpells\").set(key, value); break;\n              case 4:\n                spellsMap.get(\"_4thLevelSpells\").set(key, value); break;\n              case 5:\n                spellsMap.get(\"_5thLevelSpells\").set(key, value); break;\n              case 6:\n                spellsMap.get(\"_6thLevelSpells\").set(key, value); break;\n              case 7:\n                spellsMap.get(\"_7thLevelSpells\").set(key, value); break;\n              case 8:\n                spellsMap.get(\"_8thLevelSpells\").set(key, value); break;\n              case 9:\n                spellsMap.get(\"_9thLevelSpells\").set(key, value); break;\n            }\n          }\n        }\n      }\n\n      // Reverse sort spell slots by level\n      const systemSpells = Object.entries(this.actor.system.spells).reverse();\n\n      // Set spell slot availability\n      const spellSlotsMap = new Map();\n      let spellSlotAvailable = this.showUnchargedItems;\n      let pactSlotAvailable = this.showUnchargedItems;\n      let pactSlot = null;\n\n      for (const [key, value] of systemSpells) {\n        const hasValue = value.value > 0;\n        const hasMax = value.max > 0;\n        const hasLevel = value.level > 0;\n\n        if (key === \"pact\") {\n          pactSlotAvailable = pactSlotAvailable || (hasValue && hasMax && hasLevel);\n          value.slotAvailable = pactSlotAvailable && hasLevel;\n          pactSlot = [key, value];\n        } else if (key.startsWith(\"spell\") && key !== \"spell0\") {\n          spellSlotAvailable = spellSlotAvailable || (hasValue && hasMax);\n          value.slotAvailable = spellSlotAvailable;\n          spellSlotsMap.set(key, value);\n        } else if (hasValue) {\n          value.slotsAvailable = true;\n          spellSlotsMap.set(key, value);\n        }\n      }\n\n      // Set equivalent spell slot where pact slot is available\n      if (pactSlot[1].slotAvailable) {\n        const spellSlot = spellSlotsMap.get(`spell${pactSlot[1].level}`);\n        spellSlot.slotsAvailable = true;\n      }\n\n      const spellSlotModes = new Set([1, 2, 3, 4, 5, 6, 7, 8, 9, \"pact\"]);\n\n      for (const id of SPELL_GROUP_IDS) {\n        // Skip if no spells exist\n        if (!spellsMap.has(id)) continue;\n\n        const spellMode = GROUP[id].spellMode;\n        const levelInfo = (spellMode === \"pact\") ? pactSlot[1] : spellSlotsMap.get(`spell${spellMode}`);\n        const { value: slots = 0, max = 0, slotAvailable = false } = levelInfo || {};\n\n        // Skip if spells require spell slots and none are available\n        if (!slotAvailable && spellSlotModes.has(spellMode)) continue;\n\n        // Create group data\n        const groupData = {\n          id: GROUP[id].id,\n          name: game.i18n.localize(GROUP[id].name),\n          info: { info1: { class: \"tah-spotlight\", text: (max > 0) ? `${slots}/${max}` : \"\" } }\n        };\n\n        // Add spell slot info to group\n        this.addGroupInfo(groupData);\n\n        const data = { groupData, actionData: spellsMap.get(id), actionType: \"spell\" };\n\n        // Build actions and activations\n        await this.buildActions(data);\n        await this.buildActivations(data);\n      }\n    }\n\n    /**\n     * Build utility\n     * @private\n     */\n    #buildUtility() {\n      // Exit if every actor is not the character type\n      if (this.actors.length === 0) return;\n      if (!this.actors.every(actor => actor.type === \"character\")) return;\n\n      const actionType = \"utility\";\n\n      // Set utility types\n      const utilityTypes = {\n        deathSave: { name: game.i18n.localize(\"DND5E.DeathSave\") },\n        inspiration: { name: game.i18n.localize(\"DND5E.Inspiration\") }\n      };\n\n      // Delete 'deathSave' for multiple tokens\n      if (!this.actor || this.actor.system.attributes.hp.value > 0) delete utilityTypes.deathSave;\n\n      // Get actions\n      const actions = Object.entries(utilityTypes)\n        .map(utilityType => {\n          const id = utilityType[0];\n          const name = utilityType[1].name;\n          let cssClass = \"\";\n          if (utilityType[0] === \"inspiration\") {\n            const active = this.actors.every(actor => actor.system.attributes?.inspiration)\n              ? \" active\"\n              : \"\";\n            cssClass = `toggle${active}`;\n          }\n          return {\n            id,\n            name,\n            cssClass,\n            listName: this.#getListName(actionType, name),\n            system: { actionType, actionId: id }\n          };\n        });\n\n      // Crreate group data\n      const groupData = { id: \"utility\" };\n\n      // Add actions to HUD\n      this.addActions(actions, groupData);\n    }\n\n    /**\n     * Build actions\n     * @public\n     * @param {object} data actionData, groupData, actionType\n     * @param {object} options\n     */\n    async buildActions(data, options) {\n      const { actionData, groupData, actionType } = data;\n\n      // Exit if there is no action data\n      if (actionData.size === 0) return;\n\n      // Exit if there is no groupId\n      const groupId = (typeof groupData === \"string\" ? groupData : groupData?.id);\n      if (!groupId) return;\n\n      // Get actions\n      const actions = await Promise.all([...actionData].map(async item => await this.#getAction(item[1], actionType)));\n\n      // Add actions to action list\n      this.addActions(actions, groupData);\n    }\n\n    /**\n     * Get action\n     * @private\n     * @param {object} entity      The entity\n     *  @param {string} actionType The action type\n     * @returns {object}           The action\n     */\n    async #getAction(entity, actionType = \"item\") {\n      const id = entity.id ?? entity._id;\n      let name = entity?.name ?? entity?.label;\n      let cssClass = \"\";\n      if (Object.hasOwn(entity, \"disabled\")) {\n        const active = (!entity.disabled) ? \" active\" : \"\";\n        cssClass = `toggle${active}`;\n      }\n      const info = this.#getItemInfo(entity);\n      const tooltip = await this.#getTooltip(await this.#getTooltipData(entity));\n      return {\n        id,\n        name,\n        cssClass,\n        img: coreModule.api.Utils.getImage(entity),\n        icon1: this.#getActivationTypeIcon(entity.system?.activities?.contents[0]?.activation.type),\n        icon2: this.#getPreparedIcon(entity),\n        icon3: this.#getConcentrationIcon(entity),\n        info1: info?.info1,\n        info2: info?.info2,\n        info3: info?.info3,\n        listName: this.#getListName(actionType, name),\n        tooltip,\n        system: { actionType, actionId: id }\n      };\n    }\n\n    /**\n     * Is active item\n     * @private\n     * @param {object} item The item\n     * @returns {boolean}   Whether the item is active\n     */\n    #isActiveItem(item) {\n      if (this.showItemsWithoutActivationCosts) return true;\n      const activationTypes = new Set(Object.keys(CONFIG.DND5E.activityActivationTypes).filter(activationType => activationType !== \"none\"));\n      const activationType = item.system?.activities?.contents[0]?.activation?.type;\n      return activationTypes.has(activationType) || item.type === \"tool\";\n    }\n\n    /**\n     * Is equipped item\n     * @private\n     * @param {object} item The item\n     * @returns {boolean}   Whether the item is equipped\n     */\n    #isEquippedItem(item) {\n      const excludedTypes = [\"consumable\", \"spell\", \"feat\"];\n      return (this.showUnequippedItems && !excludedTypes.includes(item.type))\n      || (item.system.equipped && item.type !== \"consumable\");\n    }\n\n    /**\n     * Is usable item\n     * @private\n     * @param {object} item The item\n     * @returns {boolean}   Whether the item is usable\n     */\n    #isUsableItem(item) {\n      return this.showUnchargedItems || !!item.system.uses?.value || !item.system.uses?.max;\n    }\n\n    /**\n     * Is usable spell\n     * @private\n     * @param {object} spell The spell\n     * @returns {boolean}    Whether the spell is usable\n     */\n    #isUsableSpell(spell) {\n      if (this.actor?.type !== \"character\" && this.showUnequippedItems) return true;\n      if (this.showUnpreparedSpells) return true;\n\n      const preparationModes = new Set(Object.keys(CONFIG.DND5E.spellPreparationModes).filter(preparationMode => preparationMode !== \"prepared\"));\n\n      // Return true if the spell has a preparation mode other than 'prepared' or is prepared\n      return preparationModes.has(spell.system.preparation.mode) || spell.system.preparation.prepared;\n    }\n\n    #getListName(actionType, actionName) {\n      const prefix = `${game.i18n.localize(ACTION_TYPE[actionType])}: ` ?? \"\";\n      return `${prefix}${actionName}` ?? \"\";\n    }\n\n    /**\n     * Get item info\n     * @private\n     * @param {object} item\n     * @returns {object}\n     */\n    #getItemInfo(item) {\n      const info1 = item.type === \"spell\" ? this.#getSpellInfo(item) : this.#getQuantityData(item);\n      const info2 = this.#getUsesData(item);\n      const info3 = this.#getConsumeData(item);\n\n      return { info1, info2, info3 };\n    }\n\n    /**\n     * Add spell info\n     * @private\n     * @param {object} spell The spell\n     * @returns {object}     The spell info\n     */\n    #getSpellInfo(spell) {\n      if (!this.displaySpellInfo) return null;\n\n      const components = spell.system?.properties;\n      if (!components) return null;\n\n      const info = { text: \"\", title: \"\" };\n      const componentTypes = {\n        vocal: \"DND5E.ComponentVerbal\",\n        somatic: \"DND5E.ComponentSomatic\",\n        material: \"DND5E.ComponentMaterial\"\n      };\n\n\n      const componentsArray = Object.entries(componentTypes)\n        .filter(([key]) => components[key])\n        .map(([key, label]) => {\n          info.text += game.i18n.localize(`${label}Abbr`);\n          return game.i18n.localize(label);\n        });\n\n      // Ritual\n      if (components.ritual) {\n        componentsArray.push(`[${game.i18n.localize(\"DND5E.Ritual\")}]`);\n        info.text += ` [${game.i18n.localize(\"DND5E.RitualAbbr\")}]`;\n      }\n\n      info.title = componentsArray.join(\", \");\n\n      return info;\n    }\n\n    /**\n     * Get valid actors\n     * @private\n     * @returns {object}\n     */\n    #getValidActors() {\n      const allowedTypes = [\"character\", \"npc\"];\n      return this.actors.every(actor => allowedTypes.includes(actor.type)) ? this.actors : [];\n    }\n\n    /**\n     * Get valid tokens\n     * @private\n     * @returns {object}\n     */\n    #getValidTokens() {\n      const allowedTypes = [\"character\", \"npc\"];\n      return this.actors.every(actor => allowedTypes.includes(actor.type)) ? this.tokens : [];\n    }\n\n    /**\n     * Get quantity\n     * @private\n     * @param {object} item\n     * @returns {string}\n     */\n    #getQuantityData(item) {\n      const quantity = item?.system?.quantity ?? 0;\n      return {\n        text: (quantity > 1) ? quantity : \"\",\n        title: `${game.i18n.localize(\"DND5E.Quantity\")}: ${quantity}`\n      };\n    }\n\n    /**\n     * Get uses\n     * @private\n     * @param {object} item\n     * @returns {string}\n     */\n    #getUsesData(item) {\n      const uses = item?.system?.uses;\n      if (!(uses?.max > 0)) return {};\n      const per = uses.recovery[0]?.period === \"charges\" ? \"\" : ` ${game.i18n.localize(\"DND5E.per\")} `;\n      const period = CONFIG.DND5E.limitedUsePeriods[uses.recovery[0]?.period]?.label ?? uses.recovery[0]?.period;\n      const perPeriod = (period) ? `${per}${period}` : \"\";\n      const remainingUses = uses.max - (uses.spent ?? 0);\n      const text = `${remainingUses}/${uses.max}`;\n      const title = `${text}${perPeriod}`;\n      return { text, title };\n    }\n\n    /**\n     * Get consume\n     * @private\n     * @param {object} item\n     * @returns {string}\n     */\n    #getConsumeData(item) {\n      // Get consume target and type\n      const firstActivity = item?.system?.activities?.contents[0];\n      const firstTarget = firstActivity?.consumption?.targets?.[0];\n      const consumeId = firstTarget?.target;\n      const consumeType = firstTarget?.type;\n      const consumeAmount = firstTarget?.value;\n\n      if (!consumeId || !consumeType || consumeId === item.id) return {};\n\n      // Return resources\n      if (consumeType === \"attribute\") {\n        const parentId = consumeId.substr(0, consumeId.lastIndexOf(\".\"));\n        const target = foundry.utils.getProperty(this.actor.system, parentId);\n\n        if (target) {\n          const text = `${target.value ?? \"0\"}${target.max ? `/${target.max}` : \"\"}`;\n          return {\n            text,\n            title: `${text} ${target.label ?? \"\"}`\n          };\n        }\n      } else {\n        const target = this.actor.items?.get(consumeId);\n\n        // Return charges\n        if (target && consumeType === \"charges\") {\n          return this.#getUsesData(target);\n        }\n\n        // Return quantity\n        if (target?.system?.quantity) {\n          const text = `${consumeAmount > 1 ? `${consumeAmount} ${game.i18n.localize(\"DND5E.of\")} ` : \"\"}${target.system.quantity}`;\n          return {\n            text,\n            title: `${text} ${target.name}`\n          };\n        }\n      }\n\n      return {};\n    }\n\n    /**\n     * Discard slow items\n     * @private\n     * @param {Map} items The items\n     * @returns {Map}     The filtered items\n     */\n    #discardSlowItems(items) {\n      // Return all items if slow actions are allowed\n      if (Utils.getSetting(\"showSlowActions\")) return items;\n\n      // Define slow activation types\n      const slowActivationTypes = new Set([\"minute\", \"hour\", \"day\"]);\n\n      // Filter out slow items and return the result\n      return new Map([...items.entries()].filter(([_, item]) => {\n        const activationType = item.system?.activation?.type;\n        return !slowActivationTypes.has(activationType);\n      }));\n    }\n\n    /**\n     * Get proficiency icon\n     * @param {string} level\n     * @returns {string}\n     */\n    #getProficiencyIcon(level) {\n      const title = CONFIG.DND5E.proficiencyLevels[level] ?? \"\";\n      const icon = PROFICIENCY_LEVEL_ICON[level];\n      return (icon) ? `<i class=\"${icon}\" title=\"${title}\"></i>` : \"\";\n    }\n\n    /**\n     * Get icon for the activation type\n     * @private\n     * @param {object} activationType The activation type\n     * @returns {string}              The icon\n     */\n    #getActivationTypeIcon(activationType) {\n      const title = CONFIG.DND5E.abilityActivationTypes[activationType] ?? \"\";\n      const icon = ACTIVATION_TYPE[activationType]?.icon;\n      return (icon) ? `<i class=\"${icon}\" title=\"${title}\"></i>` : \"\";\n    }\n\n    /**\n     * Get icon for concentration type\n     * @private\n     * @param {object} spell\n     * @returns {string}\n     */\n    #getConcentrationIcon(spell) {\n      if (spell?.type !== \"spell\" || !this.displaySpellInfo || !spell.system?.properties?.has(\"concentration\")) return null;\n      const title = game.i18n.localize(\"DND5E.Scroll.RequiresConcentration\");\n      const icon = CONCENTRATION_ICON;\n      return `<dnd5e-icon src=\"${icon}\" title=\"${title}\">`;\n    }\n\n    /**\n     * Get icon for a prepared spell\n     * @private\n     * @param {object} spell\n     * @returns\n     */\n    #getPreparedIcon(spell) {\n      if (spell?.type !== \"spell\" || !this.showUnpreparedSpells) return null;\n      const level = spell.system.level;\n      const preparationMode = spell.system.preparation.mode;\n      const prepared = spell.system.preparation.prepared;\n      const icon = prepared ? PREPARED_ICON : `${PREPARED_ICON} tah-icon-disabled`;\n      const title = preparationMode === \"always\" ? game.i18n.localize(\"DND5E.SpellPrepAlways\") : prepared ? game.i18n.localize(\"DND5E.SpellPrepared\") : game.i18n.localize(\"DND5E.SpellUnprepared\");\n\n      // Return icon if the preparation mode is 'prepared' or 'always' and the spell is not a cantrip\n      return ((preparationMode === \"prepared\" || preparationMode === \"always\") && level !== 0) ? `<i class=\"${icon}\" title=\"${title}\"></i>` : null;\n    }\n\n    async #getTooltipData(entity) {\n      if (this.tooltipsSetting === \"none\") return \"\";\n\n      const name = entity?.name ?? \"\";\n\n      if (this.tooltipsSetting === \"nameOnly\") return name;\n\n      const unidentified = entity.system?.identified === false;\n      const description = (typeof entity?.system?.description === \"string\") ? entity?.system?.description : (unidentified ? entity?.system?.unidentified?.description : entity?.system?.description?.value) ?? \"\";\n      let modifiers; let properties; let rarity; let traits;\n      if (!unidentified) {\n        modifiers = entity?.modifiers ?? null;\n        properties = [\n          ...entity.system?.chatProperties ?? [],\n          ...entity.system?.equippableItemCardProperties ?? [],\n          entity.system?.parent?.labels?.activation,\n          entity.system?.parent?.labels?.target,\n          entity.system?.parent?.labels?.range,\n          entity.system?.parent?.labels?.duration\n        ].filter(p => p);\n        rarity = unidentified ? null : entity?.rarity ?? null;\n        traits = (entity?.type === \"weapon\") ? this.#getWeaponProperties(entity?.system?.properties) : null;\n      }\n      return { name, description, modifiers, properties, rarity, traits };\n    }\n\n    /**\n     * Get condition tooltip data\n     * @param {*} id     The condition id\n     * @param {*} name   The condition name\n     * @returns {object} The tooltip data\n     */\n    async #getConditionTooltipData(id, name) {\n      if (this.tooltipsSetting === \"none\") return \"\";\n\n      const condition = CONFIG.DND5E.conditionTypes[id];\n\n      if (this.tooltipsSetting === \"nameOnly\" || !condition) return name;\n\n      const journalEntry = (condition.reference) ? await fromUuid(condition.reference) : null;\n      const description = journalEntry?.text?.content ?? \"\";\n      const relativeTo = journalEntry;\n      return {\n        name,\n        description,\n        relativeTo\n      };\n    }\n\n    /**\n     * Get tooltip\n     * @param {object} tooltipData The tooltip data\n     * @returns {string}           The tooltip\n     */\n    async #getTooltip(tooltipData) {\n      if (this.tooltipsSetting === \"none\") return \"\";\n      if (typeof tooltipData === \"string\") return tooltipData;\n\n      const name = game.i18n.localize(tooltipData.name);\n\n      if (this.tooltipsSetting === \"nameOnly\") return name;\n\n      const nameHtml = `<h3>${name}</h3>`;\n\n      const relativeTo = tooltipData.relativeTo ?? this.actor;\n\n      const description = tooltipData?.descriptionLocalised\n                ?? await TextEditor.enrichHTML(game.i18n.localize(tooltipData?.description ?? \"\"), { async: true, relativeTo, secrets: true });\n\n      const rarityHtml = tooltipData?.rarity\n        ? `<span class=\"tah-tag ${tooltipData.rarity}\">${game.i18n.localize(RARITY[tooltipData.rarity])}</span>`\n        : \"\";\n\n      const propertiesHtml = tooltipData?.properties\n        ? `<div class=\"tah-properties\">${tooltipData.properties.map(property => `<span class=\"tah-property\">${game.i18n.localize(property)}</span>`).join(\"\")}</div>`\n        : \"\";\n\n      const traitsHtml = tooltipData?.traits\n        ? tooltipData.traits.map(trait => `<span class=\"tah-tag\">${game.i18n.localize(trait.label ?? trait)}</span>`).join(\"\")\n        : \"\";\n\n      const traits2Html = tooltipData?.traits2\n        ? tooltipData.traits2.map(trait => `<span class=\"tah-tag tah-tag-secondary\">${game.i18n.localize(trait.label ?? trait)}</span>`).join(\"\")\n        : \"\";\n\n      const traitsAltHtml = tooltipData?.traitsAlt\n        ? tooltipData.traitsAlt.map(trait => `<span class=\"tah-tag tah-tag-alt\">${game.i18n.localize(trait.label)}</span>`).join(\"\")\n        : \"\";\n\n      const modifiersHtml = tooltipData?.modifiers\n        ? `<div class=\"tah-tags\">${tooltipData.modifiers.filter(modifier => modifier.enabled).map(modifier => {\n          const label = game.i18n.localize(modifier.label);\n          const sign = modifier.modifier >= 0 ? \"+\" : \"\";\n          const mod = `${sign}${modifier.modifier ?? \"\"}`;\n          return `<span class=\"tah-tag tah-tag-transparent\">${label} ${mod}</span>`;\n        }).join(\"\")}</div>`\n        : \"\";\n\n      const tagsJoined = [rarityHtml, traitsHtml, traits2Html, traitsAltHtml].join(\"\");\n\n      const tagsHtml = (tagsJoined) ? `<div class=\"tah-tags\">${tagsJoined}</div>` : \"\";\n\n      const headerTags = (tagsHtml || modifiersHtml) ? `<div class=\"tah-tags-wrapper\">${tagsHtml}${modifiersHtml}</div>` : \"\";\n\n      if (!description && !tagsHtml && !modifiersHtml) return name;\n\n      return `<div>${nameHtml}${headerTags}${description}${propertiesHtml}</div>`;\n    }\n\n    #getWeaponProperties(weaponProperties) {\n      if (!weaponProperties) return null;\n      return Object.entries(weaponProperties)\n        .filter(([id, selected]) => selected && CONFIG.DND5E.validProperties.weapon.has(id))\n        .map(([id, _]) => game.i18n.localize(CONFIG.DND5E.itemProperties[id]));\n    }\n  };\n});\n","import { GROUP } from \"./constants.js\";\n\n/**\n * Default categories and groups\n */\nexport let DEFAULTS = null;\n\nHooks.once(\"tokenActionHudCoreApiReady\", async coreModule => {\n  const groups = GROUP;\n  Object.values(groups).forEach(group => {\n    group.name = coreModule.api.Utils.i18n(group.name);\n    group.listName = `Group: ${coreModule.api.Utils.i18n(group.name)}`;\n  });\n  const groupsArray = Object.values(groups);\n  DEFAULTS = {\n    layout: [\n      {\n        nestId: \"inventory\",\n        id: \"inventory\",\n        name: coreModule.api.Utils.i18n(\"DND5E.Inventory\"),\n        groups: [\n          { ...groups.weapons, nestId: \"inventory_weapons\" },\n          { ...groups.equipment, nestId: \"inventory_equipment\" },\n          { ...groups.consumables, nestId: \"inventory_consumables\" },\n          { ...groups.tools, nestId: \"inventory_tools\" },\n          { ...groups.containers, nestId: \"inventory_containers\" },\n          { ...groups.loot, nestId: \"inventory_loot\" }\n        ]\n      },\n      {\n        nestId: \"features\",\n        id: \"features\",\n        name: coreModule.api.Utils.i18n(\"DND5E.Features\"),\n        groups: [\n          { ...groups.activeFeatures, nestId: \"features_active-features\" },\n          { ...groups.passiveFeatures, nestId: \"features_passive-features\" }\n        ]\n      },\n      {\n        nestId: \"spells\",\n        id: \"spells\",\n        name: coreModule.api.Utils.i18n(\"TYPES.Item.spellPl\"),\n        groups: [\n          { ...groups.atWillSpells, nestId: \"spells_at-will-spells\" },\n          { ...groups.innateSpells, nestId: \"spells_innate-spells\" },\n          { ...groups.pactSpells, nestId: \"spells_pact-spells\" },\n          { ...groups.cantrips, nestId: \"spells_cantrips\" },\n          { ...groups._1stLevelSpells, nestId: \"spells_1st-level-spells\" },\n          { ...groups._2ndLevelSpells, nestId: \"spells_2nd-level-spells\" },\n          { ...groups._3rdLevelSpells, nestId: \"spells_3rd-level-spells\" },\n          { ...groups._4thLevelSpells, nestId: \"spells_4th-level-spells\" },\n          { ...groups._5thLevelSpells, nestId: \"spells_5th-level-spells\" },\n          { ...groups._6thLevelSpells, nestId: \"spells_6th-level-spells\" },\n          { ...groups._7thLevelSpells, nestId: \"spells_7th-level-spells\" },\n          { ...groups._8thLevelSpells, nestId: \"spells_8th-level-spells\" },\n          { ...groups._9thLevelSpells, nestId: \"spells_9th-level-spells\" }\n        ]\n      },\n      {\n        nestId: \"attributes\",\n        id: \"attributes\",\n        name: coreModule.api.Utils.i18n(\"DND5E.Attributes\"),\n        groups: [\n          { ...groups.abilities, nestId: \"attributes_abilities\" },\n          { ...groups.skills, nestId: \"attributes_skills\" }\n        ]\n      },\n      {\n        nestId: \"effects\",\n        id: \"effects\",\n        name: coreModule.api.Utils.i18n(\"DND5E.Effects\"),\n        groups: [\n          { ...groups.temporaryEffects, nestId: \"effects_temporary-effects\" },\n          { ...groups.passiveEffects, nestId: \"effects_passive-effects\" },\n          { ...groups.conditions, nestId: \"effects_conditions\" }\n        ]\n      },\n      {\n        nestId: \"utility\",\n        id: \"utility\",\n        name: coreModule.api.Utils.i18n(\"tokenActionHud.utility\"),\n        groups: [\n          { ...groups.combat, nestId: \"utility_combat\" },\n          { ...groups.token, nestId: \"utility_token\" },\n          { ...groups.rests, nestId: \"utility_rests\" },\n          { ...groups.utility, nestId: \"utility_utility\" }\n        ]\n      }\n    ],\n    groups: groupsArray\n  };\n});\n","export let MagicItemActionHandlerExtender = null;\n\nHooks.once(\"tokenActionHudCoreApiReady\", async coreModule => {\n  MagicItemActionHandlerExtender = class MagicItemActionHandlerExtender extends coreModule.api.ActionHandlerExtender {\n    constructor(actionHandler) {\n      super();\n      this.actionHandler = actionHandler;\n      this.actor = null;\n    }\n\n    /**\n     * Extend the action list\n     */\n    async extendActionHandler() {\n      this.actor = this.actionHandler.actor;\n      if (!this.actor) return;\n\n      const actor = await MagicItems.actor(this.actor.id);\n\n      if (!actor) return;\n\n      const magicItems = actor.items ?? [];\n\n      if (magicItems.length === 0) return;\n\n      const parentGroupId = \"magic-items\";\n      const parentGroupType = \"system\";\n      const parentGroupData = {\n        id: parentGroupId,\n        type: parentGroupType\n      };\n\n      magicItems.forEach(magicItem => {\n        if (magicItem.attuned && !this._isItemAttuned(magicItem)) return;\n        if (magicItem.equipped && !this._isItemEquipped(magicItem)) return;\n\n        const groupId = `magic-items_${magicItem.id}`;\n        const groupName = magicItem.name;\n        const groupType = \"system-derived\";\n        const groupInfo1 = `${magicItem.uses}/${magicItem.charges}`;\n        const groupData = {\n          id: groupId,\n          name: groupName,\n          type: groupType,\n          info1: groupInfo1\n        };\n\n        // Add group to HUD\n        this.actionHandler.addGroup(groupData, parentGroupData);\n\n        const actions = magicItem.ownedEntries.map(entry => {\n          const effect = entry.item;\n          const id = effect.id;\n          const name = effect.name;\n          const img = coreModule.api.Utils.getImage(effect);\n          const info1 = effect.consumption;\n          const info2 = (effect.baseLevel) ? `${coreModule.api.Utils.i18n(\"DND5E.AbbreviationLevel\")} ${effect.baseLevel}` : \"\";\n          return {\n            id,\n            name,\n            encodedValue,\n            img,\n            info1,\n            info2,\n            selected: true,\n            system: { actionType: \"magicItem\", itemId: magicItem.id, effectId: id}\n          };\n        });\n\n        // Add actions to action list\n        this.actionHandler.addActions(actions, groupData);\n      });\n    }\n\n    /**\n     * Whether the magic item is equipped or not\n     * @param {object} magicItem The item\n     * @returns {boolean}\n     */\n    _isItemEquipped(magicItem) {\n      return magicItem.item.system.equipped;\n    }\n\n    /**\n     * Whether the magic items is attuned or not\n     * @param {object} magicItem The item\n     * @returns {boolean}\n     */\n    _isItemAttuned(magicItem) {\n      const attunement = magicItem.item.system.attunment;\n      const attunementRequired = CONFIG.DND5E.attunementTypes?.REQUIRED ?? 1;\n\n      if (attunement === attunementRequired) return false;\n\n      return true;\n    }\n  };\n});\n","import { CUSTOM_DND5E } from \"./constants.js\";\n\nexport let RollHandler = null;\n\nHooks.once(\"tokenActionHudCoreApiReady\", async coreModule => {\n  RollHandler = class RollHandler extends coreModule.api.RollHandler {\n    /**\n     * Handle action click\n     * @override\n     * @param {object} event\n     */\n    async handleActionClick(event) {\n      const { actionType, actionId } = this.action.system;\n\n      if (!this.actor) {\n        for (const token of coreModule.api.Utils.getControlledTokens()) {\n          const actor = token.actor;\n          await this.handleAction(event, actionType, actor, token, actionId);\n        }\n      } else {\n        await this.handleAction(event, actionType, this.actor, this.token, actionId);\n      }\n    }\n\n    /**\n     * Handle action\n     * @private\n     * @param {object} event\n     * @param {string} actionType\n     * @param {object} actor\n     * @param {object} token\n     * @param {string} actionId\n     */\n    async handleAction(event, actionType, actor, token, actionId) {\n      switch (actionType) {\n        case \"ability\":\n          this.rollAbility(event, actor, actionId); break;\n        case \"check\":\n          this.rollAbilityTest(event, actor, actionId); break;\n        case \"save\":\n          this.rollAbilitySave(event, actor, actionId); break;\n        case \"condition\":\n          if (!token) return;\n          await this.toggleCondition(actor, token, actionId); break;\n        case \"counter\":\n          await this.modifyCounter(event, actor); break;\n        case \"effect\":\n          await this.toggleEffect(actor, actionId); break;\n        case \"exhaustion\":\n          await this.modifyExhaustion(event, actor); break;\n        case \"feature\":\n        case \"item\":\n        case \"spell\":\n        case \"weapon\":\n          if (this.isRenderItem()) this.renderItem(actor, actionId);\n          else this.useItem(event, actor, actionId);\n          break;\n        case \"magicItem\":\n          await this.rollMagicItem(actor, actionId); break;\n        case \"skill\":\n          this.rollSkill(event, actor, actionId); break;\n        case \"utility\":\n          await this.performUtilityAction(event, actor, token, actionId); break;\n        default:\n          break;\n      }\n    }\n\n    /**\n     * Modify Counter\n     * @private\n     * @param {object} event The event\n     * @param {object} actor The actor\n     */\n    async modifyCounter(event, actor) {\n      switch (this.action?.system?.counterKey) {\n        case \"death-saves\":\n          this.rollDeathSave(event, actor); break;\n        case \"exhaustion\":\n          await this.modifyExhaustion(actor); break;\n        case \"inspiration\":\n          await this.modifyInspiration(actor); break;\n        default:\n          await this.modifyCustomCounter(actor); break;\n      }\n    }\n\n    /**\n     * Modify Exhaustion\n     * @private\n     * @param {object} actor The actor\n     */\n    async modifyExhaustion(actor) {\n      const currentExhaustion = actor.system.attributes.exhaustion;\n      const newExhaustion = currentExhaustion + (this.isRightClick ? -1 : 1);\n      if (newExhaustion >= 0 && newExhaustion !== currentExhaustion) {\n        actor.update({ \"system.attributes.exhaustion\": newExhaustion });\n      }\n    }\n\n    /**\n     * Modify Inspiration\n     * @private\n     * @param {object} actor The actor\n     */\n    async modifyInspiration(actor) {\n      const update = !actor.system.attributes.inspiration;\n      actor.update({ \"system.attributes.inspiration\": update });\n    }\n\n    /**\n     * Modify Custom Counter\n     * @private\n     * @param {object} actor The actor\n     */\n    async modifyCustomCounter(actor) {\n      const { counterKey, counterType } = this.action.system;\n\n      let value = actor.getFlag(CUSTOM_DND5E.ID, counterKey) || {};\n\n      const setFlag = async (key, currentValue, newValue) => {\n        if (newValue !== currentValue) {\n          await actor.setFlag(CUSTOM_DND5E.ID, key, newValue);\n        }\n      };\n\n      const adjustValue = (key, currentValue = 0, increment = 1) => {\n        const newValue = this.isRightClick ? Math.max(0, currentValue - increment) : currentValue + increment;\n        setFlag(key, currentValue, newValue);\n      };\n\n      switch (counterType) {\n        case \"checkbox\":\n          await setFlag(id, !value);\n          break;\n\n        case \"fraction\":\n          if (this.isRightClick || (value.max && value.value < value.max) || !value.max) {\n            adjustValue(`${id}.value`, value.value);\n          }\n          break;\n\n        case \"number\":\n          adjustValue(id, value);\n          break;\n\n        case \"successFailure\":\n          value.success = value?.success ?? 0;\n          value.failure = value?.failure ?? 0;\n          if (this.isCtrl) {\n            adjustValue(`${id}.failure`, value.failure);\n          } else {\n            adjustValue(`${id}.success`, value.success);\n          }\n      }\n    }\n\n    /**\n     * Roll Ability\n     * @private\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     */\n    rollAbility(event, actor, actionId) {\n      if (!actor.system?.abilities) return;\n      actor.rollAbility(actionId, { event });\n    }\n\n    /**\n     * Roll Ability Save\n     * @private\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     */\n    rollAbilitySave(event, actor, actionId) {\n      if (!actor.system?.abilities) return;\n      actor.rollAbilitySave(actionId, { event });\n    }\n\n    /**\n     * Roll Ability Test\n     * @private\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     */\n    rollAbilityTest(event, actor, actionId) {\n      if (!actor.system?.abilities) return;\n      actor.rollAbilityTest(actionId, { event });\n    }\n\n    /**\n     * Roll Death Save\n     * @private\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     */\n    rollDeathSave(event, actor) {\n      actor.rollDeathSave({ event });\n    }\n\n    /**\n     * Roll Magic Item\n     * @private\n     * @param {object} actor    The actor\n     */\n    async rollMagicItem(actor) {\n      const { itemId, effectId } = this.action.system;\n\n      const magicItemActor = await MagicItems.actor(actor.id);\n      if (!magicItemActor) return;\n\n      // Magicitems module 3.0.0 does not support Item5e#use\n      magicItemActor.roll(itemId, effectId);\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n\n    /**\n     * Roll Skill\n     * @private\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     */\n    rollSkill(event, actor, actionId) {\n      if (!actor.system?.skills) return;\n      actor.rollSkill(actionId, { event });\n    }\n\n    /**\n     * Use Item\n     * @private\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     */\n    useItem(event, actor, actionId) {\n      const item = coreModule.api.Utils.getItem(actor, actionId);\n\n      if (this.#needsRecharge(item)) {\n        item.rollRecharge();\n      } else {\n        item.use({ event, legacy: false });\n      }\n    }\n\n    /**\n     * Needs Recharge\n     * @private\n     * @param {object} item\n     * @returns {boolean}\n     */\n    #needsRecharge(item) {\n      return (item?.system?.uses?.period === \"recharge\" && !(item?.system?.uses?.value > 0));\n    }\n\n    /**\n     * Perform utility action\n     * @param {object} event    The event\n     * @param {object} actor    The actor\n     * @param {object} token    The token\n     * @param {string} actionId The action id\n     */\n    async performUtilityAction(event, actor, token, actionId) {\n      switch (actionId) {\n        case \"deathSave\":\n          this.rollDeathSave(event, actor); break;\n        case \"endTurn\":\n          if (!token || game.combat?.current?.tokenId !== token.id) break;\n          await game.combat?.nextTurn(); break;\n        case \"initiative\":\n          await this.rollInitiative(actor); break;\n        case \"inspiration\":\n          await this.modifyInspiration(actor); break;\n        case \"longRest\":\n          actor.longRest(); break;\n        case \"shortRest\":\n          actor.shortRest(); break;\n      }\n\n      // Update HUD\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n\n    /**\n     * Roll Initiative\n     * @param {object} actor The actor\n     * @private\n     */\n    async rollInitiative(actor) {\n      if (!actor) return;\n      await actor.rollInitiative({ createCombatants: true });\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n\n    /**\n     * Toggle Condition\n     * @private\n     * @param {object} actor    The actor\n     * @param {object} token    The token\n     * @param {string} actionId The action id\n     */\n    async toggleCondition(actor, token, actionId) {\n      if (!token) return;\n\n      const statusEffect = CONFIG.statusEffects.find(statusEffect => statusEffect.id === actionId);\n      const isConvenient = statusEffect?.flags?.[\"dfreds-convenient-effects\"]?.isConvenient\n        ?? actionId.startsWith(\"Convenient Effect\");\n\n      if (game.dfreds && isConvenient) {\n        const effectName = statusEffect.name ?? statusEffect.label;\n        await game.dfreds.effectInterface.toggleEffect(effectName, { overlay: !!this.isRightClick });\n      } else {\n        const condition = this.#findCondition(actionId);\n        if (!condition) return;\n\n        const effect = this.#findEffect(actor, actionId);\n        if (effect?.disabled) { await effect.delete(); }\n\n        await actor.toggleStatusEffect(condition.id, { overlay: !!this.isRightClick });\n      }\n\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n\n    /**\n     * Find condition\n     * @private\n     * @param {string} actionId The action id\n     * @returns {object}        The condition\n     */\n    #findCondition(actionId) {\n      return CONFIG.statusEffects.find(effect => effect.id === actionId);\n    }\n\n    /**\n     * Find effect\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     * @returns {object}        The effect\n     */\n    #findEffect(actor, actionId) {\n      return actor.effects.find(effect => effect.statuses.every(status => status === actionId));\n    }\n\n    /**\n     * Toggle Effect\n     * @private\n     * @param {object} actor    The actor\n     * @param {string} actionId The action id\n     */\n    async toggleEffect(actor, actionId) {\n      const effect = actor.allApplicableEffects().find(effect => effect.id === actionId);\n      if (!effect) return;\n\n      if (this.isRightClick && !effect.transfer) {\n        await effect.delete();\n      } else {\n        await effect.update({ disabled: !effect.disabled });\n      }\n\n      Hooks.callAll(\"forceUpdateTokenActionHud\");\n    }\n\n    /**\n     * Handle action hover\n     * @override\n     * @param {object} event\n     */\n    async handleActionHover(event) {\n      const types = [\"feature\", \"item\", \"spell\", \"weapon\", \"magicItem\"];\n      const { actionType, actionId } = this.action.system;\n\n      if (!types.includes(actionType)) return;\n\n      const item = coreModule.api.Utils.getItem(this.actor, actionId);\n\n      if (this.isHover) {\n        Hooks.call(\"tokenActionHudSystemActionHoverOn\", event, item);\n      } else {\n        Hooks.call(\"tokenActionHudSystemActionHoverOff\", event, item);\n      }\n    }\n  };\n});\n","import { MODULE } from \"./constants.js\";\n\n/**\n *\n * @param updateFunc\n */\nexport function register(updateFunc) {\n  game.settings.register(MODULE.ID, \"abbreviateSkills\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.abbreviateSkills.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.abbreviateSkills.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"showSlowActions\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showSlowActions.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showSlowActions.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"displaySpellInfo\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.displaySpellInfo.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.displaySpellInfo.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"showUnchargedItems\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnchargedItems.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnchargedItems.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"showUnequippedItems\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnequippedItems.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnequippedItems.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"showUnequippedItemsNpcs\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnequippedItemsNpcs.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnequippedItemsNpcs.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: true,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"showUnpreparedSpells\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnpreparedSpells.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showUnpreparedSpells.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n\n  game.settings.register(MODULE.ID, \"showItemsWithoutActivationCosts\", {\n    name: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showItemsWithoutActivationCosts.name\"\n    ),\n    hint: game.i18n.localize(\n      \"tokenActionHud.dnd5e.settings.showItemsWithoutActivationCosts.hint\"\n    ),\n    scope: \"client\",\n    config: true,\n    type: Boolean,\n    default: false,\n    onChange: value => {\n      updateFunc(value);\n    }\n  });\n}\n","// System Module Imports\nimport { ActionHandler } from \"./action-handler.js\";\nimport { MagicItemActionHandlerExtender } from \"./magic-items-extender.js\";\nimport { RollHandler as Core } from \"./roll-handler.js\";\nimport { DEFAULTS } from \"./defaults.js\";\nimport * as systemSettings from \"./settings.js\";\n\nexport let SystemManager = null;\n\nHooks.once(\"tokenActionHudCoreApiReady\", async coreModule => {\n  SystemManager = class SystemManager extends coreModule.api.SystemManager {\n    /** @override */\n    getActionHandler() {\n      const actionHandler = new ActionHandler();\n      if (coreModule.api.Utils.isModuleActive(\"magic-items-2\")\n        || coreModule.api.Utils.isModuleActive(\"magicitems\")) {\n        actionHandler.addActionHandlerExtender(new MagicItemActionHandlerExtender(actionHandler));\n      }\n      return actionHandler;\n    }\n\n    /** @override */\n    getAvailableRollHandlers() {\n      let coreTitle = \"Core D&D5e\";\n\n      if (coreModule.api.Utils.isModuleActive(\"midi-qol\")) {\n        coreTitle += ` [supports ${coreModule.api.Utils.getModuleTitle(\"midi-qol\")}]`;\n      }\n\n      const choices = { core: coreTitle };\n      return choices;\n    }\n\n    /** @override */\n    getRollHandler(rollHandlerId) {\n      let rollHandler;\n      switch (rollHandlerId) {\n        case \"core\":\n        default:\n          rollHandler = new Core();\n          break;\n      }\n\n      return rollHandler;\n    }\n\n    /** @override */\n    registerSettings(onChangeFunction) {\n      systemSettings.register(onChangeFunction);\n    }\n\n    /** @override */\n    async registerDefaults() {\n      const defaults = DEFAULTS;\n      // If the 'Magic Items' module is active, then add a group for it\n      if (game.modules.get(\"magicitems\")?.active || game.modules.get(\"magic-items-2\")?.active) {\n        const name = coreModule.api.Utils.i18n(\"tokenActionHud.dnd5e.magicItems\");\n        defaults.groups.push(\n          {\n            id: \"magic-items\",\n            name,\n            listName: `Group: ${name}`,\n            type: \"system\"\n          }\n        );\n        defaults.groups.sort((a, b) => a.id.localeCompare(b.id));\n      }\n      return defaults;\n    }\n  };\n});\n","import { SystemManager } from \"./system-manager.js\";\nimport { MODULE, REQUIRED_CORE_MODULE_VERSION } from \"./constants.js\";\n\nHooks.on(\"tokenActionHudCoreApiReady\", async () => {\n  const module = game.modules.get(MODULE.ID);\n  module.api = {\n    requiredCoreModuleVersion: REQUIRED_CORE_MODULE_VERSION,\n    SystemManager\n  };\n  Hooks.call(\"tokenActionHudSystemReady\", module);\n});\n"],"names":["MODULE","ID","CORE_MODULE","REQUIRED_CORE_MODULE_VERSION","ACTION_TYPE","ability","check","condition","counter","effect","exhaustion","feature","item","save","skill","spell","utility","ACTIVATION_TYPE","action","group","bonus","icon","crew","day","hour","lair","minute","legendary","reaction","reactiondamage","reactionmanual","special","other","CONCENTRATION_ICON","CUSTOM_DND5E","COUNTERS","character","npc","FEATURE_GROUP_IDS","GROUP","_1stLevelSpells","id","name","spellMode","type","_2ndLevelSpells","_3rdLevelSpells","_4thLevelSpells","_5thLevelSpells","_6thLevelSpells","_7thLevelSpells","_8thLevelSpells","_9thLevelSpells","abilities","actions","activeFeatures","artificerInfusions","atWillSpells","backgroundFeatures","bonusActions","cantrips","channelDivinity","checks","classFeatures","combat","conditions","consumables","containers","counters","crewActions","defensiveTactics","eldritchInvocations","elementalDisciplines","equipment","equipped","feats","fightingStyles","huntersPrey","innateSpells","kiAbilities","lairActions","legendaryActions","loot","maneuvers","metamagicOptions","monsterFeatures","multiattacks","otherActions","pactBoons","pactSpells","passiveEffects","passiveFeatures","psionicPowers","raceFeatures","reactions","rests","runes","saves","skills","superiorHuntersDefense","temporaryEffects","token","tools","unequipped","weapons","PREPARED_ICON","PROFICIENCY_LEVEL_ICON","RARITY","common","uncommon","rare","veryRare","artifact","RITUAL_ICON","SPELL_GROUP_IDS","Utils","Hooks","once","async","capitalize","value","replace","text","charAt","toUpperCase","substring","toLowerCase","getSetting","key","defaultValue","game","settings","get","coreModule","api","Logger","debug","setSetting","set","ActionHandler","featureActions","inventoryActions","spellActions","buildSystemActions","groupIds","this","actors","actor","getValidActors","tokens","getValidTokens","items","sortItemsByName","discardSlowItems","abbreviateSkills","displaySpellInfo","showItemsWithoutActivationCosts","showUnchargedItems","showUnequippedItems","showUnpreparedSpells","activationgroupIds","inventorygroupIds","buildCharacterActions","buildVehicleActions","buildMultipleTokenActions","Promise","all","buildConditions","buildEffects","buildFeatures","buildInventory","buildSpells","buildAbilities","buildCombat","buildCounters","buildExhaustion","buildRests","buildSkills","buildUtility","actionType","groupId","system","CONFIG","DND5E","length","Object","entries","filter","map","abilityId","label","mod","icon1","getProficiencyIcon","proficient","info1","getModifier","title","i18n","localize","info2","listName","getListName","actionId","addActions","buildActivations","data","groupData","actionData","activationItems","Map","activationType","activities","contents","activation","has","values","groupDataClone","includes","defaultSelected","parentgroupData","addGroup","addGroupInfo","buildActions","combatType","initiative","current","tokenId","endTurn","getControlledTokens","tokenIds","combatants","combatant","getInfo1","class","cssClass","every","statusEffects","hasCondition","effects","some","statuses","status","disabled","img","getImage","tooltip","getTooltip","getConditionTooltipData","isModuleActive","keys","_","visible","active","attributes","death","success","failure","getFlag","max","counterKey","counterType","allApplicableEffects","size","statusEffectIds","Set","statusEffect","_id","effectId","isSuppressed","parent","identified","user","isGM","isTemporary","featuresMap","featureType","background","monster","race","classFeatureType","artificerInfusion","defensiveTactic","eldritchInvocation","elementalDiscipline","fightingStyle","ki","maneuver","metamagic","multiattack","pact","psionicPower","rune","subType","subtype","inventoryMap","quantity","isActiveItem","isUsableItem","isEquippedItem","shortRest","longRest","total","error","spells","spellsMap","isUsableSpell","preparation","mode","level","systemSpells","reverse","spellSlotsMap","spellSlotAvailable","pactSlotAvailable","pactSlot","hasValue","hasMax","hasLevel","slotAvailable","startsWith","slotsAvailable","spellSlotModes","levelInfo","slots","info","utilityTypes","deathSave","inspiration","hp","utilityType","options","getAction","entity","hasOwn","getItemInfo","getTooltipData","getActivationTypeIcon","icon2","getPreparedIcon","icon3","getConcentrationIcon","info3","activationTypes","activityActivationTypes","uses","spellPreparationModes","preparationMode","prepared","actionName","getSpellInfo","getQuantityData","getUsesData","getConsumeData","components","properties","componentsArray","vocal","somatic","material","ritual","push","join","allowedTypes","per","recovery","period","limitedUsePeriods","perPeriod","spent","firstActivity","firstTarget","consumption","targets","consumeId","target","consumeType","consumeAmount","parentId","substr","lastIndexOf","foundry","utils","getProperty","slowActivationTypes","proficiencyLevels","abilityActivationTypes","tooltipsSetting","unidentified","description","modifiers","rarity","traits","chatProperties","equippableItemCardProperties","labels","range","duration","p","getWeaponProperties","conditionTypes","journalEntry","fromUuid","reference","content","relativeTo","tooltipData","nameHtml","descriptionLocalised","TextEditor","enrichHTML","secrets","rarityHtml","propertiesHtml","property","traitsHtml","trait","traits2Html","traits2","traitsAltHtml","traitsAlt","modifiersHtml","modifier","enabled","tagsJoined","tagsHtml","weaponProperties","selected","validProperties","weapon","itemProperties","DEFAULTS","groups","forEach","groupsArray","layout","nestId","MagicItemActionHandlerExtender","ActionHandlerExtender","constructor","actionHandler","super","extendActionHandler","MagicItems","magicItems","parentGroupData","magicItem","attuned","_isItemAttuned","_isItemEquipped","charges","ownedEntries","entry","baseLevel","encodedValue","itemId","attunment","attunementTypes","REQUIRED","RollHandler","register","updateFunc","hint","scope","config","Boolean","default","onChange","handleActionClick","event","handleAction","rollAbility","rollAbilityTest","rollAbilitySave","toggleCondition","modifyCounter","toggleEffect","modifyExhaustion","isRenderItem","renderItem","useItem","rollMagicItem","rollSkill","performUtilityAction","rollDeathSave","modifyInspiration","modifyCustomCounter","currentExhaustion","newExhaustion","isRightClick","update","setFlag","currentValue","newValue","adjustValue","increment","Math","isCtrl","magicItemActor","roll","callAll","getItem","needsRecharge","rollRecharge","use","legacy","nextTurn","rollInitiative","createCombatants","find","isConvenient","flags","dfreds","effectName","effectInterface","overlay","findCondition","findEffect","delete","toggleStatusEffect","transfer","handleActionHover","isHover","call","SystemManager","getActionHandler","addActionHandlerExtender","getAvailableRollHandlers","coreTitle","getModuleTitle","core","getRollHandler","rollHandlerId","rollHandler","Core","registerSettings","onChangeFunction","systemSettings.register","registerDefaults","defaults","modules","sort","a","b","localeCompare","on","module","requiredCoreModuleVersion"],"mappings":"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"}